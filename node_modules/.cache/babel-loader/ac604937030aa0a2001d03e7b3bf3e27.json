{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport React from 'react';\nimport { useSet } from '../../effects/useSet';\nimport { useListNavigation } from '../../state/ListNavigation';\nexport function useTree(_a) {\n  var _this = this;\n\n  var options = _a.options,\n      expanded = _a.expanded,\n      selected = _a.selected,\n      selectionLimit = _a.selectionLimit,\n      onSelect = _a.onSelect,\n      multiple = _a.multiple,\n      autoExpandParent = _a.autoExpandParent,\n      getRoot = _a.getRoot,\n      getChildren = _a.getChildren,\n      getParentId = _a.getParentId,\n      onCollapse = _a.onCollapse,\n      onExpand = _a.onExpand;\n  var rootNode = React.useMemo(function () {\n    return getRoot(options);\n  }, [getRoot, options]);\n  var getNodes = React.useCallback(function (nodes, node) {\n    return __spreadArray(__spreadArray(__spreadArray([], nodes, true), [node], false), getChildren(node).reduce(getNodes, []), true);\n  }, [getChildren]);\n  var nodes = React.useMemo(function () {\n    return rootNode ? getNodes([], rootNode) : [];\n  }, [rootNode, getNodes]);\n  var getNodeById = React.useCallback(function (nodeId) {\n    return nodes.find(function (item) {\n      return item.id === nodeId;\n    });\n  }, [nodes]);\n\n  var _b = useSet(),\n      isLoading = _b.has,\n      startLoading = _b.add,\n      stopLoading = _b.remove;\n\n  var handleExpand = React.useCallback(function (nodeId) {\n    return __awaiter(_this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0,, 2, 3]);\n\n            startLoading(nodeId);\n            return [4\n            /*yield*/\n            , onExpand(getNodeById(nodeId))];\n\n          case 1:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            stopLoading(nodeId);\n            return [7\n            /*endfinally*/\n            ];\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [getNodeById, onExpand, startLoading, stopLoading]);\n  var handleCollapse = React.useCallback(function (nodeId) {\n    return onCollapse(getNodeById(nodeId));\n  }, [getNodeById, onCollapse]);\n  var getExpandedIds = React.useCallback(function (nodeIds, currentNode) {\n    var parentId = getParentId(currentNode);\n\n    if (parentId === rootNode.id || parentId === getParentId(rootNode)) {\n      return __spreadArray(__spreadArray([], nodeIds, true), [currentNode.id, parentId], false);\n    } else {\n      return getExpandedIds(__spreadArray(__spreadArray([], nodeIds, true), [currentNode.id], false), getNodeById(parentId));\n    }\n  }, [getNodeById, getParentId, rootNode]);\n  var expandedIds = React.useMemo(function () {\n    if (autoExpandParent) {\n      return nodes.filter(function (node) {\n        return expanded.concat(selected).includes(node.id);\n      }).reduce(getExpandedIds, []);\n    }\n\n    return expanded;\n  }, [autoExpandParent, expanded, getExpandedIds, nodes, selected]);\n\n  var _c = useSet({\n    initialValue: new Set(expandedIds),\n    onAdd: handleExpand,\n    onRemove: handleCollapse\n  }),\n      isExpanded = _c.has,\n      toggleExpanded = _c.toggle,\n      setExpanded = _c.setCollection;\n\n  var handleChange = React.useCallback(function (selectedNodes) {\n    return onSelect(Array.from(selectedNodes).map(getNodeById));\n  }, [getNodeById, onSelect]);\n\n  var _d = useSet({\n    initialValue: new Set(selected),\n    onChange: handleChange\n  }),\n      selectedIds = _d.collection,\n      isSelected = _d.has,\n      addSelected = _d.add,\n      removeSelected = _d.remove,\n      setSelected = _d.setCollection;\n\n  var toggleSingleSelected = React.useCallback(function (nodeId) {\n    setSelected(new Set([nodeId]));\n  }, [setSelected]);\n  var toggleSelected = React.useCallback(function (nodeId) {\n    if (!isSelected(nodeId)) {\n      if (selectedIds.size < selectionLimit) {\n        addSelected(nodeId);\n      }\n    } else {\n      removeSelected(nodeId);\n    }\n  }, [addSelected, isSelected, removeSelected, selectedIds.size, selectionLimit]);\n  var toggleSelection = React.useMemo(function () {\n    return multiple ? toggleSelected : toggleSingleSelected;\n  }, [multiple, toggleSelected, toggleSingleSelected]);\n  var handleSelection = React.useCallback(function (node) {\n    return toggleSelection(node.id);\n  }, [toggleSelection]);\n  var listNavigation = useListNavigation({\n    circular: false,\n    initialIndex: 0,\n    size: 0\n  });\n  var getSelectableItems = React.useCallback(function (visibleNodes, node) {\n    var visibleItems = isExpanded(node.id) && !isLoading(node.id) && node.items ? node.items.reduce(getSelectableItems, []) : [];\n    return __spreadArray(__spreadArray(__spreadArray([], visibleNodes, true), [node], false), visibleItems, true);\n  }, [isExpanded, isLoading]);\n  var getChildrenNodes = React.useCallback(function (nodes, node, level) {\n    var children = getChildren(node);\n\n    if (children.length > 0) {\n      return __spreadArray(__spreadArray([], nodes, true), [__assign(__assign({}, node), {\n        level: level,\n        items: children.reduce(function (acc, curr) {\n          return getChildrenNodes(acc, curr, level + 1);\n        }, [])\n      })], false);\n    } else {\n      return __spreadArray(__spreadArray([], nodes, true), [__assign(__assign({}, node), {\n        level: level\n      })], false);\n    }\n  }, [getChildren]);\n  var nodesTree = React.useMemo(function () {\n    return rootNode ? getChildrenNodes([], rootNode, 0) : [];\n  }, [rootNode, getChildrenNodes]);\n  var visibleNodes = React.useMemo(function () {\n    return nodesTree.reduce(getSelectableItems, []);\n  }, [getSelectableItems, nodesTree]);\n  var highlight = React.useCallback(function (node) {\n    var index = visibleNodes.findIndex(function (visibleNode) {\n      return visibleNode.id === node.id;\n    });\n\n    if (index !== -1) {\n      listNavigation.set(index);\n    }\n  }, [listNavigation, visibleNodes]);\n  React.useEffect(function () {\n    listNavigation.setSize(visibleNodes.length);\n  }, [listNavigation, visibleNodes.length]);\n  var isHighlighted = React.useCallback(function (node) {\n    return visibleNodes[listNavigation.index] && visibleNodes[listNavigation.index].id === node.id;\n  }, [listNavigation.index, visibleNodes]);\n  var highlightedNode = React.useMemo(function () {\n    return visibleNodes[listNavigation.index];\n  }, [listNavigation.index, visibleNodes]);\n  return {\n    nodes: visibleNodes,\n    isExpanded: React.useCallback(function (node) {\n      return isExpanded(node.id);\n    }, [isExpanded]),\n    isSelected: React.useCallback(function (node) {\n      return isSelected(node.id);\n    }, [isSelected]),\n    isLoading: React.useCallback(function (node) {\n      return isLoading(node.id);\n    }, [isLoading]),\n    highlightedNode: highlightedNode,\n    isHighlighted: isHighlighted,\n    highlight: highlight,\n    handleSelection: handleSelection,\n    handleExpansion: React.useCallback(function (node) {\n      return toggleExpanded(node.id);\n    }, [toggleExpanded]),\n    setSelected: setSelected,\n    setExpanded: setExpanded,\n    isFileLimitReached: selectedIds.size >= selectionLimit,\n    listNavigation: listNavigation\n  };\n}","map":{"version":3,"sources":["../../../../src/components/Tree/Tree.hooks.ts"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport React from 'react';\nimport { useSet } from '../../effects/useSet';\nimport { useListNavigation } from '../../state/ListNavigation';\nexport function useTree(_a) {\n    var _this = this;\n    var options = _a.options, expanded = _a.expanded, selected = _a.selected, selectionLimit = _a.selectionLimit, onSelect = _a.onSelect, multiple = _a.multiple, autoExpandParent = _a.autoExpandParent, getRoot = _a.getRoot, getChildren = _a.getChildren, getParentId = _a.getParentId, onCollapse = _a.onCollapse, onExpand = _a.onExpand;\n    var rootNode = React.useMemo(function () { return getRoot(options); }, [getRoot, options]);\n    var getNodes = React.useCallback(function (nodes, node) { return __spreadArray(__spreadArray(__spreadArray([], nodes, true), [\n        node\n    ], false), getChildren(node).reduce(getNodes, []), true); }, [getChildren]);\n    var nodes = React.useMemo(function () { return (rootNode ? getNodes([], rootNode) : []); }, [\n        rootNode,\n        getNodes,\n    ]);\n    var getNodeById = React.useCallback(function (nodeId) { return nodes.find(function (item) { return item.id === nodeId; }); }, [nodes]);\n    var _b = useSet(), isLoading = _b.has, startLoading = _b.add, stopLoading = _b.remove;\n    var handleExpand = React.useCallback(function (nodeId) { return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, , 2, 3]);\n                    startLoading(nodeId);\n                    return [4 /*yield*/, onExpand(getNodeById(nodeId))];\n                case 1:\n                    _a.sent();\n                    return [3 /*break*/, 3];\n                case 2:\n                    stopLoading(nodeId);\n                    return [7 /*endfinally*/];\n                case 3: return [2 /*return*/];\n            }\n        });\n    }); }, [getNodeById, onExpand, startLoading, stopLoading]);\n    var handleCollapse = React.useCallback(function (nodeId) { return onCollapse(getNodeById(nodeId)); }, [getNodeById, onCollapse]);\n    var getExpandedIds = React.useCallback(function (nodeIds, currentNode) {\n        var parentId = getParentId(currentNode);\n        if (parentId === rootNode.id || parentId === getParentId(rootNode)) {\n            return __spreadArray(__spreadArray([], nodeIds, true), [currentNode.id, parentId], false);\n        }\n        else {\n            return getExpandedIds(__spreadArray(__spreadArray([], nodeIds, true), [currentNode.id], false), getNodeById(parentId));\n        }\n    }, [getNodeById, getParentId, rootNode]);\n    var expandedIds = React.useMemo(function () {\n        if (autoExpandParent) {\n            return nodes\n                .filter(function (node) { return expanded.concat(selected).includes(node.id); })\n                .reduce(getExpandedIds, []);\n        }\n        return expanded;\n    }, [autoExpandParent, expanded, getExpandedIds, nodes, selected]);\n    var _c = useSet({\n        initialValue: new Set(expandedIds),\n        onAdd: handleExpand,\n        onRemove: handleCollapse,\n    }), isExpanded = _c.has, toggleExpanded = _c.toggle, setExpanded = _c.setCollection;\n    var handleChange = React.useCallback(function (selectedNodes) {\n        return onSelect(Array.from(selectedNodes).map(getNodeById));\n    }, [getNodeById, onSelect]);\n    var _d = useSet({\n        initialValue: new Set(selected),\n        onChange: handleChange,\n    }), selectedIds = _d.collection, isSelected = _d.has, addSelected = _d.add, removeSelected = _d.remove, setSelected = _d.setCollection;\n    var toggleSingleSelected = React.useCallback(function (nodeId) {\n        setSelected(new Set([nodeId]));\n    }, [setSelected]);\n    var toggleSelected = React.useCallback(function (nodeId) {\n        if (!isSelected(nodeId)) {\n            if (selectedIds.size < selectionLimit) {\n                addSelected(nodeId);\n            }\n        }\n        else {\n            removeSelected(nodeId);\n        }\n    }, [addSelected, isSelected, removeSelected, selectedIds.size, selectionLimit]);\n    var toggleSelection = React.useMemo(function () { return (multiple ? toggleSelected : toggleSingleSelected); }, [multiple, toggleSelected, toggleSingleSelected]);\n    var handleSelection = React.useCallback(function (node) { return toggleSelection(node.id); }, [toggleSelection]);\n    var listNavigation = useListNavigation({\n        circular: false,\n        initialIndex: 0,\n        size: 0,\n    });\n    var getSelectableItems = React.useCallback(function (visibleNodes, node) {\n        var visibleItems = isExpanded(node.id) && !isLoading(node.id) && node.items\n            ? node.items.reduce(getSelectableItems, [])\n            : [];\n        return __spreadArray(__spreadArray(__spreadArray([], visibleNodes, true), [node], false), visibleItems, true);\n    }, [isExpanded, isLoading]);\n    var getChildrenNodes = React.useCallback(function (nodes, node, level) {\n        var children = getChildren(node);\n        if (children.length > 0) {\n            return __spreadArray(__spreadArray([], nodes, true), [\n                __assign(__assign({}, node), { level: level, items: children.reduce(function (acc, curr) { return getChildrenNodes(acc, curr, level + 1); }, []) }),\n            ], false);\n        }\n        else {\n            return __spreadArray(__spreadArray([], nodes, true), [__assign(__assign({}, node), { level: level })], false);\n        }\n    }, [getChildren]);\n    var nodesTree = React.useMemo(function () { return (rootNode ? getChildrenNodes([], rootNode, 0) : []); }, [rootNode, getChildrenNodes]);\n    var visibleNodes = React.useMemo(function () { return nodesTree.reduce(getSelectableItems, []); }, [getSelectableItems, nodesTree]);\n    var highlight = React.useCallback(function (node) {\n        var index = visibleNodes.findIndex(function (visibleNode) { return visibleNode.id === node.id; });\n        if (index !== -1) {\n            listNavigation.set(index);\n        }\n    }, [listNavigation, visibleNodes]);\n    React.useEffect(function () {\n        listNavigation.setSize(visibleNodes.length);\n    }, [listNavigation, visibleNodes.length]);\n    var isHighlighted = React.useCallback(function (node) {\n        return visibleNodes[listNavigation.index] &&\n            visibleNodes[listNavigation.index].id === node.id;\n    }, [listNavigation.index, visibleNodes]);\n    var highlightedNode = React.useMemo(function () {\n        return visibleNodes[listNavigation.index];\n    }, [listNavigation.index, visibleNodes]);\n    return {\n        nodes: visibleNodes,\n        isExpanded: React.useCallback(function (node) { return isExpanded(node.id); }, [\n            isExpanded,\n        ]),\n        isSelected: React.useCallback(function (node) { return isSelected(node.id); }, [\n            isSelected,\n        ]),\n        isLoading: React.useCallback(function (node) { return isLoading(node.id); }, [isLoading]),\n        highlightedNode: highlightedNode,\n        isHighlighted: isHighlighted,\n        highlight: highlight,\n        handleSelection: handleSelection,\n        handleExpansion: React.useCallback(function (node) { return toggleExpanded(node.id); }, [\n            toggleExpanded,\n        ]),\n        setSelected: setSelected,\n        setExpanded: setExpanded,\n        isFileLimitReached: selectedIds.size >= selectionLimit,\n        listNavigation: listNavigation,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}