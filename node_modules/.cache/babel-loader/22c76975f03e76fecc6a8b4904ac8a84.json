{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport React, { isValidElement, useEffect, useMemo, useState } from 'react';\nimport { useI18nContext } from '../../state/I18n';\nimport { addSubcomponents } from '../../utils/addSubcomponents';\nimport Checkbox from '../Checkbox';\nimport { Search as SearchBase } from '../Search';\nimport { StyledDroppable, StyledFooter, StyledGrip, StyledGroup, StyledHeader, StyledItem, StyledWrapper, StyledMenu, StyledOptions, StyledSearch } from './MenuImperative.styles';\nimport { DragDropContext, Droppable as DndDroppable, Draggable, useMouseSensor, useTouchSensor } from 'react-beautiful-dnd';\nimport { Grip } from '@procore/core-icons/dist';\nimport { colors } from '../../styles/colors';\nimport { mergeRefs } from '../../effects/mergeRefs';\nimport { useZIndexContext } from '../../state/ZIndex';\nimport { createSensors } from './sensors';\nvar onScrollBottomThreshold = 8;\nvar NO_ANNOUCEMENT = '';\n\nfunction noop() {}\n\nfunction isScrolledToBottom(e) {\n  return e.currentTarget instanceof HTMLElement && e.currentTarget.scrollTop >= e.currentTarget.scrollHeight - e.currentTarget.clientHeight - onScrollBottomThreshold;\n} // TODO use the shared mergeRefs utility\n\n\nexport function useMergeRef(externalRef) {\n  var ref = React.useRef();\n  return [ref, React.useCallback(function (node) {\n    ref.current = node;\n\n    if (externalRef) {\n      if (typeof externalRef === 'function') {\n        externalRef(node);\n      } else {\n        externalRef.current = node;\n      }\n    }\n  }, [externalRef])];\n}\nvar MenuContext = React.createContext({\n  currentlyDroppableIn: [],\n  onHoverItem: noop,\n  onScrollBottom: noop,\n  onSelect: noop\n});\nexport function useMenuContext() {\n  var context = React.useContext(MenuContext);\n\n  if (context === null) {\n    throw new Error('Cannot find `Menu` context, please wrap your component in `<MenuContext.Provider>`');\n  }\n\n  return context;\n}\nvar MenuImperative_ = React.forwardRef(function Menu(_a, forwardRef) {\n  var _b = _a.circular,\n      circular = _b === void 0 ? false : _b,\n      _c = _a.onDragEnd,\n      onDragEnd_ = _c === void 0 ? noop : _c,\n      _d = _a.onScrollBottom,\n      onScrollBottom_ = _d === void 0 ? noop : _d,\n      _e = _a.onSelect,\n      onSelect_ = _e === void 0 ? noop : _e,\n      props = __rest(_a, [\"circular\", \"onDragEnd\", \"onScrollBottom\", \"onSelect\"]);\n\n  var ref = React.useRef(null);\n\n  var _f = useState([]),\n      currentlyDroppableIn = _f[0],\n      setCurrentlyDroppableIn = _f[1]; // for context, used by Menu.Item\n\n\n  var onSelect = React.useCallback(function (selection) {\n    onSelect_(selection);\n  }, [onSelect_]);\n\n  var _g = useMemo(function () {\n    return createSensors(ref, circular);\n  }, [circular]),\n      handleItemHover = _g.handleItemHover,\n      handleKeyDown = _g.handleKeyDown,\n      highlight = _g.highlight,\n      highlighted = _g.highlighted,\n      highlightFirst = _g.highlightFirst,\n      highlightLast = _g.highlightLast,\n      highlightSelected = _g.highlightSelected,\n      highlightSuggested = _g.highlightSuggested,\n      rehighlightCurrent = _g.rehighlightCurrent,\n      prev = _g.prev,\n      next = _g.next,\n      select = _g.select,\n      updateSelectCallback = _g.updateSelectCallback,\n      useKeyboardSensor = _g.useKeyboardSensor;\n\n  updateSelectCallback(onSelect); // exposes internal menu API\n\n  React.useImperativeHandle(forwardRef, function () {\n    return {\n      el: ref.current,\n      highlight: highlight,\n      highlighted: highlighted,\n      highlightFirst: highlightFirst,\n      highlightLast: highlightLast,\n      highlightSelected: highlightSelected,\n      highlightSuggested: highlightSuggested,\n      next: next,\n      prev: prev,\n      select: select\n    };\n  });\n  useEffect(rehighlightCurrent);\n\n  function onDragStart(start, provided) {\n    // TODO Replace with localized instructions\n    provided.announce(NO_ANNOUCEMENT);\n    var itemInfo = JSON.parse(start.draggableId);\n    setCurrentlyDroppableIn(itemInfo.droppableIn);\n  }\n\n  function onDragUpdate(_update, provided) {\n    // TODO Replace with localized instructions\n    provided.announce(NO_ANNOUCEMENT);\n  }\n\n  var onDragEnd = React.useCallback(function (result, provided) {\n    // TODO Replace with localized instructions\n    provided.announce(NO_ANNOUCEMENT);\n    setCurrentlyDroppableIn([]);\n\n    if (result.reason === 'DROP' && result.destination) {\n      var itemInfo = JSON.parse(result.draggableId);\n      onDragEnd_({\n        draggableId: itemInfo.draggableId,\n        source: result.source,\n        destination: result.destination\n      });\n    }\n  }, [onDragEnd_]); // for context, used by Menu.Options\n\n  var onScrollBottom = React.useCallback(function (e) {\n    if (isScrolledToBottom(e)) {\n      onScrollBottom_(e);\n    }\n  }, [onScrollBottom_]);\n  return React.createElement(MenuContext.Provider, {\n    value: {\n      currentlyDroppableIn: currentlyDroppableIn,\n      onHoverItem: handleItemHover,\n      onScrollBottom: onScrollBottom,\n      onSelect: onSelect\n    }\n  }, React.createElement(StyledWrapper, {\n    ref: ref,\n    onKeyDown: handleKeyDown,\n    tabIndex: 0\n  }, React.createElement(DragDropContext, {\n    onDragStart: onDragStart,\n    onDragUpdate: onDragUpdate,\n    onDragEnd: onDragEnd,\n    enableDefaultSensors: false,\n    sensors: [useMouseSensor, useTouchSensor, useKeyboardSensor]\n  }, React.createElement(StyledMenu, __assign({}, props)))));\n});\nexport var Group = React.forwardRef(function Group(_a, ref) {\n  var clickable = _a.clickable,\n      _b = _a.item,\n      item = _b === void 0 ? 'group' : _b,\n      props = __rest(_a, [\"clickable\", \"item\"]);\n\n  return React.createElement(StyledGroup, __assign({\n    ref: ref,\n    onClick: function (e) {// TODO: implement selecting groups?\n    },\n    \"data-group\": true,\n    \"data-value\": JSON.stringify(item)\n  }, props));\n});\n\nfunction findDraggableRecursively(children, draggableId) {\n  var nodeChildren = React.Children.toArray(children);\n\n  for (var i = 0; i < nodeChildren.length; i++) {\n    var child = nodeChildren[i];\n\n    if (isValidElement(child)) {\n      if ('draggableId' in child.props) {\n        if (child.props.draggableId === draggableId) {\n          return child;\n        }\n      } else {\n        var matchingChild = findDraggableRecursively(child.props.children, draggableId);\n\n        if (matchingChild) {\n          return matchingChild;\n        }\n      }\n    }\n  }\n\n  return null;\n}\n\nexport function Droppable(_a) {\n  var id = _a.id,\n      children = _a.children;\n  var ctx = useMenuContext();\n  var cloneZIndex = useZIndexContext().value;\n\n  function renderItemClone(provided, _snapshot, rubric) {\n    var _a;\n\n    var draggableInfo = JSON.parse(rubric.draggableId);\n    var draggingChild = findDraggableRecursively(children, draggableInfo.draggableId);\n    var cloneProps = (_a = draggingChild === null || draggingChild === void 0 ? void 0 : draggingChild.props) !== null && _a !== void 0 ? _a : {};\n    return React.createElement(ClonedItem, __assign({\n      hasCheckbox: (draggingChild === null || draggingChild === void 0 ? void 0 : draggingChild.type) === CheckboxItem,\n      provided: provided,\n      cloneZIndex: cloneZIndex\n    }, cloneProps));\n  }\n\n  return React.createElement(DndDroppable, {\n    droppableId: id,\n    isDropDisabled: !ctx.currentlyDroppableIn.includes(id),\n    renderClone: renderItemClone\n  }, function (provided, snapshot) {\n    return React.createElement(StyledDroppable, {\n      ref: provided.innerRef,\n      \"data-droppable\": true\n    }, children, provided.placeholder);\n  });\n} // creates a version of a draggable item that can be positioned correctly within modals\n// this should always have the same appearance of an Item or CheckboxItem, but doesn't\n// need to handle selection events, which can't be done while the item is being dragged\n\nvar ClonedItem = function (_a) {\n  var _b = _a.hasCheckbox,\n      hasCheckbox = _b === void 0 ? false : _b,\n      _c = _a.children,\n      children = _c === void 0 ? null : _c,\n      _d = _a.selected,\n      selected = _d === void 0 ? false : _d,\n      provided = _a.provided,\n      props = __rest(_a, [\"hasCheckbox\", \"children\", \"selected\", \"provided\"]);\n\n  var itemProps = __assign(__assign({}, props), {\n    $selected: selected\n  });\n\n  var itemChildren = hasCheckbox ? React.createElement(Checkbox, {\n    indeterminate: props.indeterminate,\n    error: props.error,\n    checked: selected,\n    onChange: noop\n  }, children) : children;\n  return React.createElement(StyledItem, __assign({\n    ref: provided.innerRef\n  }, provided.draggableProps, provided.dragHandleProps, itemProps, {\n    \"$isDraggable\": true,\n    \"$isDragging\": true,\n    style: __assign(__assign(__assign({}, provided.draggableProps.style), props.style), {\n      zIndex: props.cloneZIndex\n    })\n  }), React.createElement(StyledGrip, null, React.createElement(Grip, {\n    color: colors.gray45\n  })), itemChildren);\n};\n\nexport var Item = React.forwardRef(function Item(_a, forwardRef) {\n  var _b = _a.children,\n      children = _b === void 0 ? null : _b,\n      _c = _a.item,\n      item = _c === void 0 ? null : _c,\n      _d = _a.onClick,\n      onClick_ = _d === void 0 ? noop : _d,\n      _e = _a.selected,\n      selected = _e === void 0 ? false : _e,\n      _f = _a.suggested,\n      suggested = _f === void 0 ? false : _f,\n      _g = _a.disabled,\n      disabled = _g === void 0 ? false : _g,\n      props = __rest(_a, [\"children\", \"item\", \"onClick\", \"selected\", \"suggested\", \"disabled\"]);\n\n  var _h = useMergeRef(forwardRef),\n      ref = _h[0],\n      setRef = _h[1];\n\n  var ctx = useMenuContext();\n  var onClick = React.useCallback(function (event) {\n    if (disabled) return;\n    onClick_(event);\n    ctx.onSelect({\n      item: item,\n      event: event,\n      group: false,\n      action: selected ? 'unselected' : 'selected'\n    });\n  }, [ctx, item, onClick_, disabled, selected]);\n\n  var itemProps = __assign(__assign({}, props), {\n    onClick: onClick,\n    onMouseMove: function (e) {\n      return ctx.onHoverItem(e.currentTarget);\n    },\n    'data-group': false,\n    'data-value': JSON.stringify(item),\n    'data-selected': selected,\n    'data-suggested': suggested,\n    'data-disabled': disabled,\n    $disabled: disabled,\n    $selected: selected\n  });\n\n  if ('droppableIn' in props && 'draggableId' in props && 'draggableIndex' in props) {\n    // encoding id and valid droppables as the draggableId, so we can use them to determine where this item can be dropped\n    var droppableInfo = {\n      draggableId: props.draggableId,\n      droppableIn: Array.isArray(props.droppableIn) ? props.droppableIn : [props.droppableIn]\n    };\n    return React.createElement(Draggable, {\n      draggableId: JSON.stringify(droppableInfo),\n      index: props.draggableIndex,\n      isDragDisabled: disabled\n    }, function (provided) {\n      return React.createElement(StyledItem, __assign({\n        ref: mergeRefs(provided.innerRef, setRef)\n      }, provided.draggableProps, provided.dragHandleProps, itemProps, {\n        \"$isDraggable\": !disabled,\n        style: __assign(__assign({}, provided.draggableProps.style), itemProps.style),\n        tabIndex: -1\n      }), !disabled && React.createElement(StyledGrip, null, React.createElement(Grip, {\n        color: colors.gray45\n      })), children);\n    });\n  }\n\n  return React.createElement(StyledItem, __assign({\n    ref: setRef\n  }, itemProps), children);\n});\nexport var CheckboxItem = React.forwardRef(function CheckboxItem(_a, forwardRef) {\n  var _b = _a.selected,\n      selected = _b === void 0 ? false : _b,\n      _c = _a.disabled,\n      disabled = _c === void 0 ? false : _c,\n      _d = _a.error,\n      error = _d === void 0 ? false : _d,\n      _e = _a.indeterminate,\n      indeterminate = _e === void 0 ? false : _e,\n      _f = _a.children,\n      children = _f === void 0 ? null : _f,\n      props = __rest(_a, [\"selected\", \"disabled\", \"error\", \"indeterminate\", \"children\"]);\n\n  function onCheckboxClick(event) {\n    event.stopPropagation();\n  }\n\n  return React.createElement(Item, __assign({}, props, {\n    selected: selected,\n    disabled: disabled,\n    ref: forwardRef\n  }), React.createElement(Checkbox, {\n    indeterminate: indeterminate,\n    error: error,\n    disabled: disabled,\n    checked: selected,\n    onClick: onCheckboxClick,\n    onChange: noop,\n    tabIndex: -1\n  }, children));\n});\nexport var Options = React.forwardRef(function Options(props, ref) {\n  var ctx = useMenuContext();\n  return React.createElement(StyledOptions, __assign({}, props, {\n    ref: ref,\n    onScroll: ctx.onScrollBottom,\n    tabIndex: 0\n  }));\n}); // TODO change this component to render out a Typeahead instead of\n// the deprecated Search with typeahead prop\n\nexport var Search = function (_a) {\n  var className = _a.className,\n      _b = _a.i18nScope,\n      i18nScope = _b === void 0 ? 'core.menu' : _b,\n      placeholder = _a.placeholder,\n      props = __rest(_a, [\"className\", \"i18nScope\", \"placeholder\"]);\n\n  var I18n = useI18nContext();\n  return React.createElement(StyledSearch, {\n    className: className\n  }, React.createElement(SearchBase, __assign({}, props, {\n    autoFocus: true,\n    placeholder: placeholder || I18n.t('search', {\n      scope: i18nScope\n    }),\n    typeahead: true\n  })));\n};\nexport var Header = React.forwardRef(function Header(_a, ref) {\n  var props = __rest(_a, []);\n\n  return React.createElement(StyledHeader, __assign({\n    ref: ref\n  }, props));\n});\nexport var Footer = React.forwardRef(function Footer(_a, ref) {\n  var _b = _a.padding,\n      padding = _b === void 0 ? 'md lg' : _b,\n      props = __rest(_a, [\"padding\"]);\n\n  return React.createElement(StyledFooter, __assign({\n    ref: ref,\n    padding: padding\n  }, props));\n});\nMenuImperative_.displayName = 'Menu';\nDroppable.displayName = 'Menu.Droppable';\nFooter.displayName = 'Menu.Footer';\nGroup.displayName = 'Menu.Group';\nHeader.displayName = 'Menu.Header';\nItem.displayName = 'Menu.Item';\nOptions.displayName = 'Menu.Options';\nSearch.displayName = 'Menu.Search';\nexport var MenuImperative = addSubcomponents({\n  CheckboxItem: CheckboxItem,\n  Droppable: Droppable,\n  Footer: Footer,\n  Group: Group,\n  Header: Header,\n  Item: Item,\n  Options: Options,\n  Search: Search\n}, MenuImperative_);","map":{"version":3,"sources":["../../../../src/components/MenuImperative/MenuImperative.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React, { isValidElement, useEffect, useMemo, useState } from 'react';\nimport { useI18nContext } from '../../state/I18n';\nimport { addSubcomponents } from '../../utils/addSubcomponents';\nimport Checkbox from '../Checkbox';\nimport { Search as SearchBase } from '../Search';\nimport { StyledDroppable, StyledFooter, StyledGrip, StyledGroup, StyledHeader, StyledItem, StyledWrapper, StyledMenu, StyledOptions, StyledSearch, } from './MenuImperative.styles';\nimport { DragDropContext, Droppable as DndDroppable, Draggable, useMouseSensor, useTouchSensor, } from 'react-beautiful-dnd';\nimport { Grip } from '@procore/core-icons/dist';\nimport { colors } from '../../styles/colors';\nimport { mergeRefs } from '../../effects/mergeRefs';\nimport { useZIndexContext } from '../../state/ZIndex';\nimport { createSensors } from './sensors';\nvar onScrollBottomThreshold = 8;\nvar NO_ANNOUCEMENT = '';\nfunction noop() { }\nfunction isScrolledToBottom(e) {\n    return (e.currentTarget instanceof HTMLElement &&\n        e.currentTarget.scrollTop >=\n            e.currentTarget.scrollHeight -\n                e.currentTarget.clientHeight -\n                onScrollBottomThreshold);\n}\n// TODO use the shared mergeRefs utility\nexport function useMergeRef(externalRef) {\n    var ref = React.useRef();\n    return [\n        ref,\n        React.useCallback(function (node) {\n            ref.current = node;\n            if (externalRef) {\n                if (typeof externalRef === 'function') {\n                    externalRef(node);\n                }\n                else {\n                    externalRef.current = node;\n                }\n            }\n        }, [externalRef]),\n    ];\n}\nvar MenuContext = React.createContext({\n    currentlyDroppableIn: [],\n    onHoverItem: noop,\n    onScrollBottom: noop,\n    onSelect: noop,\n});\nexport function useMenuContext() {\n    var context = React.useContext(MenuContext);\n    if (context === null) {\n        throw new Error('Cannot find `Menu` context, please wrap your component in `<MenuContext.Provider>`');\n    }\n    return context;\n}\nvar MenuImperative_ = React.forwardRef(function Menu(_a, forwardRef) {\n    var _b = _a.circular, circular = _b === void 0 ? false : _b, _c = _a.onDragEnd, onDragEnd_ = _c === void 0 ? noop : _c, _d = _a.onScrollBottom, onScrollBottom_ = _d === void 0 ? noop : _d, _e = _a.onSelect, onSelect_ = _e === void 0 ? noop : _e, props = __rest(_a, [\"circular\", \"onDragEnd\", \"onScrollBottom\", \"onSelect\"]);\n    var ref = React.useRef(null);\n    var _f = useState([]), currentlyDroppableIn = _f[0], setCurrentlyDroppableIn = _f[1];\n    // for context, used by Menu.Item\n    var onSelect = React.useCallback(function (selection) {\n        onSelect_(selection);\n    }, [onSelect_]);\n    var _g = useMemo(function () { return createSensors(ref, circular); }, [circular]), handleItemHover = _g.handleItemHover, handleKeyDown = _g.handleKeyDown, highlight = _g.highlight, highlighted = _g.highlighted, highlightFirst = _g.highlightFirst, highlightLast = _g.highlightLast, highlightSelected = _g.highlightSelected, highlightSuggested = _g.highlightSuggested, rehighlightCurrent = _g.rehighlightCurrent, prev = _g.prev, next = _g.next, select = _g.select, updateSelectCallback = _g.updateSelectCallback, useKeyboardSensor = _g.useKeyboardSensor;\n    updateSelectCallback(onSelect);\n    // exposes internal menu API\n    React.useImperativeHandle(forwardRef, function () { return ({\n        el: ref.current,\n        highlight: highlight,\n        highlighted: highlighted,\n        highlightFirst: highlightFirst,\n        highlightLast: highlightLast,\n        highlightSelected: highlightSelected,\n        highlightSuggested: highlightSuggested,\n        next: next,\n        prev: prev,\n        select: select,\n    }); });\n    useEffect(rehighlightCurrent);\n    function onDragStart(start, provided) {\n        // TODO Replace with localized instructions\n        provided.announce(NO_ANNOUCEMENT);\n        var itemInfo = JSON.parse(start.draggableId);\n        setCurrentlyDroppableIn(itemInfo.droppableIn);\n    }\n    function onDragUpdate(_update, provided) {\n        // TODO Replace with localized instructions\n        provided.announce(NO_ANNOUCEMENT);\n    }\n    var onDragEnd = React.useCallback(function (result, provided) {\n        // TODO Replace with localized instructions\n        provided.announce(NO_ANNOUCEMENT);\n        setCurrentlyDroppableIn([]);\n        if (result.reason === 'DROP' && result.destination) {\n            var itemInfo = JSON.parse(result.draggableId);\n            onDragEnd_({\n                draggableId: itemInfo.draggableId,\n                source: result.source,\n                destination: result.destination,\n            });\n        }\n    }, [onDragEnd_]);\n    // for context, used by Menu.Options\n    var onScrollBottom = React.useCallback(function (e) {\n        if (isScrolledToBottom(e)) {\n            onScrollBottom_(e);\n        }\n    }, [onScrollBottom_]);\n    return (React.createElement(MenuContext.Provider, { value: {\n            currentlyDroppableIn: currentlyDroppableIn,\n            onHoverItem: handleItemHover,\n            onScrollBottom: onScrollBottom,\n            onSelect: onSelect,\n        } },\n        React.createElement(StyledWrapper, { ref: ref, onKeyDown: handleKeyDown, tabIndex: 0 },\n            React.createElement(DragDropContext, { onDragStart: onDragStart, onDragUpdate: onDragUpdate, onDragEnd: onDragEnd, enableDefaultSensors: false, sensors: [useMouseSensor, useTouchSensor, useKeyboardSensor] },\n                React.createElement(StyledMenu, __assign({}, props))))));\n});\nexport var Group = React.forwardRef(function Group(_a, ref) {\n    var clickable = _a.clickable, _b = _a.item, item = _b === void 0 ? 'group' : _b, props = __rest(_a, [\"clickable\", \"item\"]);\n    return (React.createElement(StyledGroup, __assign({ ref: ref, onClick: function (e) {\n            // TODO: implement selecting groups?\n        }, \"data-group\": true, \"data-value\": JSON.stringify(item) }, props)));\n});\nfunction findDraggableRecursively(children, draggableId) {\n    var nodeChildren = React.Children.toArray(children);\n    for (var i = 0; i < nodeChildren.length; i++) {\n        var child = nodeChildren[i];\n        if (isValidElement(child)) {\n            if ('draggableId' in child.props) {\n                if (child.props.draggableId === draggableId) {\n                    return child;\n                }\n            }\n            else {\n                var matchingChild = findDraggableRecursively(child.props.children, draggableId);\n                if (matchingChild) {\n                    return matchingChild;\n                }\n            }\n        }\n    }\n    return null;\n}\nexport function Droppable(_a) {\n    var id = _a.id, children = _a.children;\n    var ctx = useMenuContext();\n    var cloneZIndex = useZIndexContext().value;\n    function renderItemClone(provided, _snapshot, rubric) {\n        var _a;\n        var draggableInfo = JSON.parse(rubric.draggableId);\n        var draggingChild = findDraggableRecursively(children, draggableInfo.draggableId);\n        var cloneProps = (_a = draggingChild === null || draggingChild === void 0 ? void 0 : draggingChild.props) !== null && _a !== void 0 ? _a : {};\n        return (React.createElement(ClonedItem, __assign({ hasCheckbox: (draggingChild === null || draggingChild === void 0 ? void 0 : draggingChild.type) === CheckboxItem, provided: provided, cloneZIndex: cloneZIndex }, cloneProps)));\n    }\n    return (React.createElement(DndDroppable, { droppableId: id, isDropDisabled: !ctx.currentlyDroppableIn.includes(id), renderClone: renderItemClone }, function (provided, snapshot) { return (React.createElement(StyledDroppable, { ref: provided.innerRef, \"data-droppable\": true },\n        children,\n        provided.placeholder)); }));\n}\n// creates a version of a draggable item that can be positioned correctly within modals\n// this should always have the same appearance of an Item or CheckboxItem, but doesn't\n// need to handle selection events, which can't be done while the item is being dragged\nvar ClonedItem = function (_a) {\n    var _b = _a.hasCheckbox, hasCheckbox = _b === void 0 ? false : _b, _c = _a.children, children = _c === void 0 ? null : _c, _d = _a.selected, selected = _d === void 0 ? false : _d, provided = _a.provided, props = __rest(_a, [\"hasCheckbox\", \"children\", \"selected\", \"provided\"]);\n    var itemProps = __assign(__assign({}, props), { $selected: selected });\n    var itemChildren = hasCheckbox ? (React.createElement(Checkbox, { indeterminate: props.indeterminate, error: props.error, checked: selected, onChange: noop }, children)) : (children);\n    return (React.createElement(StyledItem, __assign({ ref: provided.innerRef }, provided.draggableProps, provided.dragHandleProps, itemProps, { \"$isDraggable\": true, \"$isDragging\": true, style: __assign(__assign(__assign({}, provided.draggableProps.style), props.style), { zIndex: props.cloneZIndex }) }),\n        React.createElement(StyledGrip, null,\n            React.createElement(Grip, { color: colors.gray45 })),\n        itemChildren));\n};\nexport var Item = React.forwardRef(function Item(_a, forwardRef) {\n    var _b = _a.children, children = _b === void 0 ? null : _b, _c = _a.item, item = _c === void 0 ? null : _c, _d = _a.onClick, onClick_ = _d === void 0 ? noop : _d, _e = _a.selected, selected = _e === void 0 ? false : _e, _f = _a.suggested, suggested = _f === void 0 ? false : _f, _g = _a.disabled, disabled = _g === void 0 ? false : _g, props = __rest(_a, [\"children\", \"item\", \"onClick\", \"selected\", \"suggested\", \"disabled\"]);\n    var _h = useMergeRef(forwardRef), ref = _h[0], setRef = _h[1];\n    var ctx = useMenuContext();\n    var onClick = React.useCallback(function (event) {\n        if (disabled)\n            return;\n        onClick_(event);\n        ctx.onSelect({\n            item: item,\n            event: event,\n            group: false,\n            action: selected ? 'unselected' : 'selected',\n        });\n    }, [ctx, item, onClick_, disabled, selected]);\n    var itemProps = __assign(__assign({}, props), { onClick: onClick, onMouseMove: function (e) { return ctx.onHoverItem(e.currentTarget); }, 'data-group': false, 'data-value': JSON.stringify(item), 'data-selected': selected, 'data-suggested': suggested, 'data-disabled': disabled, $disabled: disabled, $selected: selected });\n    if ('droppableIn' in props &&\n        'draggableId' in props &&\n        'draggableIndex' in props) {\n        // encoding id and valid droppables as the draggableId, so we can use them to determine where this item can be dropped\n        var droppableInfo = {\n            draggableId: props.draggableId,\n            droppableIn: Array.isArray(props.droppableIn)\n                ? props.droppableIn\n                : [props.droppableIn],\n        };\n        return (React.createElement(Draggable, { draggableId: JSON.stringify(droppableInfo), index: props.draggableIndex, isDragDisabled: disabled }, function (provided) { return (React.createElement(StyledItem, __assign({ ref: mergeRefs(provided.innerRef, setRef) }, provided.draggableProps, provided.dragHandleProps, itemProps, { \"$isDraggable\": !disabled, style: __assign(__assign({}, provided.draggableProps.style), itemProps.style), tabIndex: -1 }),\n            !disabled && (React.createElement(StyledGrip, null,\n                React.createElement(Grip, { color: colors.gray45 }))),\n            children)); }));\n    }\n    return (React.createElement(StyledItem, __assign({ ref: setRef }, itemProps), children));\n});\nexport var CheckboxItem = React.forwardRef(function CheckboxItem(_a, forwardRef) {\n    var _b = _a.selected, selected = _b === void 0 ? false : _b, _c = _a.disabled, disabled = _c === void 0 ? false : _c, _d = _a.error, error = _d === void 0 ? false : _d, _e = _a.indeterminate, indeterminate = _e === void 0 ? false : _e, _f = _a.children, children = _f === void 0 ? null : _f, props = __rest(_a, [\"selected\", \"disabled\", \"error\", \"indeterminate\", \"children\"]);\n    function onCheckboxClick(event) {\n        event.stopPropagation();\n    }\n    return (React.createElement(Item, __assign({}, props, { selected: selected, disabled: disabled, ref: forwardRef }),\n        React.createElement(Checkbox, { indeterminate: indeterminate, error: error, disabled: disabled, checked: selected, onClick: onCheckboxClick, onChange: noop, tabIndex: -1 }, children)));\n});\nexport var Options = React.forwardRef(function Options(props, ref) {\n    var ctx = useMenuContext();\n    return (React.createElement(StyledOptions, __assign({}, props, { ref: ref, onScroll: ctx.onScrollBottom, tabIndex: 0 })));\n});\n// TODO change this component to render out a Typeahead instead of\n// the deprecated Search with typeahead prop\nexport var Search = function (_a) {\n    var className = _a.className, _b = _a.i18nScope, i18nScope = _b === void 0 ? 'core.menu' : _b, placeholder = _a.placeholder, props = __rest(_a, [\"className\", \"i18nScope\", \"placeholder\"]);\n    var I18n = useI18nContext();\n    return (React.createElement(StyledSearch, { className: className },\n        React.createElement(SearchBase, __assign({}, props, { autoFocus: true, placeholder: placeholder || I18n.t('search', { scope: i18nScope }), typeahead: true }))));\n};\nexport var Header = React.forwardRef(function Header(_a, ref) {\n    var props = __rest(_a, []);\n    return React.createElement(StyledHeader, __assign({ ref: ref }, props));\n});\nexport var Footer = React.forwardRef(function Footer(_a, ref) {\n    var _b = _a.padding, padding = _b === void 0 ? 'md lg' : _b, props = __rest(_a, [\"padding\"]);\n    return React.createElement(StyledFooter, __assign({ ref: ref, padding: padding }, props));\n});\nMenuImperative_.displayName = 'Menu';\nDroppable.displayName = 'Menu.Droppable';\nFooter.displayName = 'Menu.Footer';\nGroup.displayName = 'Menu.Group';\nHeader.displayName = 'Menu.Header';\nItem.displayName = 'Menu.Item';\nOptions.displayName = 'Menu.Options';\nSearch.displayName = 'Menu.Search';\nexport var MenuImperative = addSubcomponents({\n    CheckboxItem: CheckboxItem,\n    Droppable: Droppable,\n    Footer: Footer,\n    Group: Group,\n    Header: Header,\n    Item: Item,\n    Options: Options,\n    Search: Search,\n}, MenuImperative_);\n"]},"metadata":{},"sourceType":"module"}