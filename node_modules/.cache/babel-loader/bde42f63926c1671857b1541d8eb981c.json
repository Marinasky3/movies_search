{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport React, { forwardRef, useMemo, useState } from 'react';\nimport { Building, People } from '@procore/core-icons/dist';\nimport { Modal } from '../Modal';\nimport { Avatar } from '../Avatar';\nimport { Button } from '../Button';\nimport { ContactItem } from '../ContactItem';\nimport { Link } from '../Link';\nimport { Popover } from '../Popover';\nimport { Typography } from '../Typography';\nimport { StyledAvatar, StyledViewAllWrapper, StyledWrapper, StyledContactItems, StyledViewAll, StyledModalBody, StyledContactItem } from './AvatarStack.styles';\nimport { colorsOrder, foldedItemsCap, restCountThreshold, visibleItemsCap } from './AvatarStack.constants';\nimport { useI18nContext } from '../../state/I18n';\nexport var getOverflowValues = function (items) {\n  var foldedItems = [];\n  var restCountLabel = null;\n  var isViewAllNeeded = false;\n  var visibleItems = items.length > visibleItemsCap ? items.slice(0, visibleItemsCap - 1) : items;\n  var restItemsCount = items.length - visibleItems.length;\n\n  if (restItemsCount > 0) {\n    foldedItems = items.slice(visibleItems.length, visibleItems.length + foldedItemsCap);\n    restCountLabel = restItemsCount > restCountThreshold ? \"\".concat(restCountThreshold, \"+\") : \"+\".concat(restItemsCount);\n    isViewAllNeeded = restItemsCount > foldedItemsCap;\n  }\n\n  return {\n    visibleItems: visibleItems,\n    foldedItems: foldedItems,\n    restCountLabel: restCountLabel,\n    isViewAllNeeded: isViewAllNeeded\n  };\n};\nexport function getIcon(type, size) {\n  switch (type) {\n    case 'company':\n      return React.createElement(Building, {\n        size: size\n      });\n\n    case 'group':\n      return React.createElement(People, {\n        size: size\n      });\n\n    case 'user':\n    default:\n      return null;\n  }\n}\n\nfunction getContactIcon(type) {\n  return getIcon(type, 'md');\n}\n\nfunction getAvatarIcon(type, size) {\n  var avatarSize = size === 'lg' ? 'md' : 'sm';\n  return getIcon(type, avatarSize);\n}\n\nexport function getColorOrder(avatarItems) {\n  return avatarItems.reduce(function (_a, item) {\n    var map = _a.map,\n        color = _a.color;\n\n    if (item.imageUrl) {\n      return {\n        map: map,\n        color: color\n      };\n    }\n\n    if (item.inactive) {\n      map.set(item.id, 'gray70');\n      return {\n        map: map,\n        color: color\n      };\n    }\n\n    map.set(item.id, color);\n    var currentColorIndex = colorsOrder.indexOf(color);\n    var nextColorIndex = (currentColorIndex + 1) % colorsOrder.length;\n    return {\n      map: map,\n      color: item.imageUrl ? color : colorsOrder[nextColorIndex]\n    };\n  }, {\n    map: new Map(),\n    color: colorsOrder[0]\n  }).map;\n}\nexport function AvatarStackContactItem(_a) {\n  var item = _a.item,\n      _b = _a.item,\n      id = _b.id,\n      type = _b.type,\n      imageUrl = _b.imageUrl,\n      initials = _b.initials,\n      inactive = _b.inactive,\n      name = _b.name,\n      linkUrl = _b.linkUrl;\n  return React.createElement(StyledContactItem, {\n    key: id,\n    imageUrl: imageUrl,\n    initials: initials,\n    icon: getContactIcon(type),\n    disabled: inactive\n  }, React.createElement(ContactItem.Title, null, !inactive && linkUrl ? React.createElement(Link, {\n    href: linkUrl\n  }, name) : name), React.createElement(ContactItem.Description, null, item.type === 'group' ? React.createElement(Typography, {\n    color: \"gray15\"\n  }, item.description) : item.description));\n}\nexport function AvatarContent(_a) {\n  var item = _a.item,\n      size = _a.size;\n  var avatarIcon = getAvatarIcon(item.type, size);\n\n  if (item.type === 'user' && item.imageUrl) {\n    return React.createElement(Avatar.Portrait, {\n      imageUrl: item.imageUrl\n    });\n  }\n\n  if (avatarIcon) {\n    return React.createElement(Avatar.Icon, {\n      icon: avatarIcon\n    });\n  }\n\n  if (item.initials) {\n    return React.createElement(Avatar.Label, null, item.initials);\n  }\n\n  return null;\n}\nexport function BaseAvatarStack(_a) {\n  var items = _a.items,\n      size = _a.size,\n      colors = _a.colors;\n  return React.createElement(React.Fragment, null, items.map(function (item) {\n    return React.createElement(Popover, {\n      key: item.id,\n      trigger: \"hover\",\n      overlay: React.createElement(Popover.Content, null, React.createElement(AvatarStackContactItem, {\n        item: item\n      }))\n    }, React.createElement(StyledAvatar, {\n      clickable: true,\n      size: size,\n      \"$color\": colors.get(item.id),\n      disabled: item.inactive\n    }, React.createElement(AvatarContent, {\n      item: item,\n      size: size\n    })));\n  }));\n}\nexport function FoldedAvatarStack(_a) {\n  var items = _a.items,\n      onClickViewAll = _a.onClickViewAll,\n      size = _a.size,\n      restCountLabel = _a.restCountLabel,\n      isViewAllNeeded = _a.isViewAllNeeded;\n  var I18n = useI18nContext();\n  return React.createElement(Popover, {\n    trigger: \"hover\",\n    overlay: React.createElement(Popover.Content, null, React.createElement(StyledContactItems, null, items.map(function (item) {\n      return React.createElement(AvatarStackContactItem, {\n        key: item.id,\n        item: item\n      });\n    })), isViewAllNeeded && React.createElement(StyledViewAllWrapper, null, React.createElement(StyledViewAll, {\n      \"data-qa\": \"core-avatar-stack-view-all-modal-trigger\",\n      color: \"blue50\",\n      onClick: onClickViewAll\n    }, I18n.t('core.avatarStack.viewAll'))))\n  }, React.createElement(StyledAvatar, {\n    \"data-qa\": \"core-avatar-stack-folded-avatars-popover-trigger\",\n    size: size,\n    \"$color\": \"gray85\",\n    clickable: true\n  }, React.createElement(Avatar.Label, null, React.createElement(Typography, {\n    color: \"black\"\n  }, restCountLabel))));\n}\nexport var ViewAllModal = function (_a) {\n  var isOpen = _a.isOpen,\n      onClose = _a.onClose,\n      title = _a.title,\n      items = _a.items;\n  var I18n = useI18nContext();\n  return React.createElement(Modal, {\n    open: isOpen\n  }, React.createElement(Modal.Header, {\n    onClose: onClose\n  }, title, \" (\", items.length, \")\"), React.createElement(StyledModalBody, null, items.map(function (item) {\n    return React.createElement(AvatarStackContactItem, {\n      key: item.id,\n      item: item\n    });\n  })), React.createElement(Modal.Footer, null, React.createElement(Modal.FooterButtons, null, React.createElement(Button, {\n    onClick: onClose\n  }, I18n.t('core.avatarStack.close')))));\n};\nexport var AvatarStack = forwardRef(function AvatarStack(_a, ref) {\n  var items = _a.items,\n      title = _a.title,\n      _b = _a.size,\n      size = _b === void 0 ? 'lg' : _b,\n      props = __rest(_a, [\"items\", \"title\", \"size\"]);\n\n  var _c = useState(false),\n      isModalOpen = _c[0],\n      setIsModalOpen = _c[1];\n\n  var _d = useMemo(function () {\n    return getOverflowValues(items);\n  }, [items]),\n      visibleItems = _d.visibleItems,\n      foldedItems = _d.foldedItems,\n      restCountLabel = _d.restCountLabel,\n      isViewAllNeeded = _d.isViewAllNeeded;\n\n  var visibleItemsColors = useMemo(function () {\n    return getColorOrder(visibleItems);\n  }, [visibleItems]);\n  return React.createElement(\"div\", __assign({\n    ref: ref\n  }, props), isViewAllNeeded && React.createElement(ViewAllModal, {\n    isOpen: isModalOpen,\n    onClose: function () {\n      return setIsModalOpen(false);\n    },\n    title: title,\n    items: items\n  }), React.createElement(StyledWrapper, null, React.createElement(BaseAvatarStack, {\n    items: visibleItems,\n    colors: visibleItemsColors,\n    size: size\n  }), foldedItems.length > 0 && React.createElement(FoldedAvatarStack, {\n    restCountLabel: restCountLabel,\n    isViewAllNeeded: isViewAllNeeded,\n    items: foldedItems,\n    onClickViewAll: function () {\n      return setIsModalOpen(true);\n    },\n    size: size\n  })));\n});\nAvatarStack.displayName = 'AvatarStack';","map":{"version":3,"sources":["../../../../src/components/AvatarStack/AvatarStack.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React, { forwardRef, useMemo, useState } from 'react';\nimport { Building, People } from '@procore/core-icons/dist';\nimport { Modal } from '../Modal';\nimport { Avatar } from '../Avatar';\nimport { Button } from '../Button';\nimport { ContactItem } from '../ContactItem';\nimport { Link } from '../Link';\nimport { Popover } from '../Popover';\nimport { Typography } from '../Typography';\nimport { StyledAvatar, StyledViewAllWrapper, StyledWrapper, StyledContactItems, StyledViewAll, StyledModalBody, StyledContactItem, } from './AvatarStack.styles';\nimport { colorsOrder, foldedItemsCap, restCountThreshold, visibleItemsCap, } from './AvatarStack.constants';\nimport { useI18nContext } from '../../state/I18n';\nexport var getOverflowValues = function (items) {\n    var foldedItems = [];\n    var restCountLabel = null;\n    var isViewAllNeeded = false;\n    var visibleItems = items.length > visibleItemsCap ? items.slice(0, visibleItemsCap - 1) : items;\n    var restItemsCount = items.length - visibleItems.length;\n    if (restItemsCount > 0) {\n        foldedItems = items.slice(visibleItems.length, visibleItems.length + foldedItemsCap);\n        restCountLabel =\n            restItemsCount > restCountThreshold\n                ? \"\".concat(restCountThreshold, \"+\")\n                : \"+\".concat(restItemsCount);\n        isViewAllNeeded = restItemsCount > foldedItemsCap;\n    }\n    return {\n        visibleItems: visibleItems,\n        foldedItems: foldedItems,\n        restCountLabel: restCountLabel,\n        isViewAllNeeded: isViewAllNeeded,\n    };\n};\nexport function getIcon(type, size) {\n    switch (type) {\n        case 'company':\n            return React.createElement(Building, { size: size });\n        case 'group':\n            return React.createElement(People, { size: size });\n        case 'user':\n        default:\n            return null;\n    }\n}\nfunction getContactIcon(type) {\n    return getIcon(type, 'md');\n}\nfunction getAvatarIcon(type, size) {\n    var avatarSize = size === 'lg' ? 'md' : 'sm';\n    return getIcon(type, avatarSize);\n}\nexport function getColorOrder(avatarItems) {\n    return avatarItems.reduce(function (_a, item) {\n        var map = _a.map, color = _a.color;\n        if (item.imageUrl) {\n            return {\n                map: map,\n                color: color,\n            };\n        }\n        if (item.inactive) {\n            map.set(item.id, 'gray70');\n            return {\n                map: map,\n                color: color,\n            };\n        }\n        map.set(item.id, color);\n        var currentColorIndex = colorsOrder.indexOf(color);\n        var nextColorIndex = (currentColorIndex + 1) % colorsOrder.length;\n        return {\n            map: map,\n            color: item.imageUrl ? color : colorsOrder[nextColorIndex],\n        };\n    }, {\n        map: new Map(),\n        color: colorsOrder[0],\n    }).map;\n}\nexport function AvatarStackContactItem(_a) {\n    var item = _a.item, _b = _a.item, id = _b.id, type = _b.type, imageUrl = _b.imageUrl, initials = _b.initials, inactive = _b.inactive, name = _b.name, linkUrl = _b.linkUrl;\n    return (React.createElement(StyledContactItem, { key: id, imageUrl: imageUrl, initials: initials, icon: getContactIcon(type), disabled: inactive },\n        React.createElement(ContactItem.Title, null, !inactive && linkUrl ? React.createElement(Link, { href: linkUrl }, name) : name),\n        React.createElement(ContactItem.Description, null, item.type === 'group' ? (React.createElement(Typography, { color: \"gray15\" }, item.description)) : (item.description))));\n}\nexport function AvatarContent(_a) {\n    var item = _a.item, size = _a.size;\n    var avatarIcon = getAvatarIcon(item.type, size);\n    if (item.type === 'user' && item.imageUrl) {\n        return React.createElement(Avatar.Portrait, { imageUrl: item.imageUrl });\n    }\n    if (avatarIcon) {\n        return React.createElement(Avatar.Icon, { icon: avatarIcon });\n    }\n    if (item.initials) {\n        return React.createElement(Avatar.Label, null, item.initials);\n    }\n    return null;\n}\nexport function BaseAvatarStack(_a) {\n    var items = _a.items, size = _a.size, colors = _a.colors;\n    return (React.createElement(React.Fragment, null, items.map(function (item) {\n        return (React.createElement(Popover, { key: item.id, trigger: \"hover\", overlay: React.createElement(Popover.Content, null,\n                React.createElement(AvatarStackContactItem, { item: item })) },\n            React.createElement(StyledAvatar, { clickable: true, size: size, \"$color\": colors.get(item.id), disabled: item.inactive },\n                React.createElement(AvatarContent, { item: item, size: size }))));\n    })));\n}\nexport function FoldedAvatarStack(_a) {\n    var items = _a.items, onClickViewAll = _a.onClickViewAll, size = _a.size, restCountLabel = _a.restCountLabel, isViewAllNeeded = _a.isViewAllNeeded;\n    var I18n = useI18nContext();\n    return (React.createElement(Popover, { trigger: \"hover\", overlay: React.createElement(Popover.Content, null,\n            React.createElement(StyledContactItems, null, items.map(function (item) { return (React.createElement(AvatarStackContactItem, { key: item.id, item: item })); })),\n            isViewAllNeeded && (React.createElement(StyledViewAllWrapper, null,\n                React.createElement(StyledViewAll, { \"data-qa\": \"core-avatar-stack-view-all-modal-trigger\", color: \"blue50\", onClick: onClickViewAll }, I18n.t('core.avatarStack.viewAll'))))) },\n        React.createElement(StyledAvatar, { \"data-qa\": \"core-avatar-stack-folded-avatars-popover-trigger\", size: size, \"$color\": \"gray85\", clickable: true },\n            React.createElement(Avatar.Label, null,\n                React.createElement(Typography, { color: \"black\" }, restCountLabel)))));\n}\nexport var ViewAllModal = function (_a) {\n    var isOpen = _a.isOpen, onClose = _a.onClose, title = _a.title, items = _a.items;\n    var I18n = useI18nContext();\n    return (React.createElement(Modal, { open: isOpen },\n        React.createElement(Modal.Header, { onClose: onClose },\n            title,\n            \" (\",\n            items.length,\n            \")\"),\n        React.createElement(StyledModalBody, null, items.map(function (item) { return (React.createElement(AvatarStackContactItem, { key: item.id, item: item })); })),\n        React.createElement(Modal.Footer, null,\n            React.createElement(Modal.FooterButtons, null,\n                React.createElement(Button, { onClick: onClose }, I18n.t('core.avatarStack.close'))))));\n};\nexport var AvatarStack = forwardRef(function AvatarStack(_a, ref) {\n    var items = _a.items, title = _a.title, _b = _a.size, size = _b === void 0 ? 'lg' : _b, props = __rest(_a, [\"items\", \"title\", \"size\"]);\n    var _c = useState(false), isModalOpen = _c[0], setIsModalOpen = _c[1];\n    var _d = useMemo(function () { return getOverflowValues(items); }, [items]), visibleItems = _d.visibleItems, foldedItems = _d.foldedItems, restCountLabel = _d.restCountLabel, isViewAllNeeded = _d.isViewAllNeeded;\n    var visibleItemsColors = useMemo(function () { return getColorOrder(visibleItems); }, [visibleItems]);\n    return (React.createElement(\"div\", __assign({ ref: ref }, props),\n        isViewAllNeeded && (React.createElement(ViewAllModal, { isOpen: isModalOpen, onClose: function () { return setIsModalOpen(false); }, title: title, items: items })),\n        React.createElement(StyledWrapper, null,\n            React.createElement(BaseAvatarStack, { items: visibleItems, colors: visibleItemsColors, size: size }),\n            foldedItems.length > 0 && (React.createElement(FoldedAvatarStack, { restCountLabel: restCountLabel, isViewAllNeeded: isViewAllNeeded, items: foldedItems, onClickViewAll: function () { return setIsModalOpen(true); }, size: size })))));\n});\nAvatarStack.displayName = 'AvatarStack';\n"]},"metadata":{},"sourceType":"module"}