{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { Clear } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { useEventListener } from '../../effects/EventListener';\nimport { useDateTime } from '../../state/DateTime';\nimport { useI18nContext } from '../../state/I18n';\nimport { maxMonth, maxYear, minYear, normalizeNewDate } from '../../utils/CalendarHelpers';\nimport Button from '../Button';\nimport { StyledCalendar, StyledDateInput, StyledDateInputDelimiter, StyledDateInputIconContainer, StyledDateInputSegment } from './DateInput.styles';\nvar segments = {\n  day: {\n    maxLength: 2,\n    placeholder: 'dd'\n  },\n  month: {\n    maxLength: 2,\n    placeholder: 'mm'\n  },\n  year: {\n    maxLength: 4,\n    placeholder: 'yyyy'\n  }\n};\nvar dateInputLocales = {\n  en: {\n    segments: ['month', 'day', 'year']\n  },\n  'en-CA': {\n    segments: ['month', 'day', 'year']\n  },\n  'fr-CA': {\n    segments: ['day', 'month', 'year']\n  },\n  'fr-FR': {\n    segments: ['day', 'month', 'year']\n  },\n  es: {\n    segments: ['day', 'month', 'year']\n  },\n  'es-ES': {\n    segments: ['day', 'month', 'year']\n  },\n  'en-AE': {\n    segments: ['day', 'month', 'year']\n  },\n  'en-AU': {\n    segments: ['day', 'month', 'year']\n  },\n  'en-GB': {\n    segments: ['day', 'month', 'year']\n  },\n  'en-SG': {\n    segments: ['day', 'month', 'year']\n  },\n  ko: {\n    segments: ['year', 'month', 'day']\n  },\n  'th-TH': {\n    segments: ['day', 'month', 'year']\n  },\n  pt: {\n    segments: ['day', 'month', 'year']\n  },\n  'is-IS': {\n    segments: ['day', 'month', 'year']\n  },\n  'de-DE': {\n    delimiter: '.',\n    segments: ['day', 'month', 'year']\n  },\n  pseudo: {\n    segments: ['day', 'month', 'year']\n  }\n};\nexport function isValidYearRange(year) {\n  return year > 1700 && year < 2122;\n}\n\nfunction noop() {}\n\nfunction getLastDate(month, year) {\n  return normalizeNewDate(year, Math.max(0, month), 0).getDate();\n}\n\nfunction getSegmentProps(onChangeSegment, type, dateInput, getAriaLabel) {\n  var _a = segments[type],\n      maxLength = _a.maxLength,\n      placeholder = _a.placeholder;\n\n  if (type === 'day') {\n    return {\n      'aria-label': getAriaLabel('day', dateInput.day),\n      maxLength: maxLength,\n      maxValue: getLastDate(dateInput.month, dateInput.year),\n      minValue: 1,\n      onChange: function (value) {\n        dateInput.setDay(value);\n        onChangeSegment(type, value);\n      },\n      placeholder: placeholder,\n      value: dateInput.day\n    };\n  } else if (type === 'month') {\n    return {\n      'aria-label': getAriaLabel('month', dateInput.month),\n      maxLength: maxLength,\n      maxValue: maxMonth,\n      minValue: 1,\n      onChange: function (value) {\n        dateInput.setMonth(value);\n        onChangeSegment(type, value);\n      },\n      placeholder: placeholder,\n      value: dateInput.month\n    };\n  } else {\n    return {\n      'aria-label': getAriaLabel('year', dateInput.year),\n      maxLength: maxLength,\n      maxValue: maxYear,\n      minValue: minYear,\n      onChange: function (value) {\n        dateInput.setYear(value);\n        onChangeSegment(type, value);\n      },\n      placeholder: placeholder,\n      value: dateInput.year\n    };\n  }\n}\n\nfunction setFocusTo(target) {\n  return target && target.current && target.current.focus();\n}\n\nfunction focusTargetOrFirst() {\n  var refs = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    refs[_i] = arguments[_i];\n  }\n\n  return function handler(event) {\n    if (event === void 0) {\n      event = {\n        target: null\n      };\n    }\n\n    var ref = refs.reduce(function (acc, ref) {\n      return ref.current && ref.current === event.target ? ref : acc;\n    }, refs[0]);\n    setFocusTo(ref);\n  };\n}\n\nfunction clampDay(day, month, year) {\n  if (day > 0 && month > 0 && year) {\n    var date = normalizeNewDate(year, month - 1, day);\n\n    if (date.getMonth() !== month - 1) {\n      return getLastDate(month, year);\n    }\n  }\n\n  return day;\n}\n\nfunction useDateInput(_a) {\n  var onChange = _a.onChange,\n      value_ = _a.value,\n      log = _a.log;\n  var dateTime = useDateTime(); // logging called too frequenlty if not in memo\n\n  var value = React.useMemo(function () {\n    return dateTime.shiftUtcToZonedTime(value_, log);\n  }, [value_]);\n\n  var _b = React.useState(value ? value.getDate() : -1),\n      day = _b[0],\n      setRawDay = _b[1];\n\n  var _c = React.useState(value ? value.getMonth() + 1 : -1),\n      month = _c[0],\n      setRawMonth = _c[1];\n\n  var _d = React.useState(value ? value.getFullYear() : -1),\n      year = _d[0],\n      setRawYear = _d[1];\n\n  var hasValues = day >= 0 || month >= 0 || year >= 0;\n  var isInvalid = day < 0 || month < 0 || year < 0;\n\n  var setAll = function (day, month, year) {\n    var clampedDay = clampDay(day, month, year);\n    var date = clampedDay > 0 && month > 0 && year > 0 ? normalizeNewDate(year, month - 1, clampedDay) : null;\n    setRawDay(clampedDay);\n    setRawMonth(month);\n    setRawYear(year); // Call DateSelect.onChange API when a supported year range or deleted date\n    // isValidYearRange protects shiftZonedTimeToUtc\n    // when date is null, year should be -1. -1 means it was cleared, either by button or backspace key\n\n    if (isValidYearRange(year) || date === null) {\n      onChange(dateTime.shiftZonedTimeToUtc(date));\n    }\n  };\n\n  var setDay = function (value) {\n    setAll(value, month, year);\n  };\n\n  var setMonth = function (value) {\n    setAll(day, value, year);\n  };\n\n  var setYear = function (value) {\n    setAll(day, month, value);\n  };\n\n  var clear = function () {\n    setAll(-1, -1, -1);\n  };\n\n  React.useEffect(function () {\n    if (value) {\n      setRawDay(value.getDate());\n      setRawMonth(value.getMonth() + 1);\n      setRawYear(value.getFullYear());\n    }\n  }, [value]);\n  return {\n    clear: clear,\n    day: day,\n    hasValues: hasValues,\n    month: month,\n    setDay: setDay,\n    setMonth: setMonth,\n    setYear: setYear,\n    year: year\n  };\n}\n\nfunction getSegmentText(_a) {\n  var maxLength = _a.maxLength,\n      placeholder = _a.placeholder,\n      type = _a.type,\n      value = _a.value;\n\n  if (value < 0) {\n    return placeholder;\n  }\n\n  if (type === 'year' && !isValidYearRange(value)) {\n    return \"\".concat(value, \"____\").slice(0, 4);\n  }\n\n  return String(value).padStart(maxLength, '0');\n}\n\nvar DateSegment = React.forwardRef(function DateSegment(_a, ref) {\n  var _b = _a.disabled,\n      disabled = _b === void 0 ? false : _b,\n      maxLength = _a.maxLength,\n      maxValue = _a.maxValue,\n      minValue = _a.minValue,\n      nextRef = _a.nextRef,\n      _c = _a.onChange,\n      onChange = _c === void 0 ? function (value) {} : _c,\n      placeholder = _a.placeholder,\n      prevRef = _a.prevRef,\n      _d = _a.tabIndex,\n      tabIndex = _d === void 0 ? 0 : _d,\n      type = _a.type,\n      _e = _a.value,\n      value = _e === void 0 ? 0 : _e,\n      props = __rest(_a, [\"disabled\", \"maxLength\", \"maxValue\", \"minValue\", \"nextRef\", \"onChange\", \"placeholder\", \"prevRef\", \"tabIndex\", \"type\", \"value\"]);\n\n  var _f = React.useState(''),\n      keyBuffer = _f[0],\n      setKeyBuffer = _f[1];\n\n  var contains = function (key, keys) {\n    return keys.indexOf(key) >= 0;\n  };\n\n  var onKeyDown = function (event) {\n    event.stopPropagation();\n    var key = event.key;\n\n    if (contains(key, ['Up', 'ArrowUp', 'Down', 'ArrowDown', 'Backspace'])) {\n      event.preventDefault();\n    }\n\n    if (contains(key, ['Up', 'ArrowUp', 'Down', 'ArrowDown']) && type === 'year' && value === -1) {\n      onChange(new Date().getFullYear());\n    } else if (contains(key, ['Up', 'ArrowUp'])) {\n      onChange(value + 1 > maxValue ? minValue : Math.max(1, value + 1));\n    } else if (contains(key, ['Down', 'ArrowDown'])) {\n      onChange(value - 1 < minValue ? maxValue : value - 1);\n    } else if (contains(key, ['Left', 'ArrowLeft'])) {\n      setFocusTo(prevRef);\n    } else if (contains(key, ['Right', 'ArrowRight'])) {\n      setFocusTo(nextRef);\n    } else if (contains(key, ['Backspace', 'Delete'])) {\n      setKeyBuffer('');\n      onChange(-1); // the segment is currently empty, go to the previous segment\n\n      if (value === -1) {\n        setFocusTo(prevRef);\n      }\n    } else if (!isNaN(parseInt(key, 10))) {\n      if (keyBuffer.length === 0) {\n        // current buffer is empty, initialize it\n        setKeyBuffer(key);\n        onChange(parseInt(key, 10));\n      } else {\n        // current buffer has text, add to it\n        var newBuffer = keyBuffer + key;\n        setKeyBuffer(newBuffer);\n        onChange(Math.min(parseInt(newBuffer, 10), maxValue));\n      }\n    }\n  };\n\n  React.useEffect(function () {\n    if (keyBuffer.length >= maxLength || keyBuffer.length === 1 && (type === 'day' && value > 3 || type === 'month' && value > 1)) {\n      setFocusTo(nextRef); // Needed for year to reset as it does not move focus\n\n      setKeyBuffer('');\n    }\n  });\n  return React.createElement(StyledDateInputSegment, __assign({\n    ref: ref\n  }, props, {\n    \"data-placeholder\": value < 0,\n    disabled: disabled,\n    isYear: type === 'year',\n    onBlur: function () {\n      if (value !== -1) {\n        var val = type === 'year' && value < 100 ? 2000 + value : value;\n        onChange(val);\n      }\n\n      setKeyBuffer('');\n    },\n    onKeyDown: onKeyDown,\n    tabIndex: disabled ? -1 : tabIndex\n  }), getSegmentText({\n    value: value,\n    placeholder: placeholder,\n    type: type,\n    maxLength: maxLength\n  }));\n});\nexport var DateInput = React.forwardRef(function DateInput(_a, ref) {\n  var clearRef = _a.clearRef,\n      disabled = _a.disabled,\n      _b = _a.error,\n      error = _b === void 0 ? false : _b,\n      _c = _a.segmentRefs,\n      segmentRefs = _c === void 0 ? {} : _c,\n      variant = _a.variant,\n      _d = _a.onChange,\n      onChange = _d === void 0 ? noop : _d,\n      _e = _a.onChangeSegment,\n      onChangeSegment = _e === void 0 ? noop : _e,\n      _f = _a.onClear,\n      onClear = _f === void 0 ? noop : _f,\n      _g = _a.tabIndex,\n      tabIndex = _g === void 0 ? 0 : _g,\n      value = _a.value,\n      props = __rest(_a, [\"clearRef\", \"disabled\", \"error\", \"segmentRefs\", \"variant\", \"onChange\", \"onChangeSegment\", \"onClear\", \"tabIndex\", \"value\"]);\n\n  var I18n = useI18nContext();\n  var dateInputRef = ref;\n  var segment1Ref = segmentRefs.segmentOne || React.createRef();\n  var segment2Ref = segmentRefs.segmentTwo || React.createRef();\n  var segment3Ref = segmentRefs.segmentThree || React.createRef();\n\n  var _h = dateInputLocales[I18n.locale] || dateInputLocales['en'],\n      _j = _h.delimiter,\n      delimiter = _j === void 0 ? '/' : _j,\n      segments = _h.segments;\n\n  var dateTime = useDateTime();\n  var dateInput = useDateInput({\n    onChange: onChange,\n    value: value,\n    log: 'Display date'\n  });\n\n  var onClickClear = function (e) {\n    setFocusTo(segment1Ref);\n    dateInput.clear();\n    onClear(e);\n  };\n\n  useEventListener({\n    event: 'click',\n    handler: focusTargetOrFirst(segment1Ref, segment2Ref, segment3Ref),\n    scope: dateInputRef\n  });\n\n  var getSegmentAriaLabel = function (type, value) {\n    return value && value !== -1 ? I18n.t(type, {\n      value: value,\n      scope: 'core.dateInput.segment.ariaLabel.withValue'\n    }) : I18n.t(type, {\n      scope: 'core.dateInput.segment.ariaLabel.withoutValue'\n    });\n  };\n\n  return React.createElement(StyledDateInput, __assign({\n    \"aria-label\": value && isValidYearRange(dateInput.year) ? dateTime.format(dateTime.newDate(dateInput.year, // @ts-ignore\n    dateInput.month - 1, dateInput.day), 'weekday-date') : undefined,\n    disabled: disabled || variant === 'disabled',\n    error: error || variant === 'error' || // -1 means placeholder yyyy is shown\n    !isValidYearRange(dateInput.year) && dateInput.year !== -1,\n    ref: dateInputRef\n  }, props), React.createElement(DateSegment, __assign({\n    disabled: disabled,\n    nextRef: segment2Ref,\n    ref: segment1Ref,\n    tabIndex: tabIndex,\n    type: segments[0]\n  }, getSegmentProps(onChangeSegment, segments[0], dateInput, getSegmentAriaLabel))), React.createElement(StyledDateInputDelimiter, {\n    \"aria-hidden\": true,\n    visible: Boolean(value)\n  }, delimiter), React.createElement(DateSegment, __assign({\n    disabled: disabled,\n    nextRef: segment3Ref,\n    prevRef: segment1Ref,\n    ref: segment2Ref,\n    tabIndex: tabIndex,\n    type: segments[1]\n  }, getSegmentProps(onChangeSegment, segments[1], dateInput, getSegmentAriaLabel))), React.createElement(StyledDateInputDelimiter, {\n    \"aria-hidden\": true,\n    visible: Boolean(value)\n  }, delimiter), React.createElement(DateSegment, __assign({\n    disabled: disabled,\n    prevRef: segment2Ref,\n    ref: segment3Ref,\n    tabIndex: tabIndex,\n    type: segments[2]\n  }, getSegmentProps(onChangeSegment, segments[2], dateInput, getSegmentAriaLabel))), React.createElement(StyledDateInputIconContainer, null, dateInput.hasValues ? React.createElement(Button, {\n    \"aria-label\": I18n.t('core.dateInput.clearButton.ariaLabel'),\n    onClick: onClickClear,\n    ref: clearRef,\n    size: \"sm\",\n    variant: \"tertiary\",\n    icon: React.createElement(Clear, {\n      size: \"sm\"\n    }),\n    tabIndex: -1\n  }) : React.createElement(StyledCalendar, null)));\n});\nDateInput.displayName = 'DateInput';\nexport default DateInput;","map":{"version":3,"sources":["../../../../src/components/DateInput/DateInput.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { Clear } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { useEventListener } from '../../effects/EventListener';\nimport { useDateTime } from '../../state/DateTime';\nimport { useI18nContext } from '../../state/I18n';\nimport { maxMonth, maxYear, minYear, normalizeNewDate, } from '../../utils/CalendarHelpers';\nimport Button from '../Button';\nimport { StyledCalendar, StyledDateInput, StyledDateInputDelimiter, StyledDateInputIconContainer, StyledDateInputSegment, } from './DateInput.styles';\nvar segments = {\n    day: {\n        maxLength: 2,\n        placeholder: 'dd',\n    },\n    month: {\n        maxLength: 2,\n        placeholder: 'mm',\n    },\n    year: {\n        maxLength: 4,\n        placeholder: 'yyyy',\n    },\n};\nvar dateInputLocales = {\n    en: {\n        segments: ['month', 'day', 'year'],\n    },\n    'en-CA': {\n        segments: ['month', 'day', 'year'],\n    },\n    'fr-CA': {\n        segments: ['day', 'month', 'year'],\n    },\n    'fr-FR': {\n        segments: ['day', 'month', 'year'],\n    },\n    es: {\n        segments: ['day', 'month', 'year'],\n    },\n    'es-ES': {\n        segments: ['day', 'month', 'year'],\n    },\n    'en-AE': {\n        segments: ['day', 'month', 'year'],\n    },\n    'en-AU': {\n        segments: ['day', 'month', 'year'],\n    },\n    'en-GB': {\n        segments: ['day', 'month', 'year'],\n    },\n    'en-SG': {\n        segments: ['day', 'month', 'year'],\n    },\n    ko: {\n        segments: ['year', 'month', 'day'],\n    },\n    'th-TH': {\n        segments: ['day', 'month', 'year'],\n    },\n    pt: {\n        segments: ['day', 'month', 'year'],\n    },\n    'is-IS': {\n        segments: ['day', 'month', 'year'],\n    },\n    'de-DE': {\n        delimiter: '.',\n        segments: ['day', 'month', 'year'],\n    },\n    pseudo: {\n        segments: ['day', 'month', 'year'],\n    },\n};\nexport function isValidYearRange(year) {\n    return year > 1700 && year < 2122;\n}\nfunction noop() { }\nfunction getLastDate(month, year) {\n    return normalizeNewDate(year, Math.max(0, month), 0).getDate();\n}\nfunction getSegmentProps(onChangeSegment, type, dateInput, getAriaLabel) {\n    var _a = segments[type], maxLength = _a.maxLength, placeholder = _a.placeholder;\n    if (type === 'day') {\n        return {\n            'aria-label': getAriaLabel('day', dateInput.day),\n            maxLength: maxLength,\n            maxValue: getLastDate(dateInput.month, dateInput.year),\n            minValue: 1,\n            onChange: function (value) {\n                dateInput.setDay(value);\n                onChangeSegment(type, value);\n            },\n            placeholder: placeholder,\n            value: dateInput.day,\n        };\n    }\n    else if (type === 'month') {\n        return {\n            'aria-label': getAriaLabel('month', dateInput.month),\n            maxLength: maxLength,\n            maxValue: maxMonth,\n            minValue: 1,\n            onChange: function (value) {\n                dateInput.setMonth(value);\n                onChangeSegment(type, value);\n            },\n            placeholder: placeholder,\n            value: dateInput.month,\n        };\n    }\n    else {\n        return {\n            'aria-label': getAriaLabel('year', dateInput.year),\n            maxLength: maxLength,\n            maxValue: maxYear,\n            minValue: minYear,\n            onChange: function (value) {\n                dateInput.setYear(value);\n                onChangeSegment(type, value);\n            },\n            placeholder: placeholder,\n            value: dateInput.year,\n        };\n    }\n}\nfunction setFocusTo(target) {\n    return target && target.current && target.current.focus();\n}\nfunction focusTargetOrFirst() {\n    var refs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        refs[_i] = arguments[_i];\n    }\n    return function handler(event) {\n        if (event === void 0) { event = { target: null }; }\n        var ref = refs.reduce(function (acc, ref) {\n            return ref.current && ref.current === event.target ? ref : acc;\n        }, refs[0]);\n        setFocusTo(ref);\n    };\n}\nfunction clampDay(day, month, year) {\n    if (day > 0 && month > 0 && year) {\n        var date = normalizeNewDate(year, month - 1, day);\n        if (date.getMonth() !== month - 1) {\n            return getLastDate(month, year);\n        }\n    }\n    return day;\n}\nfunction useDateInput(_a) {\n    var onChange = _a.onChange, value_ = _a.value, log = _a.log;\n    var dateTime = useDateTime();\n    // logging called too frequenlty if not in memo\n    var value = React.useMemo(function () {\n        return dateTime.shiftUtcToZonedTime(value_, log);\n    }, [value_]);\n    var _b = React.useState(value ? value.getDate() : -1), day = _b[0], setRawDay = _b[1];\n    var _c = React.useState(value ? value.getMonth() + 1 : -1), month = _c[0], setRawMonth = _c[1];\n    var _d = React.useState(value ? value.getFullYear() : -1), year = _d[0], setRawYear = _d[1];\n    var hasValues = day >= 0 || month >= 0 || year >= 0;\n    var isInvalid = day < 0 || month < 0 || year < 0;\n    var setAll = function (day, month, year) {\n        var clampedDay = clampDay(day, month, year);\n        var date = clampedDay > 0 && month > 0 && year > 0\n            ? normalizeNewDate(year, month - 1, clampedDay)\n            : null;\n        setRawDay(clampedDay);\n        setRawMonth(month);\n        setRawYear(year);\n        // Call DateSelect.onChange API when a supported year range or deleted date\n        // isValidYearRange protects shiftZonedTimeToUtc\n        // when date is null, year should be -1. -1 means it was cleared, either by button or backspace key\n        if (isValidYearRange(year) || date === null) {\n            onChange(dateTime.shiftZonedTimeToUtc(date));\n        }\n    };\n    var setDay = function (value) {\n        setAll(value, month, year);\n    };\n    var setMonth = function (value) {\n        setAll(day, value, year);\n    };\n    var setYear = function (value) {\n        setAll(day, month, value);\n    };\n    var clear = function () {\n        setAll(-1, -1, -1);\n    };\n    React.useEffect(function () {\n        if (value) {\n            setRawDay(value.getDate());\n            setRawMonth(value.getMonth() + 1);\n            setRawYear(value.getFullYear());\n        }\n    }, [value]);\n    return {\n        clear: clear,\n        day: day,\n        hasValues: hasValues,\n        month: month,\n        setDay: setDay,\n        setMonth: setMonth,\n        setYear: setYear,\n        year: year,\n    };\n}\nfunction getSegmentText(_a) {\n    var maxLength = _a.maxLength, placeholder = _a.placeholder, type = _a.type, value = _a.value;\n    if (value < 0) {\n        return placeholder;\n    }\n    if (type === 'year' && !isValidYearRange(value)) {\n        return \"\".concat(value, \"____\").slice(0, 4);\n    }\n    return String(value).padStart(maxLength, '0');\n}\nvar DateSegment = React.forwardRef(function DateSegment(_a, ref) {\n    var _b = _a.disabled, disabled = _b === void 0 ? false : _b, maxLength = _a.maxLength, maxValue = _a.maxValue, minValue = _a.minValue, nextRef = _a.nextRef, _c = _a.onChange, onChange = _c === void 0 ? function (value) { } : _c, placeholder = _a.placeholder, prevRef = _a.prevRef, _d = _a.tabIndex, tabIndex = _d === void 0 ? 0 : _d, type = _a.type, _e = _a.value, value = _e === void 0 ? 0 : _e, props = __rest(_a, [\"disabled\", \"maxLength\", \"maxValue\", \"minValue\", \"nextRef\", \"onChange\", \"placeholder\", \"prevRef\", \"tabIndex\", \"type\", \"value\"]);\n    var _f = React.useState(''), keyBuffer = _f[0], setKeyBuffer = _f[1];\n    var contains = function (key, keys) { return keys.indexOf(key) >= 0; };\n    var onKeyDown = function (event) {\n        event.stopPropagation();\n        var key = event.key;\n        if (contains(key, ['Up', 'ArrowUp', 'Down', 'ArrowDown', 'Backspace'])) {\n            event.preventDefault();\n        }\n        if (contains(key, ['Up', 'ArrowUp', 'Down', 'ArrowDown']) &&\n            type === 'year' &&\n            value === -1) {\n            onChange(new Date().getFullYear());\n        }\n        else if (contains(key, ['Up', 'ArrowUp'])) {\n            onChange(value + 1 > maxValue ? minValue : Math.max(1, value + 1));\n        }\n        else if (contains(key, ['Down', 'ArrowDown'])) {\n            onChange(value - 1 < minValue ? maxValue : value - 1);\n        }\n        else if (contains(key, ['Left', 'ArrowLeft'])) {\n            setFocusTo(prevRef);\n        }\n        else if (contains(key, ['Right', 'ArrowRight'])) {\n            setFocusTo(nextRef);\n        }\n        else if (contains(key, ['Backspace', 'Delete'])) {\n            setKeyBuffer('');\n            onChange(-1);\n            // the segment is currently empty, go to the previous segment\n            if (value === -1) {\n                setFocusTo(prevRef);\n            }\n        }\n        else if (!isNaN(parseInt(key, 10))) {\n            if (keyBuffer.length === 0) {\n                // current buffer is empty, initialize it\n                setKeyBuffer(key);\n                onChange(parseInt(key, 10));\n            }\n            else {\n                // current buffer has text, add to it\n                var newBuffer = keyBuffer + key;\n                setKeyBuffer(newBuffer);\n                onChange(Math.min(parseInt(newBuffer, 10), maxValue));\n            }\n        }\n    };\n    React.useEffect(function () {\n        if (keyBuffer.length >= maxLength ||\n            (keyBuffer.length === 1 &&\n                ((type === 'day' && value > 3) || (type === 'month' && value > 1)))) {\n            setFocusTo(nextRef);\n            // Needed for year to reset as it does not move focus\n            setKeyBuffer('');\n        }\n    });\n    return (React.createElement(StyledDateInputSegment, __assign({ ref: ref }, props, { \"data-placeholder\": value < 0, disabled: disabled, isYear: type === 'year', onBlur: function () {\n            if (value !== -1) {\n                var val = type === 'year' && value < 100 ? 2000 + value : value;\n                onChange(val);\n            }\n            setKeyBuffer('');\n        }, onKeyDown: onKeyDown, tabIndex: disabled ? -1 : tabIndex }), getSegmentText({ value: value, placeholder: placeholder, type: type, maxLength: maxLength })));\n});\nexport var DateInput = React.forwardRef(function DateInput(_a, ref) {\n    var clearRef = _a.clearRef, disabled = _a.disabled, _b = _a.error, error = _b === void 0 ? false : _b, _c = _a.segmentRefs, segmentRefs = _c === void 0 ? {} : _c, variant = _a.variant, _d = _a.onChange, onChange = _d === void 0 ? noop : _d, _e = _a.onChangeSegment, onChangeSegment = _e === void 0 ? noop : _e, _f = _a.onClear, onClear = _f === void 0 ? noop : _f, _g = _a.tabIndex, tabIndex = _g === void 0 ? 0 : _g, value = _a.value, props = __rest(_a, [\"clearRef\", \"disabled\", \"error\", \"segmentRefs\", \"variant\", \"onChange\", \"onChangeSegment\", \"onClear\", \"tabIndex\", \"value\"]);\n    var I18n = useI18nContext();\n    var dateInputRef = ref;\n    var segment1Ref = segmentRefs.segmentOne || React.createRef();\n    var segment2Ref = segmentRefs.segmentTwo || React.createRef();\n    var segment3Ref = segmentRefs.segmentThree || React.createRef();\n    var _h = dateInputLocales[I18n.locale] || dateInputLocales['en'], _j = _h.delimiter, delimiter = _j === void 0 ? '/' : _j, segments = _h.segments;\n    var dateTime = useDateTime();\n    var dateInput = useDateInput({\n        onChange: onChange,\n        value: value,\n        log: 'Display date',\n    });\n    var onClickClear = function (e) {\n        setFocusTo(segment1Ref);\n        dateInput.clear();\n        onClear(e);\n    };\n    useEventListener({\n        event: 'click',\n        handler: focusTargetOrFirst(segment1Ref, segment2Ref, segment3Ref),\n        scope: dateInputRef,\n    });\n    var getSegmentAriaLabel = function (type, value) {\n        return value && value !== -1\n            ? I18n.t(type, {\n                value: value,\n                scope: 'core.dateInput.segment.ariaLabel.withValue',\n            })\n            : I18n.t(type, {\n                scope: 'core.dateInput.segment.ariaLabel.withoutValue',\n            });\n    };\n    return (React.createElement(StyledDateInput, __assign({ \"aria-label\": value && isValidYearRange(dateInput.year)\n            ? dateTime.format(dateTime.newDate(dateInput.year, \n            // @ts-ignore\n            dateInput.month - 1, dateInput.day), 'weekday-date')\n            : undefined, disabled: disabled || variant === 'disabled', error: error ||\n            variant === 'error' ||\n            // -1 means placeholder yyyy is shown\n            (!isValidYearRange(dateInput.year) && dateInput.year !== -1), ref: dateInputRef }, props),\n        React.createElement(DateSegment, __assign({ disabled: disabled, nextRef: segment2Ref, ref: segment1Ref, tabIndex: tabIndex, type: segments[0] }, getSegmentProps(onChangeSegment, segments[0], dateInput, getSegmentAriaLabel))),\n        React.createElement(StyledDateInputDelimiter, { \"aria-hidden\": true, visible: Boolean(value) }, delimiter),\n        React.createElement(DateSegment, __assign({ disabled: disabled, nextRef: segment3Ref, prevRef: segment1Ref, ref: segment2Ref, tabIndex: tabIndex, type: segments[1] }, getSegmentProps(onChangeSegment, segments[1], dateInput, getSegmentAriaLabel))),\n        React.createElement(StyledDateInputDelimiter, { \"aria-hidden\": true, visible: Boolean(value) }, delimiter),\n        React.createElement(DateSegment, __assign({ disabled: disabled, prevRef: segment2Ref, ref: segment3Ref, tabIndex: tabIndex, type: segments[2] }, getSegmentProps(onChangeSegment, segments[2], dateInput, getSegmentAriaLabel))),\n        React.createElement(StyledDateInputIconContainer, null, dateInput.hasValues ? (React.createElement(Button, { \"aria-label\": I18n.t('core.dateInput.clearButton.ariaLabel'), onClick: onClickClear, ref: clearRef, size: \"sm\", variant: \"tertiary\", icon: React.createElement(Clear, { size: \"sm\" }), tabIndex: -1 })) : (React.createElement(StyledCalendar, null)))));\n});\nDateInput.displayName = 'DateInput';\nexport default DateInput;\n"]},"metadata":{},"sourceType":"module"}