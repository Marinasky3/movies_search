{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport React from 'react';\nimport Button from '../Button';\nimport OverlayTrigger from '../OverlayTrigger';\nimport { TieredSelectMenu } from '../TieredSelect/TieredSelectMenu';\nimport { TieredSelectContext } from '../TieredSelect/TieredSelect';\nimport { useSearch } from './useSearch';\nimport { always, defaultGetGroupId, defaultGetId, defaultGetLabel, defaultGetNextGroupId, defaultIsTierDisabled, empty, findPath, getPathKey, hideKeys, noop } from './TieredDropdown.helpers';\nvar TieredDropdownInternal = React.forwardRef(function TieredDropdownInternal(_a, ref) {\n  var className = _a.className,\n      _b = _a.disabled,\n      disabled = _b === void 0 ? false : _b,\n      _c = _a.loading,\n      loading = _c === void 0 ? false : _c,\n      onKeyDown = _a.onKeyDown,\n      _d = _a.options,\n      options = _d === void 0 ? empty : _d,\n      _e = _a.value,\n      value = _e === void 0 ? empty : _e,\n      style = _a.style,\n      props = __rest(_a, [\"className\", \"disabled\", \"loading\", \"onKeyDown\", \"options\", \"value\", \"style\"]);\n\n  var _f = React.useContext(TieredSelectContext),\n      afterHide = _f.afterHide,\n      afterShow = _f.afterShow,\n      beforeHide = _f.beforeHide,\n      beforeShow = _f.beforeShow,\n      block = _f.block,\n      getLabel = _f.getLabel,\n      getGroupId = _f.getGroupId,\n      getNextGroupId = _f.getNextGroupId,\n      isLeaf = _f.isLeaf,\n      onChange = _f.onChange,\n      onNavigate = _f.onNavigate,\n      onSearch = _f.onSearch,\n      tabIndex = _f.tabIndex;\n\n  var searchablePaths = React.useMemo(function () {\n    if (onSearch) {\n      return [];\n    }\n\n    var paths = [];\n    var optionsByNextGroupId = options.reduce(function (map, option) {\n      var _a;\n\n      var nextGroupId = getNextGroupId(option);\n\n      if (nextGroupId) {\n        return __assign(__assign({}, map), (_a = {}, _a[nextGroupId] = option, _a));\n      }\n\n      return map;\n    }, {});\n    options.forEach(function (item) {\n      if (!getNextGroupId(item)) {\n        var path = findPath(optionsByNextGroupId, item, getGroupId);\n        var pathKey = getPathKey(path, getLabel);\n        paths.push({\n          path: path,\n          pathKey: pathKey,\n          label: pathKey,\n          node: item\n        });\n      }\n    });\n    return paths;\n  }, [getGroupId, getLabel, getNextGroupId, onSearch, options]);\n\n  var _g = useSearch({\n    items: searchablePaths,\n    keysToSearch: ['pathKey']\n  }),\n      searchTerm = _g.searchTerm,\n      filteredItems = _g.filteredItems,\n      setSearch = _g.setSearch;\n\n  var menuOptions = React.useMemo(function () {\n    return searchTerm.length > 0 ? filteredItems : options;\n  }, [filteredItems, options, searchTerm.length]);\n  var tieredSelectMenuRef = React.useRef(null);\n\n  var _h = React.useState(null),\n      currentTier = _h[0],\n      setCurrentTier = _h[1]; // internal value used for navigation\n\n\n  var _j = React.useState(value),\n      internalValue = _j[0],\n      setInternalValue = _j[1];\n\n  var internalOnNavigate = React.useCallback(function (nextGroupId, value) {\n    setInternalValue(value);\n    setCurrentTier(nextGroupId);\n    onNavigate === null || onNavigate === void 0 ? void 0 : onNavigate(nextGroupId, value);\n  }, [onNavigate]);\n  var internalOnSearch = React.useCallback(function (event) {\n    if (onSearch === undefined) {\n      setSearch(event.target.value);\n    } else {\n      onSearch(event);\n    }\n  }, [onSearch, setSearch]);\n  /**\n   * Emulates on select\n   */\n\n  var internalOnChange = React.useCallback(function (selection) {\n    if (searchTerm.length > 0) {\n      onChange === null || onChange === void 0 ? void 0 : onChange(__assign(__assign({}, selection), {\n        value: selection.item.path,\n        item: selection.item.node\n      }));\n    } else {\n      onChange === null || onChange === void 0 ? void 0 : onChange(selection);\n    }\n  }, [onChange, searchTerm]);\n  /**\n   * Used to reset state after selection\n   */\n\n  var internalAfterHide = React.useCallback(function () {\n    setCurrentTier(null);\n    setInternalValue([]);\n    afterHide && afterHide();\n  }, [afterHide]); // if value prop changes, update value state, current tier, and set button label\n  // else open to root\n\n  React.useEffect(function () {\n    if (value.length > 0) {\n      var lastEntryInValue = value[value.length - 1];\n      setInternalValue(value); // show children of last tier in value if not a leaf node\n      // otherwise we want to show the parent of the last tier in value\n\n      if (isLeaf && !isLeaf(lastEntryInValue)) {\n        setCurrentTier(getNextGroupId(lastEntryInValue));\n      } else {\n        setCurrentTier(getGroupId(lastEntryInValue) || null);\n      }\n    } else {\n      setCurrentTier(null);\n      setInternalValue([]);\n    }\n  }, [getGroupId, getNextGroupId, isLeaf, value]);\n  return React.createElement(OverlayTrigger, {\n    afterHide: internalAfterHide,\n    afterShow: afterShow,\n    beforeHide: beforeHide,\n    beforeShow: function (e) {\n      return beforeShow && beforeShow(e);\n    },\n    canFlip: true,\n    hideKeys: hideKeys,\n    overlay: disabled ? null : React.createElement(TieredSelectMenu, __assign({\n      currentTier: currentTier,\n      options: menuOptions,\n      loading: loading,\n      menuRef: tieredSelectMenuRef,\n      onNavigate: internalOnNavigate,\n      onSearch: internalOnSearch,\n      onChange: internalOnChange,\n      value: internalValue,\n      previousValue: []\n    }, props)),\n    placement: \"bottom-left\",\n    ref: ref,\n    trigger: \"click\"\n  }, React.createElement(Button, {\n    \"data-qa\": props['data-qa'],\n    block: block,\n    className: className,\n    disabled: disabled,\n    icon: props.icon,\n    iconRight: props.iconRight,\n    loading: loading,\n    size: props.size,\n    style: style,\n    tabIndex: tabIndex,\n    variant: props.variant\n  }, props.children));\n});\nexport var TieredDropdown = React.forwardRef(function TieredDropdown(_a, ref) {\n  var _b = _a.afterHide,\n      afterHide = _b === void 0 ? noop : _b,\n      _c = _a.afterShow,\n      afterShow = _c === void 0 ? noop : _c,\n      _d = _a.beforeHide,\n      beforeHide = _d === void 0 ? always : _d,\n      _e = _a.beforeShow,\n      beforeShow = _e === void 0 ? always : _e,\n      block = _a.block,\n      _f = _a.getGroupId,\n      getGroupId = _f === void 0 ? defaultGetGroupId : _f,\n      _g = _a.getId,\n      getId = _g === void 0 ? defaultGetId : _g,\n      _h = _a.getLabel,\n      getLabel = _h === void 0 ? defaultGetLabel : _h,\n      _j = _a.getNextGroupId,\n      getNextGroupId = _j === void 0 ? defaultGetNextGroupId : _j,\n      _k = _a.i18nScope,\n      i18nScope = _k === void 0 ? 'core.tieredDropdown' : _k,\n      _l = _a.isTierDisabled,\n      isTierDisabled = _l === void 0 ? defaultIsTierDisabled : _l,\n      _m = _a.onSelect,\n      onSelect = _m === void 0 ? noop : _m,\n      onNavigate = _a.onNavigate,\n      onScrollBottom = _a.onScrollBottom,\n      onSearch = _a.onSearch,\n      tabIndex = _a.tabIndex,\n      props = __rest(_a, [\"afterHide\", \"afterShow\", \"beforeHide\", \"beforeShow\", \"block\", \"getGroupId\", \"getId\", \"getLabel\", \"getNextGroupId\", \"i18nScope\", \"isTierDisabled\", \"onSelect\", \"onNavigate\", \"onScrollBottom\", \"onSearch\", \"tabIndex\"]);\n\n  var isLeaf = React.useCallback(function (tier) {\n    return !getNextGroupId(tier);\n  }, [getNextGroupId]);\n  return React.createElement(TieredSelectContext.Provider, {\n    value: {\n      afterHide: afterHide,\n      afterShow: afterShow,\n      beforeHide: beforeHide,\n      beforeShow: beforeShow,\n      block: block,\n      getGroupId: getGroupId,\n      getId: getId,\n      getLabel: getLabel,\n      getNextGroupId: getNextGroupId,\n      getValueString: function () {\n        return '';\n      },\n      i18nScope: i18nScope,\n      isTierDisabled: isTierDisabled,\n      isLeaf: isLeaf,\n      onChange: onSelect,\n      onNavigate: onNavigate,\n      onScrollBottom: onScrollBottom,\n      onSearch: onSearch,\n      tabIndex: tabIndex\n    }\n  }, React.createElement(TieredDropdownInternal, __assign({\n    ref: ref\n  }, props, {\n    value: []\n  })));\n});\nexport default TieredDropdown;","map":{"version":3,"sources":["../../../../src/components/TieredDropdown/TieredDropdown.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React from 'react';\nimport Button from '../Button';\nimport OverlayTrigger from '../OverlayTrigger';\nimport { TieredSelectMenu } from '../TieredSelect/TieredSelectMenu';\nimport { TieredSelectContext } from '../TieredSelect/TieredSelect';\nimport { useSearch } from './useSearch';\nimport { always, defaultGetGroupId, defaultGetId, defaultGetLabel, defaultGetNextGroupId, defaultIsTierDisabled, empty, findPath, getPathKey, hideKeys, noop, } from './TieredDropdown.helpers';\nvar TieredDropdownInternal = React.forwardRef(function TieredDropdownInternal(_a, ref) {\n    var className = _a.className, _b = _a.disabled, disabled = _b === void 0 ? false : _b, _c = _a.loading, loading = _c === void 0 ? false : _c, onKeyDown = _a.onKeyDown, _d = _a.options, options = _d === void 0 ? empty : _d, _e = _a.value, value = _e === void 0 ? empty : _e, style = _a.style, props = __rest(_a, [\"className\", \"disabled\", \"loading\", \"onKeyDown\", \"options\", \"value\", \"style\"]);\n    var _f = React.useContext(TieredSelectContext), afterHide = _f.afterHide, afterShow = _f.afterShow, beforeHide = _f.beforeHide, beforeShow = _f.beforeShow, block = _f.block, getLabel = _f.getLabel, getGroupId = _f.getGroupId, getNextGroupId = _f.getNextGroupId, isLeaf = _f.isLeaf, onChange = _f.onChange, onNavigate = _f.onNavigate, onSearch = _f.onSearch, tabIndex = _f.tabIndex;\n    var searchablePaths = React.useMemo(function () {\n        if (onSearch) {\n            return [];\n        }\n        var paths = [];\n        var optionsByNextGroupId = options.reduce(function (map, option) {\n            var _a;\n            var nextGroupId = getNextGroupId(option);\n            if (nextGroupId) {\n                return __assign(__assign({}, map), (_a = {}, _a[nextGroupId] = option, _a));\n            }\n            return map;\n        }, {});\n        options.forEach(function (item) {\n            if (!getNextGroupId(item)) {\n                var path = findPath(optionsByNextGroupId, item, getGroupId);\n                var pathKey = getPathKey(path, getLabel);\n                paths.push({\n                    path: path,\n                    pathKey: pathKey,\n                    label: pathKey,\n                    node: item,\n                });\n            }\n        });\n        return paths;\n    }, [getGroupId, getLabel, getNextGroupId, onSearch, options]);\n    var _g = useSearch({\n        items: searchablePaths,\n        keysToSearch: ['pathKey'],\n    }), searchTerm = _g.searchTerm, filteredItems = _g.filteredItems, setSearch = _g.setSearch;\n    var menuOptions = React.useMemo(function () {\n        return searchTerm.length > 0 ? filteredItems : options;\n    }, [filteredItems, options, searchTerm.length]);\n    var tieredSelectMenuRef = React.useRef(null);\n    var _h = React.useState(null), currentTier = _h[0], setCurrentTier = _h[1];\n    // internal value used for navigation\n    var _j = React.useState(value), internalValue = _j[0], setInternalValue = _j[1];\n    var internalOnNavigate = React.useCallback(function (nextGroupId, value) {\n        setInternalValue(value);\n        setCurrentTier(nextGroupId);\n        onNavigate === null || onNavigate === void 0 ? void 0 : onNavigate(nextGroupId, value);\n    }, [onNavigate]);\n    var internalOnSearch = React.useCallback(function (event) {\n        if (onSearch === undefined) {\n            setSearch(event.target.value);\n        }\n        else {\n            onSearch(event);\n        }\n    }, [onSearch, setSearch]);\n    /**\n     * Emulates on select\n     */\n    var internalOnChange = React.useCallback(function (selection) {\n        if (searchTerm.length > 0) {\n            onChange === null || onChange === void 0 ? void 0 : onChange(__assign(__assign({}, selection), { value: selection.item.path, item: selection.item.node }));\n        }\n        else {\n            onChange === null || onChange === void 0 ? void 0 : onChange(selection);\n        }\n    }, [onChange, searchTerm]);\n    /**\n     * Used to reset state after selection\n     */\n    var internalAfterHide = React.useCallback(function () {\n        setCurrentTier(null);\n        setInternalValue([]);\n        afterHide && afterHide();\n    }, [afterHide]);\n    // if value prop changes, update value state, current tier, and set button label\n    // else open to root\n    React.useEffect(function () {\n        if (value.length > 0) {\n            var lastEntryInValue = value[value.length - 1];\n            setInternalValue(value);\n            // show children of last tier in value if not a leaf node\n            // otherwise we want to show the parent of the last tier in value\n            if (isLeaf && !isLeaf(lastEntryInValue)) {\n                setCurrentTier(getNextGroupId(lastEntryInValue));\n            }\n            else {\n                setCurrentTier(getGroupId(lastEntryInValue) || null);\n            }\n        }\n        else {\n            setCurrentTier(null);\n            setInternalValue([]);\n        }\n    }, [getGroupId, getNextGroupId, isLeaf, value]);\n    return (React.createElement(OverlayTrigger, { afterHide: internalAfterHide, afterShow: afterShow, beforeHide: beforeHide, beforeShow: function (e) {\n            return beforeShow && beforeShow(e);\n        }, canFlip: true, hideKeys: hideKeys, overlay: disabled ? null : (React.createElement(TieredSelectMenu, __assign({ currentTier: currentTier, options: menuOptions, loading: loading, menuRef: tieredSelectMenuRef, onNavigate: internalOnNavigate, onSearch: internalOnSearch, onChange: internalOnChange, value: internalValue, previousValue: [] }, props))), placement: \"bottom-left\", ref: ref, trigger: \"click\" },\n        React.createElement(Button, { \"data-qa\": props['data-qa'], block: block, className: className, disabled: disabled, icon: props.icon, iconRight: props.iconRight, loading: loading, size: props.size, style: style, tabIndex: tabIndex, variant: props.variant }, props.children)));\n});\nexport var TieredDropdown = React.forwardRef(function TieredDropdown(_a, ref) {\n    var _b = _a.afterHide, afterHide = _b === void 0 ? noop : _b, _c = _a.afterShow, afterShow = _c === void 0 ? noop : _c, _d = _a.beforeHide, beforeHide = _d === void 0 ? always : _d, _e = _a.beforeShow, beforeShow = _e === void 0 ? always : _e, block = _a.block, _f = _a.getGroupId, getGroupId = _f === void 0 ? defaultGetGroupId : _f, _g = _a.getId, getId = _g === void 0 ? defaultGetId : _g, _h = _a.getLabel, getLabel = _h === void 0 ? defaultGetLabel : _h, _j = _a.getNextGroupId, getNextGroupId = _j === void 0 ? defaultGetNextGroupId : _j, _k = _a.i18nScope, i18nScope = _k === void 0 ? 'core.tieredDropdown' : _k, _l = _a.isTierDisabled, isTierDisabled = _l === void 0 ? defaultIsTierDisabled : _l, _m = _a.onSelect, onSelect = _m === void 0 ? noop : _m, onNavigate = _a.onNavigate, onScrollBottom = _a.onScrollBottom, onSearch = _a.onSearch, tabIndex = _a.tabIndex, props = __rest(_a, [\"afterHide\", \"afterShow\", \"beforeHide\", \"beforeShow\", \"block\", \"getGroupId\", \"getId\", \"getLabel\", \"getNextGroupId\", \"i18nScope\", \"isTierDisabled\", \"onSelect\", \"onNavigate\", \"onScrollBottom\", \"onSearch\", \"tabIndex\"]);\n    var isLeaf = React.useCallback(function (tier) {\n        return !getNextGroupId(tier);\n    }, [getNextGroupId]);\n    return (React.createElement(TieredSelectContext.Provider, { value: {\n            afterHide: afterHide,\n            afterShow: afterShow,\n            beforeHide: beforeHide,\n            beforeShow: beforeShow,\n            block: block,\n            getGroupId: getGroupId,\n            getId: getId,\n            getLabel: getLabel,\n            getNextGroupId: getNextGroupId,\n            getValueString: function () { return ''; },\n            i18nScope: i18nScope,\n            isTierDisabled: isTierDisabled,\n            isLeaf: isLeaf,\n            onChange: onSelect,\n            onNavigate: onNavigate,\n            onScrollBottom: onScrollBottom,\n            onSearch: onSearch,\n            tabIndex: tabIndex,\n        } },\n        React.createElement(TieredDropdownInternal, __assign({ ref: ref }, props, { value: [] }))));\n});\nexport default TieredDropdown;\n"]},"metadata":{},"sourceType":"module"}