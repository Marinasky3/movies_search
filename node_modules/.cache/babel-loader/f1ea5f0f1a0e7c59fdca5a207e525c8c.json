{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport { ChevronRight, Home, Plus } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { isEventSource } from '../../effects/ClickOutside';\nimport { Box } from '../../layouts/Box';\nimport { FlexList } from '../../layouts/FlexList';\nimport { useI18nContext } from '../../state/I18n';\nimport { Breadcrumbs } from '../Breadcrumbs';\nimport { Button } from '../Button';\nimport { Input } from '../Input';\nimport { MenuImperative } from '../MenuImperative';\nimport { CloseOnFocus, OverlayTrigger, useOverlayTriggerContext } from '../OverlayTrigger';\nimport { Button as SelectButton } from '../Select';\nimport Spinner from '../Spinner';\nimport { Typography } from '../Typography/Typography';\nimport { TieredSelectContext, useHighlightItemEffects } from './TieredSelect';\nimport { StyledTieredSelect, StyledTieredSelectArrowButton, StyledTieredSelectBreadcrumbs, StyledTieredSelectHome, StyledTieredSelectLoadingMore, StyledTieredSelectOption, StyledTieredSelectOverlay, StyledTieredSelectSpinnerOverlay } from './TieredSelect.styles';\nvar empty = [];\nvar hideKeys = {\n  overlay: ['Escape', 'Esc'],\n  target: ['Escape', 'Esc']\n};\n\nfunction ArrowButton(_a) {\n  var onClick = _a.onClick,\n      props = __rest(_a, [\"onClick\"]);\n\n  return React.createElement(StyledTieredSelectArrowButton, __assign({}, props, {\n    icon: React.createElement(ChevronRight, null),\n    onClick: function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      onClick && onClick(event);\n    },\n    size: \"sm\",\n    tabIndex: -1,\n    variant: \"tertiary\"\n  }));\n}\n\nvar QuickCreateInput = React.forwardRef(function QuickCreateInput(_a, ref) {\n  var autoFocus = _a.autoFocus,\n      onSubmit = _a.onSubmit,\n      placeholder = _a.placeholder;\n\n  function onKeyDown(e) {\n    if (e.key === 'Enter') {\n      onSubmit(e.currentTarget.value);\n    }\n  }\n\n  return React.createElement(Box, {\n    flexGrow: \"1\",\n    justifyContent: \"center\",\n    padding: \"md\"\n  }, React.createElement(Input, {\n    autoFocus: autoFocus,\n    onKeyDown: onKeyDown,\n    placeholder: placeholder,\n    ref: ref\n  }));\n});\n\nfunction Options(_a) {\n  var children = _a.children,\n      emptyMessage = _a.emptyMessage,\n      props = __rest(_a, [\"children\", \"emptyMessage\"]);\n\n  if (React.Children.count(children) === 0) {\n    return React.createElement(MenuImperative.Options, null, React.createElement(Box, __assign({\n      paddingLeft: \"lg\"\n    }, props), React.createElement(Typography, {\n      color: \"gray45\",\n      intent: \"small\",\n      italic: true\n    }, emptyMessage)));\n  }\n\n  return React.createElement(MenuImperative.Options, null, children);\n}\n\nvar TieredSelectMenu = React.forwardRef(function TieredSelectMenu(_a, ref) {\n  var children = _a.children,\n      currentTier = _a.currentTier,\n      loading = _a.loading,\n      loadingMore = _a.loadingMore,\n      menuRef = _a.menuRef,\n      onNavigate = _a.onNavigate,\n      onSearch = _a.onSearch,\n      onChange = _a.onChange,\n      _b = _a.options,\n      options = _b === void 0 ? empty : _b,\n      value = _a.value,\n      previousValue = _a.previousValue,\n      props = __rest(_a, [\"children\", \"currentTier\", \"loading\", \"loadingMore\", \"menuRef\", \"onNavigate\", \"onSearch\", \"onChange\", \"options\", \"value\", \"previousValue\"]);\n\n  var _c = React.useContext(TieredSelectContext),\n      getGroupId = _c.getGroupId,\n      getId = _c.getId,\n      getLabel = _c.getLabel,\n      getNextGroupId = _c.getNextGroupId,\n      i18nScope = _c.i18nScope,\n      onQuickCreate = _c.onQuickCreate,\n      onScrollBottom = _c.onScrollBottom;\n\n  var quickCreateRef = React.useRef(null);\n  var hide = useOverlayTriggerContext().hide;\n  var I18n = useI18nContext();\n\n  var _d = React.useState(false),\n      isQuickCreating = _d[0],\n      setIsQuickCreating = _d[1];\n\n  var _e = React.useState(''),\n      searchValue = _e[0],\n      setSearchValue = _e[1];\n\n  var searchIsEmpty = searchValue === '';\n  var lastEntryInValue = value[value.length - 1];\n  var internalOnSearch = React.useCallback(function (e) {\n    setSearchValue(e.target.value);\n    onSearch && onSearch(e);\n  }, [onSearch]); // When searching (all options have been flattened) we dont filter by id\n\n  var filteredOptions = React.useMemo(function () {\n    return searchIsEmpty ? options.filter(function (tier) {\n      return getGroupId(tier) === currentTier;\n    }) : options;\n  }, [currentTier, getGroupId, options, searchIsEmpty]);\n  useHighlightItemEffects({\n    currentTier: currentTier,\n    searchValue: searchValue,\n    menuRef: menuRef,\n    loading: loading,\n    loadingMore: loadingMore\n  });\n  var onNavigateHome = React.useCallback(function () {\n    var _a;\n\n    onNavigate(null, []);\n    (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n  }, [menuRef, onNavigate]);\n  var onBreadCrumbNavigate = React.useCallback(function (tier) {\n    var _a;\n\n    var newTier = value.indexOf(tier);\n    onNavigate(getNextGroupId(tier), value.slice(0, newTier + 1));\n    (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n  }, [getNextGroupId, menuRef, onNavigate, value]);\n\n  function onNavigateForward(tier) {\n    var _a;\n\n    if (searchIsEmpty && !isQuickCreating && tier) {\n      var newValue = __spreadArray(__spreadArray([], value, true), [tier], false);\n\n      onNavigate(getNextGroupId(tier), newValue);\n      (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }\n  }\n  /**\n   * need to skip back two levels if coming from a leaf node;\n   * out from the leaf and then out of the parent. this is because\n   * when tiers aren't selectectable we show the parent of the leaf\n   */\n\n\n  function onNavigateBackward() {\n    var _a;\n\n    if (value.length !== 0 && searchIsEmpty) {\n      var newValue = value.slice(0, Math.max(0, value.length - 1));\n      var newTier = value[value.length - 1];\n      !isQuickCreating && onNavigate(getGroupId(newTier), newValue);\n      (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }\n  }\n\n  function onKeyDown(e) {\n    var _a;\n\n    var tier = (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlighted();\n\n    if (e.key === 'Right' || e.key === 'ArrowRight') {\n      onNavigateForward(tier);\n    } else if (e.key === 'Left' || e.key === 'ArrowLeft') {\n      onNavigateBackward();\n    }\n  }\n\n  function onTierSelect(selection) {\n    var isSameGroup = value.length ? getGroupId(lastEntryInValue) === getGroupId(selection.item) : false; // if the selection is in the same group as the old selection, replace the old selection\n\n    var newValue = isSameGroup ? __spreadArray(__spreadArray([], value.slice(0, value.length - 1), true), [selection.item], false) : __spreadArray(__spreadArray([], value, true), [selection.item], false);\n    onChange(__assign(__assign({}, selection), {\n      value: newValue\n    }));\n    searchValue && internalOnSearch({\n      target: {\n        value: ''\n      }\n    });\n    hide(selection.event);\n  }\n\n  function showBreadcrumbs() {\n    return value.length && searchIsEmpty;\n  }\n\n  var menuEmptyMessage = searchIsEmpty ? I18n.t('emptyMessage', {\n    scope: i18nScope\n  }) : I18n.t('searchEmptyMessage', {\n    scope: i18nScope\n  });\n  var handleQuickCreate = React.useCallback(function (e) {\n    // stops menu from selecting item and closing on enter press\n    e.stopPropagation();\n\n    if (e.key === 'Enter') {\n      setIsQuickCreating(true);\n    }\n  }, [setIsQuickCreating]);\n  var onQuickCreateSubmit = React.useCallback(function () {\n    onQuickCreate && quickCreateRef.current && onQuickCreate(quickCreateRef.current.value);\n    setIsQuickCreating(false);\n  }, [onQuickCreate, quickCreateRef, setIsQuickCreating]);\n\n  function isTierSelected(tier) {\n    if (previousValue.length) {\n      return getId(tier) === getId(previousValue[previousValue.length - 1]);\n    }\n\n    return false;\n  }\n\n  return React.createElement(StyledTieredSelectOverlay, {\n    ref: ref,\n    shadowStrength: 2\n  }, React.createElement(StyledTieredSelectSpinnerOverlay, {\n    \"data-qa\": \"tiered-select-loading\",\n    \"data-loading\": loading,\n    loading: loading,\n    label: I18n.t('spinnerLabel', {\n      scope: i18nScope\n    }) || '',\n    size: \"md\"\n  }, React.createElement(StyledTieredSelect, __assign({\n    onKeyDown: onKeyDown,\n    onScrollBottom: onScrollBottom,\n    onSelect: onTierSelect,\n    ref: menuRef\n  }, props), React.createElement(MenuImperative.Header, null, !isQuickCreating && React.createElement(MenuImperative.Search, {\n    autoComplete: \"false\",\n    autoFocus: true,\n    onChange: internalOnSearch,\n    placeholder: I18n.t('searchPlaceholder', {\n      scope: i18nScope\n    })\n  }), showBreadcrumbs() ? React.createElement(StyledTieredSelectBreadcrumbs, {\n    \"$nonInteractive\": isQuickCreating\n  }, React.createElement(Breadcrumbs.Crumb, {\n    onClick: onNavigateHome\n  }, React.createElement(StyledTieredSelectHome, {\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  }, React.createElement(Home, {\n    \"data-qa\": \"tiered-select-home\"\n  }))), value.map(function (tier, index, array) {\n    return React.createElement(Breadcrumbs.Crumb, {\n      active: index === array.length - 1,\n      key: \"\".concat(getId(tier), \"-\").concat(index),\n      onClick: function () {\n        return onBreadCrumbNavigate(tier);\n      }\n    }, getLabel(tier));\n  })) : null), !isQuickCreating ? React.createElement(Options, {\n    emptyMessage: menuEmptyMessage\n  }, filteredOptions.map(function (tier, index) {\n    return React.createElement(StyledTieredSelectOption, {\n      item: tier,\n      key: \"\".concat(getId(tier), \"-\").concat(index),\n      selected: isTierSelected(tier)\n    }, getLabel(tier), (getNextGroupId(tier) || onQuickCreate) && React.createElement(Box, {\n      paddingLeft: \"sm\"\n    }, React.createElement(ArrowButton, {\n      \"data-qa\": \"tiered-select-arrow\",\n      onClick: function () {\n        return onNavigateForward(tier);\n      }\n    })));\n  }).concat(loadingMore && !loading ? [React.createElement(StyledTieredSelectLoadingMore, {\n    \"data-qa\": \"tiered-select-loading-more\",\n    key: 'tiered-select-loading-more'\n  }, React.createElement(Spinner, {\n    size: \"sm\"\n  }))] : [])) : React.createElement(QuickCreateInput, {\n    autoFocus: isQuickCreating,\n    onSubmit: onQuickCreateSubmit,\n    placeholder: I18n.t('quickCreatePlaceholder', {\n      scope: i18nScope\n    }),\n    ref: quickCreateRef\n  }), onQuickCreate && React.createElement(MenuImperative.Footer, null, isQuickCreating ? React.createElement(FlexList, {\n    size: \"xs\",\n    justifyContent: \"flex-end\"\n  }, React.createElement(Button, {\n    onClick: function () {\n      return setIsQuickCreating(false);\n    },\n    size: \"sm\",\n    variant: \"tertiary\"\n  }, I18n.t('quickCreateCancelLabel', {\n    scope: i18nScope\n  })), React.createElement(Button, {\n    onClick: onQuickCreateSubmit,\n    size: \"sm\"\n  }, I18n.t('quickCreateCreateLabel', {\n    scope: i18nScope\n  }))) : React.createElement(Button, {\n    block: true,\n    icon: React.createElement(Plus, {\n      size: \"md\"\n    }),\n    onClick: function () {\n      return setIsQuickCreating(true);\n    },\n    onKeyDown: handleQuickCreate,\n    size: \"sm\"\n  }, I18n.t('quickCreateActionLabel', {\n    scope: i18nScope\n  }))), React.createElement(CloseOnFocus, {\n    hide: hide\n  }))));\n});\nexport var TierSelectionTieredSelect = React.forwardRef(function TierSelectionTieredSelect(_a, ref) {\n  var className = _a.className,\n      _b = _a.disabled,\n      disabled = _b === void 0 ? false : _b,\n      _c = _a.error,\n      error = _c === void 0 ? false : _c,\n      _d = _a.loading,\n      loading = _d === void 0 ? false : _d,\n      onKeyDown = _a.onKeyDown,\n      _e = _a.options,\n      options = _e === void 0 ? empty : _e,\n      _f = _a.value,\n      value = _f === void 0 ? empty : _f,\n      props = __rest(_a, [\"className\", \"disabled\", \"error\", \"loading\", \"onKeyDown\", \"options\", \"value\"]);\n\n  var _g = React.useContext(TieredSelectContext),\n      afterHide = _g.afterHide,\n      afterShow = _g.afterShow,\n      beforeHide = _g.beforeHide,\n      beforeShow = _g.beforeShow,\n      block = _g.block,\n      getLabel = _g.getLabel,\n      getNextGroupId = _g.getNextGroupId,\n      getValueString = _g.getValueString,\n      i18nScope = _g.i18nScope,\n      isLeaf = _g.isLeaf,\n      onChange = _g.onChange,\n      onClear = _g.onClear,\n      onNavigate = _g.onNavigate,\n      onSearch = _g.onSearch,\n      tabIndex = _g.tabIndex;\n\n  var I18n = useI18nContext();\n  var tieredSelectMenuRef = React.useRef(null);\n  var tieredSelectButtonRef = React.useRef(null);\n  var clearRef = React.createRef();\n\n  var _h = React.useState(''),\n      valueString = _h[0],\n      setValueString = _h[1];\n\n  var _j = React.useState(null),\n      currentTier = _j[0],\n      setCurrentTier = _j[1]; // internal value used for navigation\n\n\n  var _k = React.useState(value),\n      internalValue = _k[0],\n      setInternalValue = _k[1]; // value to reset to if navigation occurs but no selection has been made\n\n\n  var _l = React.useState(value),\n      previousValue = _l[0],\n      setPreviousValue = _l[1]; // if value prop changes, update value state, current tier, and set button label\n  // else open to root\n\n\n  React.useEffect(function () {\n    var lastEntryInValue = value[value.length - 1];\n\n    if (value.length > 0) {\n      setInternalValue(value);\n      setPreviousValue(value);\n      setValueString(getValueString(value)); // show children of last tier in value\n\n      setCurrentTier(getNextGroupId(lastEntryInValue));\n    } else {\n      setCurrentTier(null);\n      setInternalValue([]);\n      setPreviousValue([]);\n      setValueString('');\n    }\n  }, [getValueString, getNextGroupId, isLeaf, value]);\n  var internalOnChange = React.useCallback(function (selection) {\n    setInternalValue(selection.value);\n    setPreviousValue(selection.value);\n    setValueString(getValueString(selection.value));\n    setCurrentTier(getNextGroupId(selection.item));\n    onChange(selection);\n  }, [getNextGroupId, getValueString, onChange]);\n  var internalOnNavigate = React.useCallback(function (nextGroupId, value) {\n    setInternalValue(value);\n    setCurrentTier(nextGroupId);\n    onNavigate && onNavigate(nextGroupId, value);\n  }, [onNavigate]);\n  var internalOnClear = React.useCallback(function (event) {\n    setValueString('');\n    setInternalValue([]);\n    setPreviousValue([]);\n    internalOnNavigate(null, []);\n    onClear && onClear(event);\n  }, [internalOnNavigate, onClear]);\n  var internalOnSearch = React.useCallback(function (event) {\n    onSearch && onSearch(event);\n  }, [onSearch]);\n  var internalBeforeHide = React.useCallback(function (e) {\n    var _a;\n\n    var isEscapeKey = e instanceof KeyboardEvent && (e.key === 'Escape' || e.key === 'Esc');\n    var isClickOutside = e instanceof MouseEvent && !isEventSource({\n      current: (_a = tieredSelectMenuRef === null || tieredSelectMenuRef === void 0 ? void 0 : tieredSelectMenuRef.current) === null || _a === void 0 ? void 0 : _a.el\n    }, e);\n    var lastValue = previousValue[previousValue.length - 1];\n\n    if (valueString && (isClickOutside || isEscapeKey)) {\n      setInternalValue(previousValue);\n      setCurrentTier(getNextGroupId(lastValue));\n    }\n\n    return beforeHide && beforeHide(e);\n  }, [beforeHide, getNextGroupId, tieredSelectMenuRef, previousValue, valueString]);\n  return React.createElement(OverlayTrigger, {\n    afterHide: afterHide,\n    afterShow: afterShow,\n    beforeHide: internalBeforeHide,\n    beforeShow: function (e) {\n      return beforeShow && e.target !== clearRef.current && beforeShow(e);\n    },\n    canFlip: true,\n    hideKeys: hideKeys,\n    overlay: React.createElement(TieredSelectMenu, __assign({\n      currentTier: currentTier,\n      options: options,\n      loading: loading,\n      menuRef: tieredSelectMenuRef,\n      onNavigate: internalOnNavigate,\n      onSearch: internalOnSearch,\n      onChange: internalOnChange,\n      value: internalValue,\n      previousValue: previousValue\n    }, props)),\n    placement: \"bottom-left\",\n    ref: ref,\n    trigger: \"click\"\n  }, React.createElement(SelectButton, {\n    block: block,\n    className: className,\n    clearRef: clearRef,\n    disabled: disabled,\n    error: error,\n    label: valueString,\n    loading: loading,\n    placeholder: I18n.t('placeholder', {\n      scope: i18nScope\n    }),\n    onClear: internalOnClear,\n    ref: tieredSelectButtonRef,\n    tabIndex: tabIndex\n  }, valueString || I18n.t('placeholder', {\n    scope: i18nScope\n  })));\n});","map":{"version":3,"sources":["../../../../src/components/TieredSelect/TierSelectionTieredSelect.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { ChevronRight, Home, Plus } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { isEventSource } from '../../effects/ClickOutside';\nimport { Box } from '../../layouts/Box';\nimport { FlexList } from '../../layouts/FlexList';\nimport { useI18nContext } from '../../state/I18n';\nimport { Breadcrumbs } from '../Breadcrumbs';\nimport { Button } from '../Button';\nimport { Input } from '../Input';\nimport { MenuImperative } from '../MenuImperative';\nimport { CloseOnFocus, OverlayTrigger, useOverlayTriggerContext, } from '../OverlayTrigger';\nimport { Button as SelectButton } from '../Select';\nimport Spinner from '../Spinner';\nimport { Typography } from '../Typography/Typography';\nimport { TieredSelectContext, useHighlightItemEffects } from './TieredSelect';\nimport { StyledTieredSelect, StyledTieredSelectArrowButton, StyledTieredSelectBreadcrumbs, StyledTieredSelectHome, StyledTieredSelectLoadingMore, StyledTieredSelectOption, StyledTieredSelectOverlay, StyledTieredSelectSpinnerOverlay, } from './TieredSelect.styles';\nvar empty = [];\nvar hideKeys = {\n    overlay: ['Escape', 'Esc'],\n    target: ['Escape', 'Esc'],\n};\nfunction ArrowButton(_a) {\n    var onClick = _a.onClick, props = __rest(_a, [\"onClick\"]);\n    return (React.createElement(StyledTieredSelectArrowButton, __assign({}, props, { icon: React.createElement(ChevronRight, null), onClick: function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            onClick && onClick(event);\n        }, size: \"sm\", tabIndex: -1, variant: \"tertiary\" })));\n}\nvar QuickCreateInput = React.forwardRef(function QuickCreateInput(_a, ref) {\n    var autoFocus = _a.autoFocus, onSubmit = _a.onSubmit, placeholder = _a.placeholder;\n    function onKeyDown(e) {\n        if (e.key === 'Enter') {\n            onSubmit(e.currentTarget.value);\n        }\n    }\n    return (React.createElement(Box, { flexGrow: \"1\", justifyContent: \"center\", padding: \"md\" },\n        React.createElement(Input, { autoFocus: autoFocus, onKeyDown: onKeyDown, placeholder: placeholder, ref: ref })));\n});\nfunction Options(_a) {\n    var children = _a.children, emptyMessage = _a.emptyMessage, props = __rest(_a, [\"children\", \"emptyMessage\"]);\n    if (React.Children.count(children) === 0) {\n        return (React.createElement(MenuImperative.Options, null,\n            React.createElement(Box, __assign({ paddingLeft: \"lg\" }, props),\n                React.createElement(Typography, { color: \"gray45\", intent: \"small\", italic: true }, emptyMessage))));\n    }\n    return React.createElement(MenuImperative.Options, null, children);\n}\nvar TieredSelectMenu = React.forwardRef(function TieredSelectMenu(_a, ref) {\n    var children = _a.children, currentTier = _a.currentTier, loading = _a.loading, loadingMore = _a.loadingMore, menuRef = _a.menuRef, onNavigate = _a.onNavigate, onSearch = _a.onSearch, onChange = _a.onChange, _b = _a.options, options = _b === void 0 ? empty : _b, value = _a.value, previousValue = _a.previousValue, props = __rest(_a, [\"children\", \"currentTier\", \"loading\", \"loadingMore\", \"menuRef\", \"onNavigate\", \"onSearch\", \"onChange\", \"options\", \"value\", \"previousValue\"]);\n    var _c = React.useContext(TieredSelectContext), getGroupId = _c.getGroupId, getId = _c.getId, getLabel = _c.getLabel, getNextGroupId = _c.getNextGroupId, i18nScope = _c.i18nScope, onQuickCreate = _c.onQuickCreate, onScrollBottom = _c.onScrollBottom;\n    var quickCreateRef = React.useRef(null);\n    var hide = useOverlayTriggerContext().hide;\n    var I18n = useI18nContext();\n    var _d = React.useState(false), isQuickCreating = _d[0], setIsQuickCreating = _d[1];\n    var _e = React.useState(''), searchValue = _e[0], setSearchValue = _e[1];\n    var searchIsEmpty = searchValue === '';\n    var lastEntryInValue = value[value.length - 1];\n    var internalOnSearch = React.useCallback(function (e) {\n        setSearchValue(e.target.value);\n        onSearch && onSearch(e);\n    }, [onSearch]);\n    // When searching (all options have been flattened) we dont filter by id\n    var filteredOptions = React.useMemo(function () {\n        return searchIsEmpty\n            ? options.filter(function (tier) {\n                return getGroupId(tier) === currentTier;\n            })\n            : options;\n    }, [currentTier, getGroupId, options, searchIsEmpty]);\n    useHighlightItemEffects({\n        currentTier: currentTier,\n        searchValue: searchValue,\n        menuRef: menuRef,\n        loading: loading,\n        loadingMore: loadingMore,\n    });\n    var onNavigateHome = React.useCallback(function () {\n        var _a;\n        onNavigate(null, []);\n        (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }, [menuRef, onNavigate]);\n    var onBreadCrumbNavigate = React.useCallback(function (tier) {\n        var _a;\n        var newTier = value.indexOf(tier);\n        onNavigate(getNextGroupId(tier), value.slice(0, newTier + 1));\n        (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }, [getNextGroupId, menuRef, onNavigate, value]);\n    function onNavigateForward(tier) {\n        var _a;\n        if (searchIsEmpty && !isQuickCreating && tier) {\n            var newValue = __spreadArray(__spreadArray([], value, true), [tier], false);\n            onNavigate(getNextGroupId(tier), newValue);\n            (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n        }\n    }\n    /**\n     * need to skip back two levels if coming from a leaf node;\n     * out from the leaf and then out of the parent. this is because\n     * when tiers aren't selectectable we show the parent of the leaf\n     */\n    function onNavigateBackward() {\n        var _a;\n        if (value.length !== 0 && searchIsEmpty) {\n            var newValue = value.slice(0, Math.max(0, value.length - 1));\n            var newTier = value[value.length - 1];\n            !isQuickCreating && onNavigate(getGroupId(newTier), newValue);\n            (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n        }\n    }\n    function onKeyDown(e) {\n        var _a;\n        var tier = (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlighted();\n        if (e.key === 'Right' || e.key === 'ArrowRight') {\n            onNavigateForward(tier);\n        }\n        else if (e.key === 'Left' || e.key === 'ArrowLeft') {\n            onNavigateBackward();\n        }\n    }\n    function onTierSelect(selection) {\n        var isSameGroup = value.length\n            ? getGroupId(lastEntryInValue) === getGroupId(selection.item)\n            : false;\n        // if the selection is in the same group as the old selection, replace the old selection\n        var newValue = isSameGroup\n            ? __spreadArray(__spreadArray([], value.slice(0, value.length - 1), true), [selection.item], false) : __spreadArray(__spreadArray([], value, true), [selection.item], false);\n        onChange(__assign(__assign({}, selection), { value: newValue }));\n        searchValue &&\n            internalOnSearch({\n                target: { value: '' },\n            });\n        hide(selection.event);\n    }\n    function showBreadcrumbs() {\n        return value.length && searchIsEmpty;\n    }\n    var menuEmptyMessage = searchIsEmpty\n        ? I18n.t('emptyMessage', { scope: i18nScope })\n        : I18n.t('searchEmptyMessage', { scope: i18nScope });\n    var handleQuickCreate = React.useCallback(function (e) {\n        // stops menu from selecting item and closing on enter press\n        e.stopPropagation();\n        if (e.key === 'Enter') {\n            setIsQuickCreating(true);\n        }\n    }, [setIsQuickCreating]);\n    var onQuickCreateSubmit = React.useCallback(function () {\n        onQuickCreate &&\n            quickCreateRef.current &&\n            onQuickCreate(quickCreateRef.current.value);\n        setIsQuickCreating(false);\n    }, [onQuickCreate, quickCreateRef, setIsQuickCreating]);\n    function isTierSelected(tier) {\n        if (previousValue.length) {\n            return getId(tier) === getId(previousValue[previousValue.length - 1]);\n        }\n        return false;\n    }\n    return (React.createElement(StyledTieredSelectOverlay, { ref: ref, shadowStrength: 2 },\n        React.createElement(StyledTieredSelectSpinnerOverlay, { \"data-qa\": \"tiered-select-loading\", \"data-loading\": loading, loading: loading, label: I18n.t('spinnerLabel', { scope: i18nScope }) || '', size: \"md\" },\n            React.createElement(StyledTieredSelect, __assign({ onKeyDown: onKeyDown, onScrollBottom: onScrollBottom, onSelect: onTierSelect, ref: menuRef }, props),\n                React.createElement(MenuImperative.Header, null,\n                    !isQuickCreating && (React.createElement(MenuImperative.Search, { autoComplete: \"false\", autoFocus: true, onChange: internalOnSearch, placeholder: I18n.t('searchPlaceholder', {\n                            scope: i18nScope,\n                        }) })),\n                    showBreadcrumbs() ? (React.createElement(StyledTieredSelectBreadcrumbs, { \"$nonInteractive\": isQuickCreating },\n                        React.createElement(Breadcrumbs.Crumb, { onClick: onNavigateHome },\n                            React.createElement(StyledTieredSelectHome, { alignItems: \"center\", justifyContent: \"center\" },\n                                React.createElement(Home, { \"data-qa\": \"tiered-select-home\" }))),\n                        value.map(function (tier, index, array) {\n                            return (React.createElement(Breadcrumbs.Crumb, { active: index === array.length - 1, key: \"\".concat(getId(tier), \"-\").concat(index), onClick: function () { return onBreadCrumbNavigate(tier); } }, getLabel(tier)));\n                        }))) : null),\n                !isQuickCreating ? (React.createElement(Options, { emptyMessage: menuEmptyMessage }, filteredOptions\n                    .map(function (tier, index) {\n                    return (React.createElement(StyledTieredSelectOption, { item: tier, key: \"\".concat(getId(tier), \"-\").concat(index), selected: isTierSelected(tier) },\n                        getLabel(tier),\n                        (getNextGroupId(tier) || onQuickCreate) && (React.createElement(Box, { paddingLeft: \"sm\" },\n                            React.createElement(ArrowButton, { \"data-qa\": \"tiered-select-arrow\", onClick: function () { return onNavigateForward(tier); } })))));\n                })\n                    .concat(loadingMore && !loading\n                    ? [\n                        React.createElement(StyledTieredSelectLoadingMore, { \"data-qa\": \"tiered-select-loading-more\", key: 'tiered-select-loading-more' },\n                            React.createElement(Spinner, { size: \"sm\" })),\n                    ]\n                    : []))) : (React.createElement(QuickCreateInput, { autoFocus: isQuickCreating, onSubmit: onQuickCreateSubmit, placeholder: I18n.t('quickCreatePlaceholder', {\n                        scope: i18nScope,\n                    }), ref: quickCreateRef })),\n                onQuickCreate && (React.createElement(MenuImperative.Footer, null, isQuickCreating ? (React.createElement(FlexList, { size: \"xs\", justifyContent: \"flex-end\" },\n                    React.createElement(Button, { onClick: function () { return setIsQuickCreating(false); }, size: \"sm\", variant: \"tertiary\" }, I18n.t('quickCreateCancelLabel', {\n                        scope: i18nScope,\n                    })),\n                    React.createElement(Button, { onClick: onQuickCreateSubmit, size: \"sm\" }, I18n.t('quickCreateCreateLabel', {\n                        scope: i18nScope,\n                    })))) : (React.createElement(Button, { block: true, icon: React.createElement(Plus, { size: \"md\" }), onClick: function () { return setIsQuickCreating(true); }, onKeyDown: handleQuickCreate, size: \"sm\" }, I18n.t('quickCreateActionLabel', {\n                    scope: i18nScope,\n                }))))),\n                React.createElement(CloseOnFocus, { hide: hide })))));\n});\nexport var TierSelectionTieredSelect = React.forwardRef(function TierSelectionTieredSelect(_a, ref) {\n    var className = _a.className, _b = _a.disabled, disabled = _b === void 0 ? false : _b, _c = _a.error, error = _c === void 0 ? false : _c, _d = _a.loading, loading = _d === void 0 ? false : _d, onKeyDown = _a.onKeyDown, _e = _a.options, options = _e === void 0 ? empty : _e, _f = _a.value, value = _f === void 0 ? empty : _f, props = __rest(_a, [\"className\", \"disabled\", \"error\", \"loading\", \"onKeyDown\", \"options\", \"value\"]);\n    var _g = React.useContext(TieredSelectContext), afterHide = _g.afterHide, afterShow = _g.afterShow, beforeHide = _g.beforeHide, beforeShow = _g.beforeShow, block = _g.block, getLabel = _g.getLabel, getNextGroupId = _g.getNextGroupId, getValueString = _g.getValueString, i18nScope = _g.i18nScope, isLeaf = _g.isLeaf, onChange = _g.onChange, onClear = _g.onClear, onNavigate = _g.onNavigate, onSearch = _g.onSearch, tabIndex = _g.tabIndex;\n    var I18n = useI18nContext();\n    var tieredSelectMenuRef = React.useRef(null);\n    var tieredSelectButtonRef = React.useRef(null);\n    var clearRef = React.createRef();\n    var _h = React.useState(''), valueString = _h[0], setValueString = _h[1];\n    var _j = React.useState(null), currentTier = _j[0], setCurrentTier = _j[1];\n    // internal value used for navigation\n    var _k = React.useState(value), internalValue = _k[0], setInternalValue = _k[1];\n    // value to reset to if navigation occurs but no selection has been made\n    var _l = React.useState(value), previousValue = _l[0], setPreviousValue = _l[1];\n    // if value prop changes, update value state, current tier, and set button label\n    // else open to root\n    React.useEffect(function () {\n        var lastEntryInValue = value[value.length - 1];\n        if (value.length > 0) {\n            setInternalValue(value);\n            setPreviousValue(value);\n            setValueString(getValueString(value));\n            // show children of last tier in value\n            setCurrentTier(getNextGroupId(lastEntryInValue));\n        }\n        else {\n            setCurrentTier(null);\n            setInternalValue([]);\n            setPreviousValue([]);\n            setValueString('');\n        }\n    }, [getValueString, getNextGroupId, isLeaf, value]);\n    var internalOnChange = React.useCallback(function (selection) {\n        setInternalValue(selection.value);\n        setPreviousValue(selection.value);\n        setValueString(getValueString(selection.value));\n        setCurrentTier(getNextGroupId(selection.item));\n        onChange(selection);\n    }, [getNextGroupId, getValueString, onChange]);\n    var internalOnNavigate = React.useCallback(function (nextGroupId, value) {\n        setInternalValue(value);\n        setCurrentTier(nextGroupId);\n        onNavigate && onNavigate(nextGroupId, value);\n    }, [onNavigate]);\n    var internalOnClear = React.useCallback(function (event) {\n        setValueString('');\n        setInternalValue([]);\n        setPreviousValue([]);\n        internalOnNavigate(null, []);\n        onClear && onClear(event);\n    }, [internalOnNavigate, onClear]);\n    var internalOnSearch = React.useCallback(function (event) {\n        onSearch && onSearch(event);\n    }, [onSearch]);\n    var internalBeforeHide = React.useCallback(function (e) {\n        var _a;\n        var isEscapeKey = e instanceof KeyboardEvent && (e.key === 'Escape' || e.key === 'Esc');\n        var isClickOutside = e instanceof MouseEvent &&\n            !isEventSource({ current: (_a = tieredSelectMenuRef === null || tieredSelectMenuRef === void 0 ? void 0 : tieredSelectMenuRef.current) === null || _a === void 0 ? void 0 : _a.el }, e);\n        var lastValue = previousValue[previousValue.length - 1];\n        if (valueString && (isClickOutside || isEscapeKey)) {\n            setInternalValue(previousValue);\n            setCurrentTier(getNextGroupId(lastValue));\n        }\n        return beforeHide && beforeHide(e);\n    }, [\n        beforeHide,\n        getNextGroupId,\n        tieredSelectMenuRef,\n        previousValue,\n        valueString,\n    ]);\n    return (React.createElement(OverlayTrigger, { afterHide: afterHide, afterShow: afterShow, beforeHide: internalBeforeHide, beforeShow: function (e) {\n            return beforeShow && e.target !== clearRef.current && beforeShow(e);\n        }, canFlip: true, hideKeys: hideKeys, overlay: React.createElement(TieredSelectMenu, __assign({ currentTier: currentTier, options: options, loading: loading, menuRef: tieredSelectMenuRef, onNavigate: internalOnNavigate, onSearch: internalOnSearch, onChange: internalOnChange, value: internalValue, previousValue: previousValue }, props)), placement: \"bottom-left\", ref: ref, trigger: \"click\" },\n        React.createElement(SelectButton, { block: block, className: className, clearRef: clearRef, disabled: disabled, error: error, label: valueString, loading: loading, placeholder: I18n.t('placeholder', { scope: i18nScope }), onClear: internalOnClear, ref: tieredSelectButtonRef, tabIndex: tabIndex }, valueString || I18n.t('placeholder', { scope: i18nScope }))));\n});\n"]},"metadata":{},"sourceType":"module"}