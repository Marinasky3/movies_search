{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport { ChevronRight, Help, Home, Plus } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { Box } from '../../layouts/Box';\nimport { FlexList } from '../../layouts/FlexList';\nimport { useI18nContext } from '../../state/I18n';\nimport { Breadcrumbs } from '../Breadcrumbs';\nimport { Button } from '../Button';\nimport { Input } from '../Input';\nimport { MenuImperative } from '../MenuImperative';\nimport { CloseOnFocus, useOverlayTriggerContext } from '../OverlayTrigger';\nimport Spinner from '../Spinner';\nimport Tooltip from '../Tooltip';\nimport { Typography } from '../Typography/Typography';\nimport { TieredSelectContext, useHighlightItemEffects } from './TieredSelect';\nimport { StyledTieredSelect, StyledTieredSelectBreadcrumbs, StyledTieredSelectHome, StyledTieredSelectIcon, StyledTieredSelectLoadingMore, StyledTieredSelectOption, StyledTieredSelectOverlay, StyledTieredSelectSpinnerOverlay } from './TieredSelect.styles';\n\nfunction ArrowButton(props) {\n  return React.createElement(StyledTieredSelectIcon, {\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  }, React.createElement(ChevronRight, null));\n}\n\nfunction ItemTooltipIcon() {\n  return React.createElement(StyledTieredSelectIcon, {\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  }, React.createElement(Help, null));\n}\n\nvar QuickCreateInput = React.forwardRef(function QuickCreateInput(_a, ref) {\n  var autoFocus = _a.autoFocus,\n      onSubmit = _a.onSubmit,\n      placeholder = _a.placeholder;\n\n  function onKeyDown(e) {\n    if (e.key === 'Enter') {\n      onSubmit(e.currentTarget.value);\n    }\n  }\n\n  return React.createElement(Box, {\n    flexGrow: \"1\",\n    justifyContent: \"center\",\n    padding: \"md\"\n  }, React.createElement(Input, {\n    autoFocus: autoFocus,\n    onKeyDown: onKeyDown,\n    placeholder: placeholder,\n    ref: ref\n  }));\n});\n\nfunction Options(_a) {\n  var children = _a.children,\n      emptyMessage = _a.emptyMessage,\n      props = __rest(_a, [\"children\", \"emptyMessage\"]);\n\n  if (React.Children.count(children) === 0) {\n    return React.createElement(MenuImperative.Options, null, React.createElement(Box, __assign({\n      paddingLeft: \"lg\"\n    }, props), React.createElement(Typography, {\n      color: \"gray45\",\n      intent: \"small\",\n      italic: true\n    }, emptyMessage)));\n  }\n\n  return React.createElement(MenuImperative.Options, null, children);\n}\n\nexport var TieredSelectMenu = React.forwardRef(function TieredSelectMenu(_a, ref) {\n  var children = _a.children,\n      currentTier = _a.currentTier,\n      loading = _a.loading,\n      loadingMore = _a.loadingMore,\n      menuRef = _a.menuRef,\n      onChange = _a.onChange,\n      onNavigate = _a.onNavigate,\n      onSearch = _a.onSearch,\n      options = _a.options,\n      previousValue = _a.previousValue,\n      value = _a.value,\n      props = __rest(_a, [\"children\", \"currentTier\", \"loading\", \"loadingMore\", \"menuRef\", \"onChange\", \"onNavigate\", \"onSearch\", \"options\", \"previousValue\", \"value\"]);\n\n  var _b = React.useContext(TieredSelectContext),\n      getGroupId = _b.getGroupId,\n      getId = _b.getId,\n      getLabel = _b.getLabel,\n      getNextGroupId = _b.getNextGroupId,\n      i18nScope = _b.i18nScope,\n      isTierDisabled = _b.isTierDisabled,\n      onQuickCreate = _b.onQuickCreate,\n      onScrollBottom = _b.onScrollBottom;\n\n  var quickCreateRef = React.useRef(null);\n  var hide = useOverlayTriggerContext().hide;\n  var I18n = useI18nContext();\n\n  var _c = React.useState(false),\n      isQuickCreating = _c[0],\n      setIsQuickCreating = _c[1];\n\n  var _d = React.useState(''),\n      searchValue = _d[0],\n      setSearchValue = _d[1];\n\n  var searchIsEmpty = searchValue === '';\n  var lastEntryInValue = value[value.length - 1];\n  var internalOnSearch = React.useCallback(function (e) {\n    setSearchValue(e.target.value);\n    onSearch && onSearch(e);\n  }, [onSearch]); // When searching (all options have been flattened) we dont filter by id\n\n  var filteredOptions = React.useMemo(function () {\n    return searchIsEmpty ? options.filter(function (tier) {\n      return getGroupId(tier) === currentTier;\n    }) : options;\n  }, [currentTier, getGroupId, options, searchIsEmpty]);\n  useHighlightItemEffects({\n    currentTier: currentTier,\n    searchValue: searchValue,\n    menuRef: menuRef,\n    loading: loading,\n    loadingMore: loadingMore\n  });\n  var onNavigateHome = React.useCallback(function () {\n    var _a;\n\n    onNavigate(null, []);\n    (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n  }, [menuRef, onNavigate]);\n  var onBreadCrumbNavigate = React.useCallback(function (tier) {\n    var _a;\n\n    var newTier = value.indexOf(tier);\n    onNavigate(getNextGroupId(tier), value.slice(0, newTier + 1));\n    (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n  }, [getNextGroupId, menuRef, onNavigate, value]);\n\n  function onNavigateForward(tier) {\n    var _a;\n\n    if (searchIsEmpty && !isQuickCreating && tier && !isLeaf(tier)) {\n      // if last value was a leaf, replace it when performing next navigation\n      var newValue = lastEntryInValue && isLeaf(lastEntryInValue) ? __spreadArray(__spreadArray([], value.slice(0, value.length - 1), true), [tier], false) : __spreadArray(__spreadArray([], value, true), [tier], false);\n      onNavigate(getNextGroupId(tier), newValue);\n      (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }\n  }\n  /**\n   * need to skip back two levels if coming from a leaf node;\n   * out from the leaf and then out of the parent. this is because\n   * when tiers aren't selectectable we show the parent of the leaf\n   */\n\n\n  function onNavigateBackward() {\n    var _a;\n\n    if (value.length !== 0 && searchIsEmpty) {\n      var newValue = void 0;\n      var newTier = void 0;\n\n      if (isLeaf(value[value.length - 1])) {\n        newValue = value.slice(0, Math.max(0, value.length - 2));\n        newTier = value[Math.max(0, value.length - 2)];\n      } else {\n        newValue = value.slice(0, Math.max(0, value.length - 1));\n        newTier = value[value.length - 1];\n      }\n\n      !isQuickCreating && onNavigate(getGroupId(newTier), newValue);\n      (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }\n  }\n\n  function onKeyDown(e) {\n    var _a;\n\n    var tier = (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlighted();\n    var isDisabled = isTierDisabled === null || isTierDisabled === void 0 ? void 0 : isTierDisabled(tier);\n\n    if (isDisabled) {\n      return;\n    }\n\n    if (e.key === 'Right' || e.key === 'ArrowRight') {\n      onNavigateForward(tier);\n    } else if (e.key === 'Left' || e.key === 'ArrowLeft') {\n      onNavigateBackward();\n    }\n  }\n\n  var isLeaf = React.useCallback(function (tier) {\n    return !getNextGroupId(tier);\n  }, [getNextGroupId]);\n\n  function onTierSelect(selection) {\n    if (isLeaf(selection.item)) {\n      var isSameGroup = value.length ? getGroupId(lastEntryInValue) === getGroupId(selection.item) : false; // if the selection is in the same group as the old selection, replace the old selection\n\n      var newValue = isSameGroup ? __spreadArray(__spreadArray([], value.slice(0, value.length - 1), true), [selection.item], false) : __spreadArray(__spreadArray([], value, true), [selection.item], false);\n      onChange(__assign(__assign({}, selection), {\n        value: newValue\n      }));\n      searchValue && internalOnSearch({\n        target: {\n          value: ''\n        }\n      });\n      hide(selection.event);\n    } else {\n      onNavigateForward(selection.item);\n    }\n  } // non-selectable tiers can have a leaf node in the root tier, so if selected\n  // it will reopen to the root tier and we should not show breadcrumbs\n\n\n  function showBreadcrumbs() {\n    return value.length && searchIsEmpty && !(value.length === 1 && isLeaf(value[value.length - 1]));\n  }\n\n  var menuEmptyMessage = searchIsEmpty ? I18n.t('emptyMessage', {\n    scope: i18nScope\n  }) : I18n.t('searchEmptyMessage', {\n    scope: i18nScope\n  });\n  var handleQuickCreate = React.useCallback(function (e) {\n    // stops menu from selecting item and closing on enter press\n    e.stopPropagation();\n\n    if (e.key === 'Enter') {\n      setIsQuickCreating(true);\n    }\n  }, [setIsQuickCreating]);\n  var onQuickCreateSubmit = React.useCallback(function () {\n    onQuickCreate && quickCreateRef.current && onQuickCreate(quickCreateRef.current.value);\n    setIsQuickCreating(false);\n  }, [onQuickCreate, quickCreateRef, setIsQuickCreating]);\n\n  function isTierSelected(tier) {\n    if (previousValue.length) {\n      return getId(tier) === getId(previousValue[previousValue.length - 1]);\n    }\n\n    return false;\n  }\n\n  function RenderMenuItem(_a) {\n    var tier = _a.tier,\n        index = _a.index;\n    var tooltip = (isTierDisabled === null || isTierDisabled === void 0 ? void 0 : isTierDisabled(tier)) || false;\n    var isDisabled = Boolean(tooltip);\n    var showNextTierArrow = !tooltip && (Boolean(getNextGroupId(tier)) || Boolean(onQuickCreate));\n    var overlay = typeof tooltip === 'string' ? tooltip : null;\n    var MenuItem = React.createElement(StyledTieredSelectOption, {\n      disabled: isDisabled,\n      item: tier,\n      selected: isTierSelected(tier)\n    }, React.createElement(React.Fragment, null, getLabel(tier), showNextTierArrow && React.createElement(Box, {\n      paddingLeft: \"sm\"\n    }, React.createElement(ArrowButton, {\n      \"data-qa\": \"tiered-select-arrow\",\n      onClick: function () {\n        return onNavigateForward(tier);\n      }\n    })), tooltip && React.createElement(Box, {\n      paddingLeft: \"sm\"\n    }, React.createElement(ItemTooltipIcon, null))));\n\n    if (isDisabled && overlay) {\n      return React.createElement(Tooltip, {\n        key: \"\".concat(getId(tier), \"-\").concat(index, \"-tooltip\"),\n        overlay: overlay,\n        trigger: 'hover',\n        placement: \"right\"\n      }, MenuItem);\n    }\n\n    return MenuItem;\n  }\n\n  function RenderLoadingMore() {\n    if (loadingMore && !loading) {\n      return React.createElement(StyledTieredSelectLoadingMore, {\n        \"data-qa\": \"tiered-select-loading-more\"\n      }, React.createElement(Spinner, {\n        size: \"sm\"\n      }));\n    }\n\n    return null;\n  }\n\n  return React.createElement(StyledTieredSelectOverlay, {\n    ref: ref,\n    shadowStrength: 2\n  }, React.createElement(StyledTieredSelectSpinnerOverlay, {\n    \"data-qa\": \"tiered-select-loading\",\n    \"data-loading\": loading,\n    label: I18n.t('spinnerLabel', {\n      scope: i18nScope\n    }) || '',\n    loading: loading,\n    size: \"md\"\n  }, React.createElement(StyledTieredSelect, __assign({\n    onKeyDown: onKeyDown,\n    onScrollBottom: onScrollBottom,\n    onSelect: onTierSelect,\n    ref: menuRef\n  }, props), React.createElement(MenuImperative.Header, null, !isQuickCreating && React.createElement(MenuImperative.Search, {\n    autoComplete: \"false\",\n    autoFocus: true,\n    onChange: internalOnSearch,\n    placeholder: I18n.t('searchPlaceholder', {\n      scope: i18nScope\n    })\n  }), showBreadcrumbs() ? React.createElement(StyledTieredSelectBreadcrumbs, {\n    \"$nonInteractive\": isQuickCreating\n  }, React.createElement(Breadcrumbs.Crumb, {\n    onClick: onNavigateHome\n  }, React.createElement(StyledTieredSelectHome, {\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  }, React.createElement(Home, {\n    \"data-qa\": \"tiered-select-home\"\n  }))), value.filter(function (tier) {\n    // we reopen to the parent of leaf nodes, so don't show that breadcrumb\n    return !isLeaf(tier);\n  }).map(function (tier, index, array) {\n    return React.createElement(Breadcrumbs.Crumb, {\n      active: index === array.length - 1,\n      key: \"\".concat(getId(tier), \"-\").concat(index),\n      onClick: function () {\n        return onBreadCrumbNavigate(tier);\n      }\n    }, getLabel(tier));\n  })) : null), !isQuickCreating ? React.createElement(Options, {\n    emptyMessage: menuEmptyMessage\n  }, filteredOptions.map(function (tier, index) {\n    return React.createElement(RenderMenuItem, {\n      key: \"menu-item-\".concat(getId(tier), \"-\").concat(index, \"}\"),\n      tier: tier,\n      index: index\n    });\n  }).concat(React.createElement(RenderLoadingMore, {\n    key: \"tiered-select-loading-more\"\n  }))) : React.createElement(QuickCreateInput, {\n    autoFocus: isQuickCreating,\n    onSubmit: onQuickCreateSubmit,\n    placeholder: I18n.t('quickCreatePlaceholder', {\n      scope: i18nScope\n    }),\n    ref: quickCreateRef\n  }), onQuickCreate && React.createElement(MenuImperative.Footer, {\n    \"data-something\": \"true\"\n  }, isQuickCreating ? React.createElement(FlexList, {\n    size: \"xs\",\n    justifyContent: \"flex-end\"\n  }, React.createElement(Button, {\n    onClick: function () {\n      return setIsQuickCreating(false);\n    },\n    size: \"sm\",\n    variant: \"tertiary\"\n  }, I18n.t('quickCreateCancelLabel', {\n    scope: i18nScope\n  })), React.createElement(Button, {\n    onClick: onQuickCreateSubmit,\n    size: \"sm\"\n  }, I18n.t('quickCreateCreateLabel', {\n    scope: i18nScope\n  }))) : React.createElement(Button, {\n    block: true,\n    size: \"sm\",\n    icon: React.createElement(Plus, null),\n    onClick: function () {\n      return setIsQuickCreating(true);\n    },\n    onKeyDown: handleQuickCreate\n  }, I18n.t('quickCreateActionLabel', {\n    scope: i18nScope\n  }))), React.createElement(CloseOnFocus, {\n    hide: hide\n  }))));\n});","map":{"version":3,"sources":["../../../../src/components/TieredSelect/TieredSelectMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { ChevronRight, Help, Home, Plus } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { Box } from '../../layouts/Box';\nimport { FlexList } from '../../layouts/FlexList';\nimport { useI18nContext } from '../../state/I18n';\nimport { Breadcrumbs } from '../Breadcrumbs';\nimport { Button } from '../Button';\nimport { Input } from '../Input';\nimport { MenuImperative } from '../MenuImperative';\nimport { CloseOnFocus, useOverlayTriggerContext } from '../OverlayTrigger';\nimport Spinner from '../Spinner';\nimport Tooltip from '../Tooltip';\nimport { Typography } from '../Typography/Typography';\nimport { TieredSelectContext, useHighlightItemEffects } from './TieredSelect';\nimport { StyledTieredSelect, StyledTieredSelectBreadcrumbs, StyledTieredSelectHome, StyledTieredSelectIcon, StyledTieredSelectLoadingMore, StyledTieredSelectOption, StyledTieredSelectOverlay, StyledTieredSelectSpinnerOverlay, } from './TieredSelect.styles';\nfunction ArrowButton(props) {\n    return (React.createElement(StyledTieredSelectIcon, { alignItems: \"center\", justifyContent: \"center\" },\n        React.createElement(ChevronRight, null)));\n}\nfunction ItemTooltipIcon() {\n    return (React.createElement(StyledTieredSelectIcon, { alignItems: \"center\", justifyContent: \"center\" },\n        React.createElement(Help, null)));\n}\nvar QuickCreateInput = React.forwardRef(function QuickCreateInput(_a, ref) {\n    var autoFocus = _a.autoFocus, onSubmit = _a.onSubmit, placeholder = _a.placeholder;\n    function onKeyDown(e) {\n        if (e.key === 'Enter') {\n            onSubmit(e.currentTarget.value);\n        }\n    }\n    return (React.createElement(Box, { flexGrow: \"1\", justifyContent: \"center\", padding: \"md\" },\n        React.createElement(Input, { autoFocus: autoFocus, onKeyDown: onKeyDown, placeholder: placeholder, ref: ref })));\n});\nfunction Options(_a) {\n    var children = _a.children, emptyMessage = _a.emptyMessage, props = __rest(_a, [\"children\", \"emptyMessage\"]);\n    if (React.Children.count(children) === 0) {\n        return (React.createElement(MenuImperative.Options, null,\n            React.createElement(Box, __assign({ paddingLeft: \"lg\" }, props),\n                React.createElement(Typography, { color: \"gray45\", intent: \"small\", italic: true }, emptyMessage))));\n    }\n    return React.createElement(MenuImperative.Options, null, children);\n}\nexport var TieredSelectMenu = React.forwardRef(function TieredSelectMenu(_a, ref) {\n    var children = _a.children, currentTier = _a.currentTier, loading = _a.loading, loadingMore = _a.loadingMore, menuRef = _a.menuRef, onChange = _a.onChange, onNavigate = _a.onNavigate, onSearch = _a.onSearch, options = _a.options, previousValue = _a.previousValue, value = _a.value, props = __rest(_a, [\"children\", \"currentTier\", \"loading\", \"loadingMore\", \"menuRef\", \"onChange\", \"onNavigate\", \"onSearch\", \"options\", \"previousValue\", \"value\"]);\n    var _b = React.useContext(TieredSelectContext), getGroupId = _b.getGroupId, getId = _b.getId, getLabel = _b.getLabel, getNextGroupId = _b.getNextGroupId, i18nScope = _b.i18nScope, isTierDisabled = _b.isTierDisabled, onQuickCreate = _b.onQuickCreate, onScrollBottom = _b.onScrollBottom;\n    var quickCreateRef = React.useRef(null);\n    var hide = useOverlayTriggerContext().hide;\n    var I18n = useI18nContext();\n    var _c = React.useState(false), isQuickCreating = _c[0], setIsQuickCreating = _c[1];\n    var _d = React.useState(''), searchValue = _d[0], setSearchValue = _d[1];\n    var searchIsEmpty = searchValue === '';\n    var lastEntryInValue = value[value.length - 1];\n    var internalOnSearch = React.useCallback(function (e) {\n        setSearchValue(e.target.value);\n        onSearch && onSearch(e);\n    }, [onSearch]);\n    // When searching (all options have been flattened) we dont filter by id\n    var filteredOptions = React.useMemo(function () {\n        return searchIsEmpty\n            ? options.filter(function (tier) {\n                return getGroupId(tier) === currentTier;\n            })\n            : options;\n    }, [currentTier, getGroupId, options, searchIsEmpty]);\n    useHighlightItemEffects({\n        currentTier: currentTier,\n        searchValue: searchValue,\n        menuRef: menuRef,\n        loading: loading,\n        loadingMore: loadingMore,\n    });\n    var onNavigateHome = React.useCallback(function () {\n        var _a;\n        onNavigate(null, []);\n        (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }, [menuRef, onNavigate]);\n    var onBreadCrumbNavigate = React.useCallback(function (tier) {\n        var _a;\n        var newTier = value.indexOf(tier);\n        onNavigate(getNextGroupId(tier), value.slice(0, newTier + 1));\n        (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }, [getNextGroupId, menuRef, onNavigate, value]);\n    function onNavigateForward(tier) {\n        var _a;\n        if (searchIsEmpty && !isQuickCreating && tier && !isLeaf(tier)) {\n            // if last value was a leaf, replace it when performing next navigation\n            var newValue = lastEntryInValue && isLeaf(lastEntryInValue)\n                ? __spreadArray(__spreadArray([], value.slice(0, value.length - 1), true), [tier], false) : __spreadArray(__spreadArray([], value, true), [tier], false);\n            onNavigate(getNextGroupId(tier), newValue);\n            (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n        }\n    }\n    /**\n     * need to skip back two levels if coming from a leaf node;\n     * out from the leaf and then out of the parent. this is because\n     * when tiers aren't selectectable we show the parent of the leaf\n     */\n    function onNavigateBackward() {\n        var _a;\n        if (value.length !== 0 && searchIsEmpty) {\n            var newValue = void 0;\n            var newTier = void 0;\n            if (isLeaf(value[value.length - 1])) {\n                newValue = value.slice(0, Math.max(0, value.length - 2));\n                newTier = value[Math.max(0, value.length - 2)];\n            }\n            else {\n                newValue = value.slice(0, Math.max(0, value.length - 1));\n                newTier = value[value.length - 1];\n            }\n            !isQuickCreating && onNavigate(getGroupId(newTier), newValue);\n            (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n        }\n    }\n    function onKeyDown(e) {\n        var _a;\n        var tier = (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlighted();\n        var isDisabled = isTierDisabled === null || isTierDisabled === void 0 ? void 0 : isTierDisabled(tier);\n        if (isDisabled) {\n            return;\n        }\n        if (e.key === 'Right' || e.key === 'ArrowRight') {\n            onNavigateForward(tier);\n        }\n        else if (e.key === 'Left' || e.key === 'ArrowLeft') {\n            onNavigateBackward();\n        }\n    }\n    var isLeaf = React.useCallback(function (tier) {\n        return !getNextGroupId(tier);\n    }, [getNextGroupId]);\n    function onTierSelect(selection) {\n        if (isLeaf(selection.item)) {\n            var isSameGroup = value.length\n                ? getGroupId(lastEntryInValue) === getGroupId(selection.item)\n                : false;\n            // if the selection is in the same group as the old selection, replace the old selection\n            var newValue = isSameGroup\n                ? __spreadArray(__spreadArray([], value.slice(0, value.length - 1), true), [selection.item], false) : __spreadArray(__spreadArray([], value, true), [selection.item], false);\n            onChange(__assign(__assign({}, selection), { value: newValue }));\n            searchValue &&\n                internalOnSearch({\n                    target: { value: '' },\n                });\n            hide(selection.event);\n        }\n        else {\n            onNavigateForward(selection.item);\n        }\n    }\n    // non-selectable tiers can have a leaf node in the root tier, so if selected\n    // it will reopen to the root tier and we should not show breadcrumbs\n    function showBreadcrumbs() {\n        return (value.length &&\n            searchIsEmpty &&\n            !(value.length === 1 && isLeaf(value[value.length - 1])));\n    }\n    var menuEmptyMessage = searchIsEmpty\n        ? I18n.t('emptyMessage', { scope: i18nScope })\n        : I18n.t('searchEmptyMessage', { scope: i18nScope });\n    var handleQuickCreate = React.useCallback(function (e) {\n        // stops menu from selecting item and closing on enter press\n        e.stopPropagation();\n        if (e.key === 'Enter') {\n            setIsQuickCreating(true);\n        }\n    }, [setIsQuickCreating]);\n    var onQuickCreateSubmit = React.useCallback(function () {\n        onQuickCreate &&\n            quickCreateRef.current &&\n            onQuickCreate(quickCreateRef.current.value);\n        setIsQuickCreating(false);\n    }, [onQuickCreate, quickCreateRef, setIsQuickCreating]);\n    function isTierSelected(tier) {\n        if (previousValue.length) {\n            return getId(tier) === getId(previousValue[previousValue.length - 1]);\n        }\n        return false;\n    }\n    function RenderMenuItem(_a) {\n        var tier = _a.tier, index = _a.index;\n        var tooltip = (isTierDisabled === null || isTierDisabled === void 0 ? void 0 : isTierDisabled(tier)) || false;\n        var isDisabled = Boolean(tooltip);\n        var showNextTierArrow = !tooltip && (Boolean(getNextGroupId(tier)) || Boolean(onQuickCreate));\n        var overlay = typeof tooltip === 'string' ? tooltip : null;\n        var MenuItem = (React.createElement(StyledTieredSelectOption, { disabled: isDisabled, item: tier, selected: isTierSelected(tier) },\n            React.createElement(React.Fragment, null,\n                getLabel(tier),\n                showNextTierArrow && (React.createElement(Box, { paddingLeft: \"sm\" },\n                    React.createElement(ArrowButton, { \"data-qa\": \"tiered-select-arrow\", onClick: function () { return onNavigateForward(tier); } }))),\n                tooltip && (React.createElement(Box, { paddingLeft: \"sm\" },\n                    React.createElement(ItemTooltipIcon, null))))));\n        if (isDisabled && overlay) {\n            return (React.createElement(Tooltip, { key: \"\".concat(getId(tier), \"-\").concat(index, \"-tooltip\"), overlay: overlay, trigger: 'hover', placement: \"right\" }, MenuItem));\n        }\n        return MenuItem;\n    }\n    function RenderLoadingMore() {\n        if (loadingMore && !loading) {\n            return (React.createElement(StyledTieredSelectLoadingMore, { \"data-qa\": \"tiered-select-loading-more\" },\n                React.createElement(Spinner, { size: \"sm\" })));\n        }\n        return null;\n    }\n    return (React.createElement(StyledTieredSelectOverlay, { ref: ref, shadowStrength: 2 },\n        React.createElement(StyledTieredSelectSpinnerOverlay, { \"data-qa\": \"tiered-select-loading\", \"data-loading\": loading, label: I18n.t('spinnerLabel', { scope: i18nScope }) || '', loading: loading, size: \"md\" },\n            React.createElement(StyledTieredSelect, __assign({ onKeyDown: onKeyDown, onScrollBottom: onScrollBottom, onSelect: onTierSelect, ref: menuRef }, props),\n                React.createElement(MenuImperative.Header, null,\n                    !isQuickCreating && (React.createElement(MenuImperative.Search, { autoComplete: \"false\", autoFocus: true, onChange: internalOnSearch, placeholder: I18n.t('searchPlaceholder', {\n                            scope: i18nScope,\n                        }) })),\n                    showBreadcrumbs() ? (React.createElement(StyledTieredSelectBreadcrumbs, { \"$nonInteractive\": isQuickCreating },\n                        React.createElement(Breadcrumbs.Crumb, { onClick: onNavigateHome },\n                            React.createElement(StyledTieredSelectHome, { alignItems: \"center\", justifyContent: \"center\" },\n                                React.createElement(Home, { \"data-qa\": \"tiered-select-home\" }))),\n                        value\n                            .filter(function (tier) {\n                            // we reopen to the parent of leaf nodes, so don't show that breadcrumb\n                            return !isLeaf(tier);\n                        })\n                            .map(function (tier, index, array) {\n                            return (React.createElement(Breadcrumbs.Crumb, { active: index === array.length - 1, key: \"\".concat(getId(tier), \"-\").concat(index), onClick: function () { return onBreadCrumbNavigate(tier); } }, getLabel(tier)));\n                        }))) : null),\n                !isQuickCreating ? (React.createElement(Options, { emptyMessage: menuEmptyMessage }, filteredOptions\n                    .map(function (tier, index) { return (React.createElement(RenderMenuItem, { key: \"menu-item-\".concat(getId(tier), \"-\").concat(index, \"}\"), tier: tier, index: index })); })\n                    .concat(React.createElement(RenderLoadingMore, { key: \"tiered-select-loading-more\" })))) : (React.createElement(QuickCreateInput, { autoFocus: isQuickCreating, onSubmit: onQuickCreateSubmit, placeholder: I18n.t('quickCreatePlaceholder', {\n                        scope: i18nScope,\n                    }), ref: quickCreateRef })),\n                onQuickCreate && (React.createElement(MenuImperative.Footer, { \"data-something\": \"true\" }, isQuickCreating ? (React.createElement(FlexList, { size: \"xs\", justifyContent: \"flex-end\" },\n                    React.createElement(Button, { onClick: function () { return setIsQuickCreating(false); }, size: \"sm\", variant: \"tertiary\" }, I18n.t('quickCreateCancelLabel', {\n                        scope: i18nScope,\n                    })),\n                    React.createElement(Button, { onClick: onQuickCreateSubmit, size: \"sm\" }, I18n.t('quickCreateCreateLabel', {\n                        scope: i18nScope,\n                    })))) : (React.createElement(Button, { block: true, size: \"sm\", icon: React.createElement(Plus, null), onClick: function () { return setIsQuickCreating(true); }, onKeyDown: handleQuickCreate }, I18n.t('quickCreateActionLabel', {\n                    scope: i18nScope,\n                }))))),\n                React.createElement(CloseOnFocus, { hide: hide })))));\n});\n"]},"metadata":{},"sourceType":"module"}