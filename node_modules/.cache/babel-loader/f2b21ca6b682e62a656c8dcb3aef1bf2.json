{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport { Clear } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { isEventSource } from '../../effects/ClickOutside';\nimport { Box } from '../../layouts/Box';\nimport { addSubcomponents } from '../../utils/addSubcomponents';\nimport { MenuImperative } from '../MenuImperative';\nimport { OverlayTrigger } from '../OverlayTrigger';\nimport { Spinner } from '../Spinner';\nimport { Token } from '../Token';\nimport { Typography } from '../Typography';\nimport { StyledMultiSelectArrow, StyledMultiSelectArrowContainer, StyledMultiSelectButton, StyledMultiSelectClearIcon, StyledMultiSelectMenu, StyledMultiSelectSearch, StyledMultiSelectSearchIcon, StyledMultiSelectSearchInput, StyledMultiSelectToken, StyledMultiSelectValues } from './MultiSelect.styles';\nvar targetShowKeys = ['ArrowDown', 'Down'];\nvar targetHideKeys = ['Esc', 'Escape'];\nvar overlayHideKeys = targetHideKeys;\nvar emptyArray = [];\n\nfunction noop() {}\n\nfunction returnTrue() {\n  return true;\n}\n\nfunction isAlphaNumeric(str) {\n  return str.length === 1 && str.match(/[A-Za-z0-9 _.,!\"'/$]*/i);\n}\n\nfunction setFocusTo(ref) {\n  if (ref.current) {\n    ref.current.focus();\n  }\n}\n\nfunction isOption(obj) {\n  return typeof obj === 'object' && obj.type === Option;\n}\n\nfunction defaultIsOptionDisabled() {\n  return false;\n}\n\nfunction defaultGetId(item) {\n  return item.id;\n}\n\nfunction defaultGetLabel(item) {\n  return item.label;\n}\n\nfunction defaultGetGroup(item) {\n  return item.groupId;\n}\n\nfunction defaultIsSelectable(obj) {\n  typeof obj === 'object' && obj.type === Option;\n}\n\nfunction defaultOptionRenderer(item, _a) {\n  var _b;\n\n  var getId = _a.getId,\n      getLabel = _a.getLabel,\n      qa = _a.qa,\n      value = _a.value,\n      props = __rest(_a, [\"getId\", \"getLabel\", \"qa\", \"value\"]);\n\n  return React.createElement(Option, __assign({\n    key: getId(item),\n    value: value || item,\n    \"data-qa\": (_b = qa === null || qa === void 0 ? void 0 : qa.option) === null || _b === void 0 ? void 0 : _b.call(qa, item)\n  }, props), getLabel(item));\n}\n\nfunction defaultGroupHeaderRenderer(group) {\n  return React.createElement(MenuImperative.Group, {\n    key: \"group_\".concat(group.id),\n    clickable: false\n  }, group.label);\n}\n\nfunction defaultTokenRenderer(_a) {\n  var _b, _c;\n\n  var focused = _a.focused,\n      disabled = _a.disabled,\n      option = _a.option,\n      removeToken = _a.removeToken,\n      getLabel = _a.getLabel,\n      qa = _a.qa;\n  return React.createElement(Token, {\n    disabled: disabled,\n    focused: focused,\n    variant: \"icon\",\n    \"data-qa\": (_b = qa === null || qa === void 0 ? void 0 : qa.token) === null || _b === void 0 ? void 0 : _b.call(qa, option)\n  }, React.createElement(Token.Label, null, getLabel(option)), React.createElement(Token.Icon, {\n    \"data-close\": true,\n    icon: \"x\",\n    onClick: removeToken,\n    \"data-qa\": (_c = qa === null || qa === void 0 ? void 0 : qa.tokenClear) === null || _c === void 0 ? void 0 : _c.call(qa, option)\n  }));\n}\n\nfunction useMultiSelect(_a) {\n  var getId = _a.getId,\n      getLabel = _a.getLabel,\n      getGroup = _a.getGroup,\n      menuRef = _a.menuRef,\n      _b = _a.onChange,\n      onChange = _b === void 0 ? noop : _b,\n      onSearch_ = _a.onSearch,\n      options_ = _a.options,\n      value = _a.value,\n      optgroups = _a.optgroups;\n\n  var _c = React.useState(null),\n      index = _c[0],\n      setIndex = _c[1];\n\n  var _d = React.useState(''),\n      search = _d[0],\n      setSearch = _d[1];\n\n  var valueIds = value.reduce(function (acc, cur) {\n    acc.add(getId(cur));\n    return acc;\n  }, new Set());\n  var count = value.length;\n  var options = React.useMemo(function () {\n    if (onSearch_) {\n      return options_;\n    }\n\n    return options_.filter(function (opt) {\n      return getLabel(opt).toLowerCase().includes(search.toLowerCase());\n    });\n  }, [options_, onSearch_, getLabel, search]);\n  var onSearch = React.useCallback(function (e) {\n    if (onSearch_) {\n      onSearch_(e);\n    }\n\n    setSearch(e.target.value); // TODO: because menu highlighting is now imperative, we have to wait\n    // for a render to highlight the first item. Is there a better way\n    // to schedule this?\n\n    setTimeout(function () {\n      var _a;\n\n      return (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n    }, 0);\n  }, [menuRef, onSearch_]);\n\n  var clearToken = function () {\n    return setIndex(null);\n  };\n\n  var removeSelection = React.useCallback(function (selection, selected) {\n    return selected.filter(function (s) {\n      return getId(s) !== getId(selection);\n    });\n  }, [getId]);\n  var onSelect = React.useCallback(function (selection) {\n    var newSelected = valueIds.has(getId(selection.item)) ? removeSelection(selection.item, value) : __spreadArray(__spreadArray([], value, true), [selection.item], false);\n    setSearch('');\n    onChange(newSelected);\n  }, [setSearch, onChange, getId, removeSelection, value, valueIds]);\n  var removeToken = React.useCallback(function (i) {\n    onChange(removeSelection(value[i], value));\n  }, [value, onChange, removeSelection]);\n  var decrementToken = React.useCallback(function () {\n    if (index === null) {\n      // index is null, set it to the last token index\n      setIndex(count - 1);\n    } else {\n      // decrementToken by one, don't go below 0\n      setIndex(Math.max(0, index - 1));\n    }\n  }, [count, index, setIndex]);\n  var incrementToken = React.useCallback(function () {\n    if (index === count - 1) {\n      setIndex(null);\n    } else if (index !== null) {\n      setIndex(index + 1);\n    }\n  }, [count, index, setIndex]);\n  var onKeyDown = React.useCallback(function (event) {\n    var _a, _b, _c;\n\n    if (event.key === 'Enter') {\n      (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.select(event);\n    }\n\n    if (event.key === 'ArrowUp' || event.key === 'Up') {\n      (_b = menuRef.current) === null || _b === void 0 ? void 0 : _b.prev();\n    }\n\n    if (event.key === 'ArrowDown' || event.key === 'Down') {\n      (_c = menuRef.current) === null || _c === void 0 ? void 0 : _c.next();\n    }\n\n    if (search === '') {\n      if (event.key === 'Backspace') {\n        // to prevent accidentally deleting too many tokens, don't do anything\n        // on repeating key events\n        if (event.repeat) {\n          return;\n        } // if we are focused on a token, remove it, otherwise remove the last token\n\n\n        removeToken(index !== null ? index : count - 1);\n\n        if (count >= 1) {\n          decrementToken();\n        } else {\n          clearToken();\n        }\n      }\n\n      if (event.key === 'ArrowLeft' || event.key === 'Left') {\n        decrementToken();\n      }\n\n      if (event.key === 'ArrowRight' || event.key === 'Right') {\n        incrementToken();\n      }\n    }\n  }, [count, decrementToken, incrementToken, index, menuRef, removeToken, search]);\n  React.useEffect(function () {\n    // if we've deleted a token and our new count is less than\n    // our current index, clear the index\n    if (count <= (index || 0)) {\n      clearToken();\n    }\n  }, [count, index]);\n  var groupedOptions = React.useMemo(function () {\n    if (!optgroups || !optgroups.length) {\n      return options;\n    }\n\n    var optionsByGroup = optgroups.reduce(function (acc, _a) {\n      var _b;\n\n      var id = _a.id;\n      return __assign(__assign({}, acc), (_b = {}, _b[id] = [], _b));\n    }, {});\n    var orphanOptions = [];\n    options.forEach(function (option) {\n      var groupId = getGroup(option);\n      var groupOptions = optionsByGroup[groupId];\n\n      if (!groupId || !groupOptions) {\n        orphanOptions.push(option);\n        return;\n      }\n\n      optionsByGroup[groupId].push(option);\n    });\n\n    if (orphanOptions.length) {\n      console.warn(\"Could not find option groups for the options below. Make sure that every option has a proper \\\"groupId\\\" field or if \\\"getGroup\\\" is implemented correctly.\", orphanOptions);\n    }\n\n    return optgroups.flatMap(function (group) {\n      var groupHeader = __assign(__assign({}, group), {\n        isGroupHeader: true\n      });\n\n      var groupOptions = optionsByGroup[group.id];\n\n      if (!groupOptions.length) {\n        return [];\n      }\n\n      return __spreadArray([groupHeader], groupOptions, true);\n    }, []);\n  }, [options, getGroup, optgroups]);\n  return {\n    ids: valueIds,\n    index: index,\n    menuRef: menuRef,\n    options: groupedOptions,\n    search: search,\n    clearToken: clearToken,\n    decrementToken: decrementToken,\n    incrementToken: incrementToken,\n    onSearch: onSearch,\n    onSelect: onSelect,\n    removeToken: removeToken,\n    domHandlers: {\n      onKeyDown: onKeyDown\n    }\n  };\n}\n\nexport var Option = React.forwardRef(function Option(_a, ref) {\n  var value = _a.value,\n      props = __rest(_a, [\"value\"]);\n\n  return React.createElement(MenuImperative.Item, __assign({\n    ref: ref\n  }, props, {\n    item: value\n  }));\n});\n\nfunction GroupedOptions(_a) {\n  var multiselect = _a.multiselect,\n      groupHeaderRenderer = _a.groupHeaderRenderer,\n      optionRenderer = _a.optionRenderer,\n      getId = _a.getId,\n      getLabel = _a.getLabel,\n      isOptionDisabled = _a.isOptionDisabled,\n      qa = _a.qa;\n  return React.createElement(MenuImperative.Options, null, multiselect.options.map(function (opt) {\n    if (opt.isGroupHeader) {\n      var groupHeader = opt;\n      return groupHeaderRenderer(groupHeader);\n    }\n\n    return optionRenderer(opt, {\n      getId: getId,\n      getLabel: getLabel,\n      // @ts-ignore\n      // Object literal may only specify known properties, and 'key' does not exist in type 'OptionRendererProps'.\n      key: getId(opt),\n      selected: multiselect.ids.has(getId(opt)),\n      disabled: isOptionDisabled(opt),\n      value: opt,\n      qa: qa\n    });\n  }));\n}\n\nvar MultiSelect_ = React.forwardRef(function MultiSelect(_a, ref) {\n  var _b = _a.afterHide,\n      afterHide = _b === void 0 ? noop : _b,\n      _c = _a.afterShow,\n      afterShow = _c === void 0 ? noop : _c,\n      _d = _a.beforeHide,\n      beforeHide = _d === void 0 ? returnTrue : _d,\n      _e = _a.beforeShow,\n      beforeShow = _e === void 0 ? returnTrue : _e,\n      _f = _a.block,\n      block = _f === void 0 ? false : _f,\n      _g = _a.disabled,\n      disabled = _g === void 0 ? false : _g,\n      _h = _a.emptyMessage,\n      emptyMessage = _h === void 0 ? 'No results' : _h,\n      _j = _a.error,\n      error = _j === void 0 ? false : _j,\n      _k = _a.getId,\n      getId = _k === void 0 ? defaultGetId : _k,\n      _l = _a.getLabel,\n      getLabel = _l === void 0 ? defaultGetLabel : _l,\n      _m = _a.getGroup,\n      getGroup = _m === void 0 ? defaultGetGroup : _m,\n      _o = _a.loading,\n      loading = _o === void 0 ? false : _o,\n      _p = _a.onChange,\n      onChange = _p === void 0 ? noop : _p,\n      onScrollBottom = _a.onScrollBottom,\n      onSearch = _a.onSearch,\n      _q = _a.options,\n      options = _q === void 0 ? emptyArray : _q,\n      _r = _a.isOptionDisabled,\n      isOptionDisabled = _r === void 0 ? defaultIsOptionDisabled : _r,\n      _s = _a.optionRenderer,\n      optionRenderer = _s === void 0 ? defaultOptionRenderer : _s,\n      optgroups = _a.optgroups,\n      _t = _a.groupHeaderRenderer,\n      groupHeaderRenderer = _t === void 0 ? defaultGroupHeaderRenderer : _t,\n      _u = _a.tokenRenderer,\n      tokenRenderer = _u === void 0 ? defaultTokenRenderer : _u,\n      _v = _a.placeholder,\n      placeholder = _v === void 0 ? 'Select Values' : _v,\n      _w = _a.placement,\n      placement = _w === void 0 ? 'bottom-left' : _w,\n      _x = _a.value,\n      value = _x === void 0 ? emptyArray : _x,\n      _y = _a.tabIndex,\n      tabIndex = _y === void 0 ? 0 : _y,\n      _z = _a.qa,\n      qa = _z === void 0 ? {} : _z,\n      props = __rest(_a, [\"afterHide\", \"afterShow\", \"beforeHide\", \"beforeShow\", \"block\", \"disabled\", \"emptyMessage\", \"error\", \"getId\", \"getLabel\", \"getGroup\", \"loading\", \"onChange\", \"onScrollBottom\", \"onSearch\", \"options\", \"isOptionDisabled\", \"optionRenderer\", \"optgroups\", \"groupHeaderRenderer\", \"tokenRenderer\", \"placeholder\", \"placement\", \"value\", \"tabIndex\", \"qa\"]);\n\n  var ownRef = React.useRef();\n  var targetRef = ref || ownRef;\n  var searchRef = React.useRef(null);\n  var menuRef = React.useRef(null);\n  var multiselect = useMultiSelect({\n    getId: getId,\n    getLabel: getLabel,\n    getGroup: getGroup,\n    menuRef: menuRef,\n    onSearch: onSearch,\n    options: options,\n    onChange: function (value) {\n      onChange(value);\n      setFocusTo(searchRef);\n    },\n    value: value,\n    optgroups: optgroups\n  });\n  var hasClearIcon = value.length > 0 && !loading;\n  var isNavigatingTokens = multiselect.index !== null;\n  var overlay = React.createElement(StyledMultiSelectMenu, {\n    shadowStrength: 2\n  }, React.createElement(MenuImperative, {\n    ref: menuRef,\n    onScrollBottom: onScrollBottom,\n    onSelect: multiselect.onSelect,\n    \"data-qa\": \"multi-select-menu\"\n  }, multiselect.options.length ? React.createElement(GroupedOptions, {\n    multiselect: multiselect,\n    getId: getId,\n    getLabel: getLabel,\n    isOptionDisabled: isOptionDisabled,\n    groupHeaderRenderer: groupHeaderRenderer,\n    optionRenderer: optionRenderer,\n    qa: qa\n  }) : React.createElement(Box, {\n    padding: \"md lg\"\n  }, React.createElement(Typography, {\n    color: \"gray45\",\n    intent: \"small\",\n    italic: true\n  }, emptyMessage))));\n  return React.createElement(OverlayTrigger, {\n    canFlip: true,\n    afterHide: function () {\n      multiselect.clearToken();\n      afterHide();\n    },\n    afterShow: function () {\n      var _a;\n\n      multiselect.clearToken();\n      (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n      afterShow();\n    },\n    beforeHide: function (e) {\n      // if we are clicking somewhere in the target, set focus on the search\n      if (e instanceof MouseEvent && isEventSource(targetRef, e)) {\n        setFocusTo(searchRef);\n        return false;\n      }\n\n      return beforeHide(e);\n    },\n    beforeShow: function (e) {\n      setFocusTo(searchRef);\n      return beforeShow(e);\n    },\n    hideKeys: {\n      overlay: overlayHideKeys,\n      target: targetHideKeys\n    },\n    overlay: overlay,\n    placement: placement,\n    ref: targetRef,\n    showKeys: targetShowKeys,\n    trigger: \"click\"\n  }, function (_a) {\n    var disable = _a.disable,\n        enable = _a.enable,\n        isVisible = _a.isVisible;\n    return React.createElement(StyledMultiSelectButton, __assign({\n      \"$block\": block,\n      \"$error\": error,\n      \"$emptyValue\": value.length === 0,\n      \"$disabled\": disabled,\n      \"$hasClearIcon\": hasClearIcon,\n      \"$loading\": loading,\n      \"$open\": isVisible\n    }, props), React.createElement(StyledMultiSelectValues, null, value.map(function (selection, i) {\n      return React.createElement(StyledMultiSelectToken, {\n        key: getId(selection)\n      }, tokenRenderer({\n        option: selection,\n        focused: i === multiselect.index,\n        disabled: disabled,\n        getLabel: getLabel,\n        removeToken: function () {\n          multiselect.removeToken(i);\n        },\n        qa: qa\n      }));\n    }), React.createElement(StyledMultiSelectSearch, null, React.createElement(StyledMultiSelectSearchInput, {\n      \"data-qa\": \"core-multiselect-input\",\n      \"$isNavigatingTokens\": isNavigatingTokens,\n      disabled: disabled,\n      onBlur: multiselect.clearToken,\n      onChange: function (e) {\n        multiselect.onSearch(e);\n      },\n      onKeyDown: function (e) {\n        if (isNavigatingTokens && e.key !== 'Tab') {\n          // if we are navigating tokens don't do any input but allow Tab\n          e.preventDefault();\n        }\n\n        if (isVisible) {\n          // if the overlay is visible, close it and keep focus\n          if (e.key === 'Tab') {\n            e.preventDefault();\n            disable(e);\n          }\n        } else {\n          // if we type in an alphanumeric character, show the overlay\n          if (isAlphaNumeric(e.key)) {\n            enable(e);\n          }\n        }\n\n        multiselect.domHandlers.onKeyDown(e);\n      },\n      placeholder: value && value.length > 0 ? '' : placeholder,\n      ref: searchRef,\n      tabIndex: tabIndex,\n      value: multiselect.search\n    }))), React.createElement(StyledMultiSelectSearchIcon, null, React.createElement(StyledMultiSelectClearIcon, {\n      \"data-close\": true,\n      \"data-qa\": \"core-multiselect-clear\",\n      size: \"sm\",\n      variant: \"tertiary\",\n      disabled: disabled,\n      icon: React.createElement(Clear, null),\n      onClick: function () {\n        return onChange([]);\n      },\n      tabIndex: -1\n    }), loading ? React.createElement(Spinner, {\n      color: \"blue50\",\n      size: \"xs\"\n    }) : React.createElement(StyledMultiSelectArrowContainer, {\n      \"data-qa\": \"multiselect-select-arrow\",\n      onClick: function (e) {\n        return isVisible && disable(e);\n      }\n    }, React.createElement(StyledMultiSelectArrow, null))));\n  });\n});\nMultiSelect_.displayName = 'MultiSelect';\nexport var MultiSelect = addSubcomponents({\n  Option: Option\n}, MultiSelect_);\nexport default MultiSelect;","map":{"version":3,"sources":["../../../../src/components/MultiSelect/MultiSelect.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { Clear } from '@procore/core-icons/dist';\nimport React from 'react';\nimport { isEventSource } from '../../effects/ClickOutside';\nimport { Box } from '../../layouts/Box';\nimport { addSubcomponents } from '../../utils/addSubcomponents';\nimport { MenuImperative } from '../MenuImperative';\nimport { OverlayTrigger } from '../OverlayTrigger';\nimport { Spinner } from '../Spinner';\nimport { Token } from '../Token';\nimport { Typography } from '../Typography';\nimport { StyledMultiSelectArrow, StyledMultiSelectArrowContainer, StyledMultiSelectButton, StyledMultiSelectClearIcon, StyledMultiSelectMenu, StyledMultiSelectSearch, StyledMultiSelectSearchIcon, StyledMultiSelectSearchInput, StyledMultiSelectToken, StyledMultiSelectValues, } from './MultiSelect.styles';\nvar targetShowKeys = ['ArrowDown', 'Down'];\nvar targetHideKeys = ['Esc', 'Escape'];\nvar overlayHideKeys = targetHideKeys;\nvar emptyArray = [];\nfunction noop() { }\nfunction returnTrue() {\n    return true;\n}\nfunction isAlphaNumeric(str) {\n    return str.length === 1 && str.match(/[A-Za-z0-9 _.,!\"'/$]*/i);\n}\nfunction setFocusTo(ref) {\n    if (ref.current) {\n        ref.current.focus();\n    }\n}\nfunction isOption(obj) {\n    return typeof obj === 'object' && obj.type === Option;\n}\nfunction defaultIsOptionDisabled() {\n    return false;\n}\nfunction defaultGetId(item) {\n    return item.id;\n}\nfunction defaultGetLabel(item) {\n    return item.label;\n}\nfunction defaultGetGroup(item) {\n    return item.groupId;\n}\nfunction defaultIsSelectable(obj) {\n    typeof obj === 'object' && obj.type === Option;\n}\nfunction defaultOptionRenderer(item, _a) {\n    var _b;\n    var getId = _a.getId, getLabel = _a.getLabel, qa = _a.qa, value = _a.value, props = __rest(_a, [\"getId\", \"getLabel\", \"qa\", \"value\"]);\n    return (React.createElement(Option, __assign({ key: getId(item), value: value || item, \"data-qa\": (_b = qa === null || qa === void 0 ? void 0 : qa.option) === null || _b === void 0 ? void 0 : _b.call(qa, item) }, props), getLabel(item)));\n}\nfunction defaultGroupHeaderRenderer(group) {\n    return (React.createElement(MenuImperative.Group, { key: \"group_\".concat(group.id), clickable: false }, group.label));\n}\nfunction defaultTokenRenderer(_a) {\n    var _b, _c;\n    var focused = _a.focused, disabled = _a.disabled, option = _a.option, removeToken = _a.removeToken, getLabel = _a.getLabel, qa = _a.qa;\n    return (React.createElement(Token, { disabled: disabled, focused: focused, variant: \"icon\", \"data-qa\": (_b = qa === null || qa === void 0 ? void 0 : qa.token) === null || _b === void 0 ? void 0 : _b.call(qa, option) },\n        React.createElement(Token.Label, null, getLabel(option)),\n        React.createElement(Token.Icon, { \"data-close\": true, icon: \"x\", onClick: removeToken, \"data-qa\": (_c = qa === null || qa === void 0 ? void 0 : qa.tokenClear) === null || _c === void 0 ? void 0 : _c.call(qa, option) })));\n}\nfunction useMultiSelect(_a) {\n    var getId = _a.getId, getLabel = _a.getLabel, getGroup = _a.getGroup, menuRef = _a.menuRef, _b = _a.onChange, onChange = _b === void 0 ? noop : _b, onSearch_ = _a.onSearch, options_ = _a.options, value = _a.value, optgroups = _a.optgroups;\n    var _c = React.useState(null), index = _c[0], setIndex = _c[1];\n    var _d = React.useState(''), search = _d[0], setSearch = _d[1];\n    var valueIds = value.reduce(function (acc, cur) {\n        acc.add(getId(cur));\n        return acc;\n    }, new Set());\n    var count = value.length;\n    var options = React.useMemo(function () {\n        if (onSearch_) {\n            return options_;\n        }\n        return options_.filter(function (opt) {\n            return getLabel(opt).toLowerCase().includes(search.toLowerCase());\n        });\n    }, [options_, onSearch_, getLabel, search]);\n    var onSearch = React.useCallback(function (e) {\n        if (onSearch_) {\n            onSearch_(e);\n        }\n        setSearch(e.target.value);\n        // TODO: because menu highlighting is now imperative, we have to wait\n        // for a render to highlight the first item. Is there a better way\n        // to schedule this?\n        setTimeout(function () { var _a; return (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst(); }, 0);\n    }, [menuRef, onSearch_]);\n    var clearToken = function () { return setIndex(null); };\n    var removeSelection = React.useCallback(function (selection, selected) {\n        return selected.filter(function (s) { return getId(s) !== getId(selection); });\n    }, [getId]);\n    var onSelect = React.useCallback(function (selection) {\n        var newSelected = valueIds.has(getId(selection.item))\n            ? removeSelection(selection.item, value)\n            : __spreadArray(__spreadArray([], value, true), [selection.item], false);\n        setSearch('');\n        onChange(newSelected);\n    }, [setSearch, onChange, getId, removeSelection, value, valueIds]);\n    var removeToken = React.useCallback(function (i) {\n        onChange(removeSelection(value[i], value));\n    }, [value, onChange, removeSelection]);\n    var decrementToken = React.useCallback(function () {\n        if (index === null) {\n            // index is null, set it to the last token index\n            setIndex(count - 1);\n        }\n        else {\n            // decrementToken by one, don't go below 0\n            setIndex(Math.max(0, index - 1));\n        }\n    }, [count, index, setIndex]);\n    var incrementToken = React.useCallback(function () {\n        if (index === count - 1) {\n            setIndex(null);\n        }\n        else if (index !== null) {\n            setIndex(index + 1);\n        }\n    }, [count, index, setIndex]);\n    var onKeyDown = React.useCallback(function (event) {\n        var _a, _b, _c;\n        if (event.key === 'Enter') {\n            (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.select(event);\n        }\n        if (event.key === 'ArrowUp' || event.key === 'Up') {\n            (_b = menuRef.current) === null || _b === void 0 ? void 0 : _b.prev();\n        }\n        if (event.key === 'ArrowDown' || event.key === 'Down') {\n            (_c = menuRef.current) === null || _c === void 0 ? void 0 : _c.next();\n        }\n        if (search === '') {\n            if (event.key === 'Backspace') {\n                // to prevent accidentally deleting too many tokens, don't do anything\n                // on repeating key events\n                if (event.repeat) {\n                    return;\n                }\n                // if we are focused on a token, remove it, otherwise remove the last token\n                removeToken(index !== null ? index : count - 1);\n                if (count >= 1) {\n                    decrementToken();\n                }\n                else {\n                    clearToken();\n                }\n            }\n            if (event.key === 'ArrowLeft' || event.key === 'Left') {\n                decrementToken();\n            }\n            if (event.key === 'ArrowRight' || event.key === 'Right') {\n                incrementToken();\n            }\n        }\n    }, [count, decrementToken, incrementToken, index, menuRef, removeToken, search]);\n    React.useEffect(function () {\n        // if we've deleted a token and our new count is less than\n        // our current index, clear the index\n        if (count <= (index || 0)) {\n            clearToken();\n        }\n    }, [count, index]);\n    var groupedOptions = React.useMemo(function () {\n        if (!optgroups || !optgroups.length) {\n            return options;\n        }\n        var optionsByGroup = optgroups.reduce(function (acc, _a) {\n            var _b;\n            var id = _a.id;\n            return __assign(__assign({}, acc), (_b = {}, _b[id] = [], _b));\n        }, {});\n        var orphanOptions = [];\n        options.forEach(function (option) {\n            var groupId = getGroup(option);\n            var groupOptions = optionsByGroup[groupId];\n            if (!groupId || !groupOptions) {\n                orphanOptions.push(option);\n                return;\n            }\n            optionsByGroup[groupId].push(option);\n        });\n        if (orphanOptions.length) {\n            console.warn(\"Could not find option groups for the options below. Make sure that every option has a proper \\\"groupId\\\" field or if \\\"getGroup\\\" is implemented correctly.\", orphanOptions);\n        }\n        return optgroups.flatMap(function (group) {\n            var groupHeader = __assign(__assign({}, group), { isGroupHeader: true });\n            var groupOptions = optionsByGroup[group.id];\n            if (!groupOptions.length) {\n                return [];\n            }\n            return __spreadArray([groupHeader], groupOptions, true);\n        }, []);\n    }, [options, getGroup, optgroups]);\n    return {\n        ids: valueIds,\n        index: index,\n        menuRef: menuRef,\n        options: groupedOptions,\n        search: search,\n        clearToken: clearToken,\n        decrementToken: decrementToken,\n        incrementToken: incrementToken,\n        onSearch: onSearch,\n        onSelect: onSelect,\n        removeToken: removeToken,\n        domHandlers: {\n            onKeyDown: onKeyDown,\n        },\n    };\n}\nexport var Option = React.forwardRef(function Option(_a, ref) {\n    var value = _a.value, props = __rest(_a, [\"value\"]);\n    return React.createElement(MenuImperative.Item, __assign({ ref: ref }, props, { item: value }));\n});\nfunction GroupedOptions(_a) {\n    var multiselect = _a.multiselect, groupHeaderRenderer = _a.groupHeaderRenderer, optionRenderer = _a.optionRenderer, getId = _a.getId, getLabel = _a.getLabel, isOptionDisabled = _a.isOptionDisabled, qa = _a.qa;\n    return (React.createElement(MenuImperative.Options, null, multiselect.options.map(function (opt) {\n        if (opt.isGroupHeader) {\n            var groupHeader = opt;\n            return groupHeaderRenderer(groupHeader);\n        }\n        return optionRenderer(opt, {\n            getId: getId,\n            getLabel: getLabel,\n            // @ts-ignore\n            // Object literal may only specify known properties, and 'key' does not exist in type 'OptionRendererProps'.\n            key: getId(opt),\n            selected: multiselect.ids.has(getId(opt)),\n            disabled: isOptionDisabled(opt),\n            value: opt,\n            qa: qa,\n        });\n    })));\n}\nvar MultiSelect_ = React.forwardRef(function MultiSelect(_a, ref) {\n    var _b = _a.afterHide, afterHide = _b === void 0 ? noop : _b, _c = _a.afterShow, afterShow = _c === void 0 ? noop : _c, _d = _a.beforeHide, beforeHide = _d === void 0 ? returnTrue : _d, _e = _a.beforeShow, beforeShow = _e === void 0 ? returnTrue : _e, _f = _a.block, block = _f === void 0 ? false : _f, _g = _a.disabled, disabled = _g === void 0 ? false : _g, _h = _a.emptyMessage, emptyMessage = _h === void 0 ? 'No results' : _h, _j = _a.error, error = _j === void 0 ? false : _j, _k = _a.getId, getId = _k === void 0 ? defaultGetId : _k, _l = _a.getLabel, getLabel = _l === void 0 ? defaultGetLabel : _l, _m = _a.getGroup, getGroup = _m === void 0 ? defaultGetGroup : _m, _o = _a.loading, loading = _o === void 0 ? false : _o, _p = _a.onChange, onChange = _p === void 0 ? noop : _p, onScrollBottom = _a.onScrollBottom, onSearch = _a.onSearch, _q = _a.options, options = _q === void 0 ? emptyArray : _q, _r = _a.isOptionDisabled, isOptionDisabled = _r === void 0 ? defaultIsOptionDisabled : _r, _s = _a.optionRenderer, optionRenderer = _s === void 0 ? defaultOptionRenderer : _s, optgroups = _a.optgroups, _t = _a.groupHeaderRenderer, groupHeaderRenderer = _t === void 0 ? defaultGroupHeaderRenderer : _t, _u = _a.tokenRenderer, tokenRenderer = _u === void 0 ? defaultTokenRenderer : _u, _v = _a.placeholder, placeholder = _v === void 0 ? 'Select Values' : _v, _w = _a.placement, placement = _w === void 0 ? 'bottom-left' : _w, _x = _a.value, value = _x === void 0 ? emptyArray : _x, _y = _a.tabIndex, tabIndex = _y === void 0 ? 0 : _y, _z = _a.qa, qa = _z === void 0 ? {} : _z, props = __rest(_a, [\"afterHide\", \"afterShow\", \"beforeHide\", \"beforeShow\", \"block\", \"disabled\", \"emptyMessage\", \"error\", \"getId\", \"getLabel\", \"getGroup\", \"loading\", \"onChange\", \"onScrollBottom\", \"onSearch\", \"options\", \"isOptionDisabled\", \"optionRenderer\", \"optgroups\", \"groupHeaderRenderer\", \"tokenRenderer\", \"placeholder\", \"placement\", \"value\", \"tabIndex\", \"qa\"]);\n    var ownRef = React.useRef();\n    var targetRef = ref || ownRef;\n    var searchRef = React.useRef(null);\n    var menuRef = React.useRef(null);\n    var multiselect = useMultiSelect({\n        getId: getId,\n        getLabel: getLabel,\n        getGroup: getGroup,\n        menuRef: menuRef,\n        onSearch: onSearch,\n        options: options,\n        onChange: function (value) {\n            onChange(value);\n            setFocusTo(searchRef);\n        },\n        value: value,\n        optgroups: optgroups,\n    });\n    var hasClearIcon = value.length > 0 && !loading;\n    var isNavigatingTokens = multiselect.index !== null;\n    var overlay = (React.createElement(StyledMultiSelectMenu, { shadowStrength: 2 },\n        React.createElement(MenuImperative, { ref: menuRef, onScrollBottom: onScrollBottom, onSelect: multiselect.onSelect, \"data-qa\": \"multi-select-menu\" }, multiselect.options.length ? (React.createElement(GroupedOptions, { multiselect: multiselect, getId: getId, getLabel: getLabel, isOptionDisabled: isOptionDisabled, groupHeaderRenderer: groupHeaderRenderer, optionRenderer: optionRenderer, qa: qa })) : (React.createElement(Box, { padding: \"md lg\" },\n            React.createElement(Typography, { color: \"gray45\", intent: \"small\", italic: true }, emptyMessage))))));\n    return (React.createElement(OverlayTrigger, { canFlip: true, afterHide: function () {\n            multiselect.clearToken();\n            afterHide();\n        }, afterShow: function () {\n            var _a;\n            multiselect.clearToken();\n            (_a = menuRef.current) === null || _a === void 0 ? void 0 : _a.highlightFirst();\n            afterShow();\n        }, beforeHide: function (e) {\n            // if we are clicking somewhere in the target, set focus on the search\n            if (e instanceof MouseEvent && isEventSource(targetRef, e)) {\n                setFocusTo(searchRef);\n                return false;\n            }\n            return beforeHide(e);\n        }, beforeShow: function (e) {\n            setFocusTo(searchRef);\n            return beforeShow(e);\n        }, hideKeys: {\n            overlay: overlayHideKeys,\n            target: targetHideKeys,\n        }, overlay: overlay, placement: placement, ref: targetRef, showKeys: targetShowKeys, trigger: \"click\" }, function (_a) {\n        var disable = _a.disable, enable = _a.enable, isVisible = _a.isVisible;\n        return (React.createElement(StyledMultiSelectButton, __assign({ \"$block\": block, \"$error\": error, \"$emptyValue\": value.length === 0, \"$disabled\": disabled, \"$hasClearIcon\": hasClearIcon, \"$loading\": loading, \"$open\": isVisible }, props),\n            React.createElement(StyledMultiSelectValues, null,\n                value.map(function (selection, i) {\n                    return (React.createElement(StyledMultiSelectToken, { key: getId(selection) }, tokenRenderer({\n                        option: selection,\n                        focused: i === multiselect.index,\n                        disabled: disabled,\n                        getLabel: getLabel,\n                        removeToken: function () {\n                            multiselect.removeToken(i);\n                        },\n                        qa: qa,\n                    })));\n                }),\n                React.createElement(StyledMultiSelectSearch, null,\n                    React.createElement(StyledMultiSelectSearchInput, { \"data-qa\": \"core-multiselect-input\", \"$isNavigatingTokens\": isNavigatingTokens, disabled: disabled, onBlur: multiselect.clearToken, onChange: function (e) {\n                            multiselect.onSearch(e);\n                        }, onKeyDown: function (e) {\n                            if (isNavigatingTokens && e.key !== 'Tab') {\n                                // if we are navigating tokens don't do any input but allow Tab\n                                e.preventDefault();\n                            }\n                            if (isVisible) {\n                                // if the overlay is visible, close it and keep focus\n                                if (e.key === 'Tab') {\n                                    e.preventDefault();\n                                    disable(e);\n                                }\n                            }\n                            else {\n                                // if we type in an alphanumeric character, show the overlay\n                                if (isAlphaNumeric(e.key)) {\n                                    enable(e);\n                                }\n                            }\n                            multiselect.domHandlers.onKeyDown(e);\n                        }, placeholder: value && value.length > 0 ? '' : placeholder, ref: searchRef, tabIndex: tabIndex, value: multiselect.search }))),\n            React.createElement(StyledMultiSelectSearchIcon, null,\n                React.createElement(StyledMultiSelectClearIcon, { \"data-close\": true, \"data-qa\": \"core-multiselect-clear\", size: \"sm\", variant: \"tertiary\", disabled: disabled, icon: React.createElement(Clear, null), onClick: function () { return onChange([]); }, tabIndex: -1 }),\n                loading ? (React.createElement(Spinner, { color: \"blue50\", size: \"xs\" })) : (React.createElement(StyledMultiSelectArrowContainer, { \"data-qa\": \"multiselect-select-arrow\", onClick: function (e) { return isVisible && disable(e); } },\n                    React.createElement(StyledMultiSelectArrow, null))))));\n    }));\n});\nMultiSelect_.displayName = 'MultiSelect';\nexport var MultiSelect = addSubcomponents({\n    Option: Option,\n}, MultiSelect_);\nexport default MultiSelect;\n"]},"metadata":{},"sourceType":"module"}