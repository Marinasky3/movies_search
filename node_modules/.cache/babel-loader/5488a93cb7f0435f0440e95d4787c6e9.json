{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport React from 'react';\nimport { ulid } from 'ulid';\nimport { useFileUploader } from '../../effects/useFileUploader';\nimport { useI18nContext } from '../../state/I18n';\nimport { addSubcomponents } from '../../utils/addSubcomponents';\nimport { FileExplorer } from './FileExplorer/FileExplorer';\nimport { GridSource } from './GridSource';\nimport { LocalSource } from './LocalSource';\nimport { TreeSource } from './TreeSource';\nimport { FileSelectDropzone } from './FileSelectDropzone';\nimport { StyledFileSelect, StyledFileTokenList } from './FileSelect.styles';\nexport var FileSelectLocalSourceId = 'FileSelectLocalSource';\n\nvar defaultGetTokenLabel = function (sourceId, sourceValueEntry) {\n  return sourceValueEntry.name;\n};\n\nvar defaultGetMethod = function () {\n  return 'POST';\n};\n\nvar defaultGetPayloadKey = function () {\n  return 'file';\n};\n\nvar defaultGetHeaders = function () {\n  return {};\n};\n\nvar getValueTokenLabel = function (sourceId, entry, getTokenLabel) {\n  var _a;\n\n  if (getTokenLabel === void 0) {\n    getTokenLabel = defaultGetTokenLabel;\n  }\n\n  var namePlaceholder = 'Untitled';\n  var name = (_a = getTokenLabel(sourceId, entry)) !== null && _a !== void 0 ? _a : entry.name;\n\n  if (!name) {\n    console.warn(\"FileSelect: Couldn't derive the name of \\\"\".concat(sourceId, \"\\\" source value. Check the source or use \\\"getTokenLabel\\\" prop\"));\n  }\n\n  return name !== null && name !== void 0 ? name : namePlaceholder;\n};\n\nvar FileSelectBase = React.forwardRef(function (_a, ref) {\n  var onAdd = _a.onAdd,\n      _b = _a.beforeLocalFileUpload,\n      beforeLocalFileUpload = _b === void 0 ? function () {\n    return new Promise(function (resolve) {\n      return resolve(true);\n    });\n  } : _b,\n      onRemove = _a.onRemove,\n      onProgress = _a.onProgress,\n      onUploadStateChange = _a.onUploadStateChange,\n      onError = _a.onError,\n      onFileTokenClick = _a.onFileTokenClick,\n      dropzoneContentRenderer = _a.dropzoneContentRenderer,\n      _c = _a.hideDropzone,\n      hideDropzone = _c === void 0 ? false : _c,\n      _d = _a.getTokenLabel,\n      getTokenLabel = _d === void 0 ? defaultGetTokenLabel : _d,\n      _e = _a.hideLocalSource,\n      hideLocalSource = _e === void 0 ? false : _e,\n      localSourceDropzoneContentRenderer = _a.localSourceDropzoneContentRenderer,\n      _f = _a.maxFileNumber,\n      maxFileNumber = _f === void 0 ? Infinity : _f,\n      maxFileSize = _a.maxFileSize,\n      minFileSize = _a.minFileSize,\n      accept = _a.accept,\n      getEndpoint = _a.getEndpoint,\n      _g = _a.getMethod,\n      getMethod = _g === void 0 ? defaultGetMethod : _g,\n      _h = _a.getPayloadKey,\n      getPayloadKey = _h === void 0 ? defaultGetPayloadKey : _h,\n      getPayload = _a.getPayload,\n      _j = _a.getHeaders,\n      getHeaders = _j === void 0 ? defaultGetHeaders : _j,\n      uploadFile = _a.uploadFile,\n      children = _a.children,\n      qa = _a.qa,\n      props = __rest(_a, [\"onAdd\", \"beforeLocalFileUpload\", \"onRemove\", \"onProgress\", \"onUploadStateChange\", \"onError\", \"onFileTokenClick\", \"dropzoneContentRenderer\", \"hideDropzone\", \"getTokenLabel\", \"hideLocalSource\", \"localSourceDropzoneContentRenderer\", \"maxFileNumber\", \"maxFileSize\", \"minFileSize\", \"accept\", \"getEndpoint\", \"getMethod\", \"getPayloadKey\", \"getPayload\", \"getHeaders\", \"uploadFile\", \"children\", \"qa\"]);\n\n  var _k = React.useState(false),\n      isOpen = _k[0],\n      setIsOpen = _k[1];\n\n  var _l = React.useState(''),\n      currentSource = _l[0],\n      setCurrentSource = _l[1];\n\n  var _m = React.useState([]),\n      sources = _m[0],\n      setSources = _m[1];\n\n  var I18n = useI18nContext();\n  var fileUploader = useFileUploader({\n    getEndpoint: getEndpoint,\n    getMethod: getMethod,\n    getPayloadKey: getPayloadKey,\n    getPayload: getPayload,\n    getHeaders: getHeaders,\n    uploadFile: uploadFile\n  });\n\n  var _o = React.useState([]),\n      value = _o[0],\n      setValue = _o[1];\n\n  var _p = React.useState({}),\n      uploadProgress = _p[0],\n      setUploadProgress = _p[1];\n\n  var _q = React.useState(0),\n      pendingUploadsCount = _q[0],\n      setPendingUploadsCount = _q[1];\n\n  var modalElRef = React.useRef(null);\n  var rootElRef = React.useRef(null);\n  var dropzoneRef = React.useRef(null);\n  React.useEffect(function () {\n    onUploadStateChange === null || onUploadStateChange === void 0 ? void 0 : onUploadStateChange(pendingUploadsCount > 0);\n  }, [pendingUploadsCount]);\n  React.useImperativeHandle(ref, function () {\n    return {\n      setValue: setValue,\n      open: function (sourceId) {\n        var _a;\n\n        setIsOpen(true);\n        var newCurrentSource = sourceId !== null && sourceId !== void 0 ? sourceId : (_a = sources[0]) === null || _a === void 0 ? void 0 : _a.sourceId;\n\n        if (newCurrentSource) {\n          setCurrentSource(newCurrentSource);\n        }\n      },\n      close: function () {\n        setIsOpen(false);\n      },\n      modalEl: modalElRef,\n      rootEl: rootElRef\n    };\n  });\n  var uploadedValues = value.filter(function (entry) {\n    return !entry.error;\n  });\n  var adjustedMaxFileNumber = maxFileNumber - uploadedValues.length;\n  var hasReachedMaxFileNumber = adjustedMaxFileNumber < 1;\n  var unsubmittedSourceValues = sources.flatMap(function (source) {\n    return source.value;\n  });\n\n  var updateFile = function (fileId, payload) {\n    setValue(function (prev) {\n      return prev.map(function (v) {\n        if (v.id === fileId) {\n          return __assign(__assign({}, v), payload);\n        }\n\n        return v;\n      });\n    });\n  };\n\n  function onProgressInternal(id, progress) {\n    onProgress === null || onProgress === void 0 ? void 0 : onProgress(id, progress);\n    setUploadProgress(function (prev) {\n      var _a;\n\n      return __assign(__assign({}, prev), (_a = {}, _a[id] = Math.min(99, progress), _a));\n    });\n  }\n\n  function onErrorInternal(id, error) {\n    updateFile(id, {\n      error: I18n.t('core.fileSelect.uploadFailed')\n    });\n    onError === null || onError === void 0 ? void 0 : onError(id, error);\n    setUploadProgress(function (prev) {\n      var _a;\n\n      return __assign(__assign({}, prev), (_a = {}, _a[id] = 100, _a));\n    });\n  }\n\n  var uploadFiles = function (newFiles) {\n    function onComplete(id, response) {\n      var localFile = newFiles.find(function (entry) {\n        return entry.id === id;\n      });\n      updateFile(id, {\n        response: response\n      });\n\n      var uploadedFile = __assign(__assign({}, localFile), {\n        sourceId: FileSelectLocalSourceId,\n        response: response\n      });\n\n      onAdd === null || onAdd === void 0 ? void 0 : onAdd([uploadedFile]);\n      setUploadProgress(function (prev) {\n        var _a;\n\n        return __assign(__assign({}, prev), (_a = {}, _a[id] = 100, _a));\n      });\n    }\n\n    setPendingUploadsCount(function (prev) {\n      return prev + 1;\n    });\n    fileUploader.uploadFiles(newFiles.map(function (entry) {\n      return {\n        id: entry.id,\n        blob: entry.src\n      };\n    }), {\n      onComplete: onComplete,\n      onProgress: onProgressInternal,\n      onError: onErrorInternal,\n      onCompleteAll: function () {\n        setPendingUploadsCount(function (prev) {\n          return prev - 1;\n        });\n      }\n    });\n  };\n\n  var onDrop = function (acceptedFiles) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var newFiles, shouldAttach;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            newFiles = acceptedFiles.slice(0, adjustedMaxFileNumber).map(function (file) {\n              return {\n                src: file,\n                id: ulid(),\n                name: file.name,\n                sourceId: FileSelectLocalSourceId\n              };\n            });\n            return [4\n            /*yield*/\n            , beforeLocalFileUpload(newFiles)];\n\n          case 1:\n            shouldAttach = _a.sent();\n            if (!shouldAttach) return [2\n            /*return*/\n            ];\n            setUploadProgress(function (prev) {\n              return newFiles.reduce(function (acc, item) {\n                acc[item.id] = 0;\n                return acc;\n              }, prev);\n            });\n            setValue(function (prev) {\n              return __spreadArray(__spreadArray([], prev, true), newFiles.map(function (file) {\n                return __assign(__assign({}, file), {\n                  name: getValueTokenLabel(FileSelectLocalSourceId, file, getTokenLabel)\n                });\n              }), true);\n            });\n            uploadFiles(newFiles);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var onModalSubmit = function () {\n    var _a, _b, _c;\n\n    setIsOpen(false);\n    var values = sources.flatMap(function (source) {\n      if (source.sourceId === FileSelectLocalSourceId) {\n        return source.value.map(function (v) {\n          var name = getValueTokenLabel(source.sourceId, v, getTokenLabel);\n          return __assign(__assign({}, v), {\n            name: name,\n            sourceId: FileSelectLocalSourceId\n          });\n        });\n      }\n\n      return source.value.map(function (entry) {\n        var name = getValueTokenLabel(source.sourceId, entry, getTokenLabel);\n        return {\n          id: ulid(),\n          name: name,\n          sourceId: source.sourceId,\n          origin: entry\n        };\n      });\n    });\n    setValue(function (prev) {\n      return __spreadArray(__spreadArray([], prev, true), values, true);\n    });\n    onAdd === null || onAdd === void 0 ? void 0 : onAdd(values);\n    clearErrors();\n    resetListeners.current.forEach(function (resetListener) {\n      return resetListener === null || resetListener === void 0 ? void 0 : resetListener();\n    });\n    setCurrentSource((_a = sources[0]) === null || _a === void 0 ? void 0 : _a.sourceId);\n    (_c = (_b = dropzoneRef.current) === null || _b === void 0 ? void 0 : _b.attachButton) === null || _c === void 0 ? void 0 : _c.focus();\n  };\n\n  var clearErrors = function () {\n    var _a;\n\n    (_a = dropzoneRef.current) === null || _a === void 0 ? void 0 : _a.clearErrors();\n  };\n\n  var handleFileRemoval = function (value) {\n    setValue(function (prev) {\n      return prev.filter(function (entry) {\n        return entry.id !== value.id;\n      });\n    });\n    onRemove === null || onRemove === void 0 ? void 0 : onRemove(value);\n    setUploadProgress(function (prev) {\n      var _a;\n\n      return __assign(__assign({}, prev), (_a = {}, _a[value.id] = null, _a));\n    });\n    clearErrors();\n  };\n\n  var updateSource = function (sourceId, props) {\n    setSources(function (prev) {\n      return prev.map(function (source) {\n        if (source.sourceId === sourceId) {\n          return __assign(__assign({}, source), props);\n        }\n\n        return source;\n      });\n    });\n  };\n\n  var onAttachFromProject = function () {\n    var _a;\n\n    setIsOpen(true);\n\n    if (!currentSource) {\n      setCurrentSource((_a = sources[0]) === null || _a === void 0 ? void 0 : _a.sourceId);\n    }\n  };\n\n  var resetListeners = React.useRef([]);\n  return React.createElement(StyledFileSelect, __assign({}, props, {\n    ref: rootElRef\n  }), React.createElement(FileExplorer, {\n    ref: modalElRef,\n    qa: {\n      attachButton: qa === null || qa === void 0 ? void 0 : qa.attachButton\n    },\n    unsubmittedValueCount: unsubmittedSourceValues.length,\n    onModalVisibilityChange: function (isOpen) {\n      var _a, _b;\n\n      setIsOpen(isOpen);\n\n      if (!isOpen) {\n        (_b = (_a = dropzoneRef.current) === null || _a === void 0 ? void 0 : _a.attachButton) === null || _b === void 0 ? void 0 : _b.focus();\n      }\n    },\n    sources: sources,\n    currentSource: currentSource,\n    onCurrentSourceChange: setCurrentSource,\n    isOpen: isOpen,\n    onSubmit: onModalSubmit\n  }, React.createElement(FileSelectContext.Provider, {\n    value: {\n      register: function (sourceId, source) {\n        setSources(function (prev) {\n          return __spreadArray(__spreadArray([], prev, true), [__assign(__assign({\n            title: '',\n            icon: '',\n            isUploading: false,\n            hasError: false,\n            value: []\n          }, source), {\n            sourceId: sourceId\n          })], false);\n        });\n        return function () {\n          setSources(function (prev) {\n            return prev.filter(function (source) {\n              return source.sourceId !== sourceId;\n            });\n          });\n        };\n      },\n      currentSource: currentSource,\n      onChange: function (sourceId, value) {\n        updateSource(sourceId, {\n          value: value\n        });\n      },\n      onResetValue: function (listener) {\n        resetListeners.current = __spreadArray(__spreadArray([], resetListeners.current, true), [listener], false);\n        return function () {\n          resetListeners.current = resetListeners.current.filter(function (listenerEntry) {\n            return listener !== listenerEntry;\n          });\n        };\n      },\n      setIsUploading: function (sourceId, isUploading) {\n        updateSource(sourceId, {\n          isUploading: isUploading\n        });\n      },\n      setHasError: function (sourceId, hasError) {\n        updateSource(sourceId, {\n          hasError: hasError\n        });\n      },\n      isModalOpen: isOpen,\n      maxFileNumber: adjustedMaxFileNumber - unsubmittedSourceValues.length\n    }\n  }, !hideLocalSource ? React.createElement(LocalSource, {\n    beforeLocalFileUpload: beforeLocalFileUpload,\n    dropzoneContentRenderer: localSourceDropzoneContentRenderer,\n    sourceId: FileSelectLocalSourceId,\n    getEndpoint: getEndpoint,\n    getMethod: getMethod,\n    getPayloadKey: getPayloadKey,\n    getPayload: getPayload,\n    getHeaders: getHeaders,\n    uploadFile: uploadFile,\n    accept: accept,\n    maxFileSize: maxFileSize,\n    minFileSize: minFileSize,\n    qa: qa === null || qa === void 0 ? void 0 : qa.localSource\n  }) : null, children)), React.createElement(FileSelectDropzone, {\n    ref: dropzoneRef,\n    hideDropzone: hideDropzone,\n    tooltip: hasReachedMaxFileNumber ? I18n.t('core.fileSelect.maxNumberOfFilesSelected') : '',\n    contentRenderer: dropzoneContentRenderer ? function (dropzoneProps) {\n      return dropzoneContentRenderer({\n        openFileExplorer: onAttachFromProject,\n        openLocalFiles: dropzoneProps.open,\n        disabled: dropzoneProps.disabled,\n        errorMessage: dropzoneProps.errorMessage\n      });\n    } : undefined,\n    onAttachFromProject: onAttachFromProject,\n    accept: accept,\n    maxFileNumber: maxFileNumber,\n    maxFileSize: maxFileSize,\n    minFileSize: minFileSize,\n    disabled: hasReachedMaxFileNumber,\n    value: uploadedValues,\n    onDrop: onDrop,\n    multiple: true,\n    noDrag: hideDropzone\n  }), React.createElement(StyledFileTokenList, {\n    tokens: value.map(function (v) {\n      var _a;\n\n      return __assign(__assign({}, v), {\n        progress: (_a = uploadProgress[v.id]) !== null && _a !== void 0 ? _a : 100\n      });\n    }),\n    onClick: onFileTokenClick,\n    onClose: handleFileRemoval,\n    qa: {\n      closeButton: qa === null || qa === void 0 ? void 0 : qa.removeEntry\n    }\n  }));\n});\n\nfunction noop() {}\n\nexport var FileSelectContext = React.createContext({\n  register: function () {\n    return noop;\n  },\n  currentSource: '',\n  isModalOpen: false,\n  onChange: noop,\n  onResetValue: function () {\n    return noop;\n  },\n  maxFileNumber: Infinity,\n  setIsUploading: noop,\n  setHasError: noop\n});\nexport var useFileSelectContext = function () {\n  return React.useContext(FileSelectContext);\n};\nexport var FileSelect = addSubcomponents({\n  LocalSource: LocalSource,\n  GridSource: GridSource,\n  TreeSource: TreeSource\n}, FileSelectBase);","map":{"version":3,"sources":["../../../../src/components/FileSelect/FileSelect.tsx"],"names":[],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport React from 'react';\nimport { ulid } from 'ulid';\nimport { useFileUploader } from '../../effects/useFileUploader';\nimport { useI18nContext } from '../../state/I18n';\nimport { addSubcomponents } from '../../utils/addSubcomponents';\nimport { FileExplorer } from './FileExplorer/FileExplorer';\nimport { GridSource } from './GridSource';\nimport { LocalSource } from './LocalSource';\nimport { TreeSource } from './TreeSource';\nimport { FileSelectDropzone } from './FileSelectDropzone';\nimport { StyledFileSelect, StyledFileTokenList } from './FileSelect.styles';\nexport var FileSelectLocalSourceId = 'FileSelectLocalSource';\nvar defaultGetTokenLabel = function (sourceId, sourceValueEntry) {\n    return sourceValueEntry.name;\n};\nvar defaultGetMethod = function () { return 'POST'; };\nvar defaultGetPayloadKey = function () { return 'file'; };\nvar defaultGetHeaders = function () { return ({}); };\nvar getValueTokenLabel = function (sourceId, entry, getTokenLabel) {\n    var _a;\n    if (getTokenLabel === void 0) { getTokenLabel = defaultGetTokenLabel; }\n    var namePlaceholder = 'Untitled';\n    var name = (_a = getTokenLabel(sourceId, entry)) !== null && _a !== void 0 ? _a : entry.name;\n    if (!name) {\n        console.warn(\"FileSelect: Couldn't derive the name of \\\"\".concat(sourceId, \"\\\" source value. Check the source or use \\\"getTokenLabel\\\" prop\"));\n    }\n    return name !== null && name !== void 0 ? name : namePlaceholder;\n};\nvar FileSelectBase = React.forwardRef(function (_a, ref) {\n    var onAdd = _a.onAdd, _b = _a.beforeLocalFileUpload, beforeLocalFileUpload = _b === void 0 ? function () { return new Promise(function (resolve) { return resolve(true); }); } : _b, onRemove = _a.onRemove, onProgress = _a.onProgress, onUploadStateChange = _a.onUploadStateChange, onError = _a.onError, onFileTokenClick = _a.onFileTokenClick, dropzoneContentRenderer = _a.dropzoneContentRenderer, _c = _a.hideDropzone, hideDropzone = _c === void 0 ? false : _c, _d = _a.getTokenLabel, getTokenLabel = _d === void 0 ? defaultGetTokenLabel : _d, _e = _a.hideLocalSource, hideLocalSource = _e === void 0 ? false : _e, localSourceDropzoneContentRenderer = _a.localSourceDropzoneContentRenderer, _f = _a.maxFileNumber, maxFileNumber = _f === void 0 ? Infinity : _f, maxFileSize = _a.maxFileSize, minFileSize = _a.minFileSize, accept = _a.accept, getEndpoint = _a.getEndpoint, _g = _a.getMethod, getMethod = _g === void 0 ? defaultGetMethod : _g, _h = _a.getPayloadKey, getPayloadKey = _h === void 0 ? defaultGetPayloadKey : _h, getPayload = _a.getPayload, _j = _a.getHeaders, getHeaders = _j === void 0 ? defaultGetHeaders : _j, uploadFile = _a.uploadFile, children = _a.children, qa = _a.qa, props = __rest(_a, [\"onAdd\", \"beforeLocalFileUpload\", \"onRemove\", \"onProgress\", \"onUploadStateChange\", \"onError\", \"onFileTokenClick\", \"dropzoneContentRenderer\", \"hideDropzone\", \"getTokenLabel\", \"hideLocalSource\", \"localSourceDropzoneContentRenderer\", \"maxFileNumber\", \"maxFileSize\", \"minFileSize\", \"accept\", \"getEndpoint\", \"getMethod\", \"getPayloadKey\", \"getPayload\", \"getHeaders\", \"uploadFile\", \"children\", \"qa\"]);\n    var _k = React.useState(false), isOpen = _k[0], setIsOpen = _k[1];\n    var _l = React.useState(''), currentSource = _l[0], setCurrentSource = _l[1];\n    var _m = React.useState([]), sources = _m[0], setSources = _m[1];\n    var I18n = useI18nContext();\n    var fileUploader = useFileUploader({\n        getEndpoint: getEndpoint,\n        getMethod: getMethod,\n        getPayloadKey: getPayloadKey,\n        getPayload: getPayload,\n        getHeaders: getHeaders,\n        uploadFile: uploadFile,\n    });\n    var _o = React.useState([]), value = _o[0], setValue = _o[1];\n    var _p = React.useState({}), uploadProgress = _p[0], setUploadProgress = _p[1];\n    var _q = React.useState(0), pendingUploadsCount = _q[0], setPendingUploadsCount = _q[1];\n    var modalElRef = React.useRef(null);\n    var rootElRef = React.useRef(null);\n    var dropzoneRef = React.useRef(null);\n    React.useEffect(function () {\n        onUploadStateChange === null || onUploadStateChange === void 0 ? void 0 : onUploadStateChange(pendingUploadsCount > 0);\n    }, [pendingUploadsCount]);\n    React.useImperativeHandle(ref, function () { return ({\n        setValue: setValue,\n        open: function (sourceId) {\n            var _a;\n            setIsOpen(true);\n            var newCurrentSource = sourceId !== null && sourceId !== void 0 ? sourceId : (_a = sources[0]) === null || _a === void 0 ? void 0 : _a.sourceId;\n            if (newCurrentSource) {\n                setCurrentSource(newCurrentSource);\n            }\n        },\n        close: function () {\n            setIsOpen(false);\n        },\n        modalEl: modalElRef,\n        rootEl: rootElRef,\n    }); });\n    var uploadedValues = value.filter(function (entry) { return !entry.error; });\n    var adjustedMaxFileNumber = maxFileNumber - uploadedValues.length;\n    var hasReachedMaxFileNumber = adjustedMaxFileNumber < 1;\n    var unsubmittedSourceValues = sources.flatMap(function (source) { return source.value; });\n    var updateFile = function (fileId, payload) {\n        setValue(function (prev) {\n            return prev.map(function (v) {\n                if (v.id === fileId) {\n                    return __assign(__assign({}, v), payload);\n                }\n                return v;\n            });\n        });\n    };\n    function onProgressInternal(id, progress) {\n        onProgress === null || onProgress === void 0 ? void 0 : onProgress(id, progress);\n        setUploadProgress(function (prev) {\n            var _a;\n            return (__assign(__assign({}, prev), (_a = {}, _a[id] = Math.min(99, progress), _a)));\n        });\n    }\n    function onErrorInternal(id, error) {\n        updateFile(id, { error: I18n.t('core.fileSelect.uploadFailed') });\n        onError === null || onError === void 0 ? void 0 : onError(id, error);\n        setUploadProgress(function (prev) {\n            var _a;\n            return (__assign(__assign({}, prev), (_a = {}, _a[id] = 100, _a)));\n        });\n    }\n    var uploadFiles = function (newFiles) {\n        function onComplete(id, response) {\n            var localFile = newFiles.find(function (entry) { return entry.id === id; });\n            updateFile(id, { response: response });\n            var uploadedFile = __assign(__assign({}, localFile), { sourceId: FileSelectLocalSourceId, response: response });\n            onAdd === null || onAdd === void 0 ? void 0 : onAdd([uploadedFile]);\n            setUploadProgress(function (prev) {\n                var _a;\n                return (__assign(__assign({}, prev), (_a = {}, _a[id] = 100, _a)));\n            });\n        }\n        setPendingUploadsCount(function (prev) { return prev + 1; });\n        fileUploader.uploadFiles(newFiles.map(function (entry) { return ({ id: entry.id, blob: entry.src }); }), {\n            onComplete: onComplete,\n            onProgress: onProgressInternal,\n            onError: onErrorInternal,\n            onCompleteAll: function () {\n                setPendingUploadsCount(function (prev) { return prev - 1; });\n            },\n        });\n    };\n    var onDrop = function (acceptedFiles) { return __awaiter(void 0, void 0, void 0, function () {\n        var newFiles, shouldAttach;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    newFiles = acceptedFiles\n                        .slice(0, adjustedMaxFileNumber)\n                        .map(function (file) { return ({\n                        src: file,\n                        id: ulid(),\n                        name: file.name,\n                        sourceId: FileSelectLocalSourceId,\n                    }); });\n                    return [4 /*yield*/, beforeLocalFileUpload(newFiles)];\n                case 1:\n                    shouldAttach = _a.sent();\n                    if (!shouldAttach)\n                        return [2 /*return*/];\n                    setUploadProgress(function (prev) {\n                        return newFiles.reduce(function (acc, item) {\n                            acc[item.id] = 0;\n                            return acc;\n                        }, prev);\n                    });\n                    setValue(function (prev) { return __spreadArray(__spreadArray([], prev, true), newFiles.map(function (file) { return (__assign(__assign({}, file), { name: getValueTokenLabel(FileSelectLocalSourceId, file, getTokenLabel) })); }), true); });\n                    uploadFiles(newFiles);\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var onModalSubmit = function () {\n        var _a, _b, _c;\n        setIsOpen(false);\n        var values = sources.flatMap(function (source) {\n            if (source.sourceId === FileSelectLocalSourceId) {\n                return source.value.map(function (v) {\n                    var name = getValueTokenLabel(source.sourceId, v, getTokenLabel);\n                    return __assign(__assign({}, v), { name: name, sourceId: FileSelectLocalSourceId });\n                });\n            }\n            return source.value.map(function (entry) {\n                var name = getValueTokenLabel(source.sourceId, entry, getTokenLabel);\n                return {\n                    id: ulid(),\n                    name: name,\n                    sourceId: source.sourceId,\n                    origin: entry,\n                };\n            });\n        });\n        setValue(function (prev) { return __spreadArray(__spreadArray([], prev, true), values, true); });\n        onAdd === null || onAdd === void 0 ? void 0 : onAdd(values);\n        clearErrors();\n        resetListeners.current.forEach(function (resetListener) { return resetListener === null || resetListener === void 0 ? void 0 : resetListener(); });\n        setCurrentSource((_a = sources[0]) === null || _a === void 0 ? void 0 : _a.sourceId);\n        (_c = (_b = dropzoneRef.current) === null || _b === void 0 ? void 0 : _b.attachButton) === null || _c === void 0 ? void 0 : _c.focus();\n    };\n    var clearErrors = function () {\n        var _a;\n        (_a = dropzoneRef.current) === null || _a === void 0 ? void 0 : _a.clearErrors();\n    };\n    var handleFileRemoval = function (value) {\n        setValue(function (prev) { return prev.filter(function (entry) { return entry.id !== value.id; }); });\n        onRemove === null || onRemove === void 0 ? void 0 : onRemove(value);\n        setUploadProgress(function (prev) {\n            var _a;\n            return (__assign(__assign({}, prev), (_a = {}, _a[value.id] = null, _a)));\n        });\n        clearErrors();\n    };\n    var updateSource = function (sourceId, props) {\n        setSources(function (prev) {\n            return prev.map(function (source) {\n                if (source.sourceId === sourceId) {\n                    return __assign(__assign({}, source), props);\n                }\n                return source;\n            });\n        });\n    };\n    var onAttachFromProject = function () {\n        var _a;\n        setIsOpen(true);\n        if (!currentSource) {\n            setCurrentSource((_a = sources[0]) === null || _a === void 0 ? void 0 : _a.sourceId);\n        }\n    };\n    var resetListeners = React.useRef([]);\n    return (React.createElement(StyledFileSelect, __assign({}, props, { ref: rootElRef }),\n        React.createElement(FileExplorer, { ref: modalElRef, qa: { attachButton: qa === null || qa === void 0 ? void 0 : qa.attachButton }, unsubmittedValueCount: unsubmittedSourceValues.length, onModalVisibilityChange: function (isOpen) {\n                var _a, _b;\n                setIsOpen(isOpen);\n                if (!isOpen) {\n                    (_b = (_a = dropzoneRef.current) === null || _a === void 0 ? void 0 : _a.attachButton) === null || _b === void 0 ? void 0 : _b.focus();\n                }\n            }, sources: sources, currentSource: currentSource, onCurrentSourceChange: setCurrentSource, isOpen: isOpen, onSubmit: onModalSubmit },\n            React.createElement(FileSelectContext.Provider, { value: {\n                    register: function (sourceId, source) {\n                        setSources(function (prev) { return __spreadArray(__spreadArray([], prev, true), [\n                            __assign(__assign({ title: '', icon: '', isUploading: false, hasError: false, value: [] }, source), { sourceId: sourceId }),\n                        ], false); });\n                        return function () {\n                            setSources(function (prev) {\n                                return prev.filter(function (source) { return source.sourceId !== sourceId; });\n                            });\n                        };\n                    },\n                    currentSource: currentSource,\n                    onChange: function (sourceId, value) {\n                        updateSource(sourceId, { value: value });\n                    },\n                    onResetValue: function (listener) {\n                        resetListeners.current = __spreadArray(__spreadArray([], resetListeners.current, true), [listener], false);\n                        return function () {\n                            resetListeners.current = resetListeners.current.filter(function (listenerEntry) { return listener !== listenerEntry; });\n                        };\n                    },\n                    setIsUploading: function (sourceId, isUploading) {\n                        updateSource(sourceId, { isUploading: isUploading });\n                    },\n                    setHasError: function (sourceId, hasError) {\n                        updateSource(sourceId, { hasError: hasError });\n                    },\n                    isModalOpen: isOpen,\n                    maxFileNumber: adjustedMaxFileNumber - unsubmittedSourceValues.length,\n                } },\n                !hideLocalSource ? (React.createElement(LocalSource, { beforeLocalFileUpload: beforeLocalFileUpload, dropzoneContentRenderer: localSourceDropzoneContentRenderer, sourceId: FileSelectLocalSourceId, getEndpoint: getEndpoint, getMethod: getMethod, getPayloadKey: getPayloadKey, getPayload: getPayload, getHeaders: getHeaders, uploadFile: uploadFile, accept: accept, maxFileSize: maxFileSize, minFileSize: minFileSize, qa: qa === null || qa === void 0 ? void 0 : qa.localSource })) : null,\n                children)),\n        React.createElement(FileSelectDropzone, { ref: dropzoneRef, hideDropzone: hideDropzone, tooltip: hasReachedMaxFileNumber\n                ? I18n.t('core.fileSelect.maxNumberOfFilesSelected')\n                : '', contentRenderer: dropzoneContentRenderer\n                ? function (dropzoneProps) {\n                    return dropzoneContentRenderer({\n                        openFileExplorer: onAttachFromProject,\n                        openLocalFiles: dropzoneProps.open,\n                        disabled: dropzoneProps.disabled,\n                        errorMessage: dropzoneProps.errorMessage,\n                    });\n                }\n                : undefined, onAttachFromProject: onAttachFromProject, accept: accept, maxFileNumber: maxFileNumber, maxFileSize: maxFileSize, minFileSize: minFileSize, disabled: hasReachedMaxFileNumber, value: uploadedValues, onDrop: onDrop, multiple: true, noDrag: hideDropzone }),\n        React.createElement(StyledFileTokenList, { tokens: value.map(function (v) {\n                var _a;\n                return (__assign(__assign({}, v), { progress: (_a = uploadProgress[v.id]) !== null && _a !== void 0 ? _a : 100 }));\n            }), onClick: onFileTokenClick, onClose: handleFileRemoval, qa: { closeButton: qa === null || qa === void 0 ? void 0 : qa.removeEntry } })));\n});\nfunction noop() { }\nexport var FileSelectContext = React.createContext({\n    register: function () { return noop; },\n    currentSource: '',\n    isModalOpen: false,\n    onChange: noop,\n    onResetValue: function () { return noop; },\n    maxFileNumber: Infinity,\n    setIsUploading: noop,\n    setHasError: noop,\n});\nexport var useFileSelectContext = function () {\n    return React.useContext(FileSelectContext);\n};\nexport var FileSelect = addSubcomponents({\n    LocalSource: LocalSource,\n    GridSource: GridSource,\n    TreeSource: TreeSource,\n}, FileSelectBase);\n"]},"metadata":{},"sourceType":"module"}